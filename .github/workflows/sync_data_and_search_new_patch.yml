
name: sync_data_and_search_new_patch

on:
  # Triggers the workflow on push or pull request events but only for the main branch
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]
  schedule:
    - cron: '0 23 * * *'
  #  每天晚上11点从CVE官方同步一次数据就好了,这样的话date +%Y就不需要考虑跨年最后一天数据丢失的问题

jobs:
  build:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        python-version: [ '3.x' ]
    name: Python ${{ matrix.python-version }} sample
    steps:
      - uses: actions/checkout@v2
      - name: Set up Python
        uses: actions/setup-python@v2
        with:
          python-version: ${{ matrix.python-version }}
          architecture: x64
      - run: |
         export current_year=`date +%Y`
         export current_mouth=`date +%m`
         export current_day=`date +%d`
         echo $current_year
         
         mkdir -p cve_list
         
         export download_url="https://cve.mitre.org/data/downloads/allitems-cvrf-year-$current_year.xml"
         wget -P cve_list $download_url
         #  完成同步CVE数据
         
         pip install bs4
         pip install requests
         pip install lxml
         python cve_resolver.py
         
         git config --global user.email "lappland@happy.com"
         git config --global user.name  "iLappland"
         
         git add .
         git commit -m "Update CVE Data at $current_mouth/$current_day/$current_year"
         git push
