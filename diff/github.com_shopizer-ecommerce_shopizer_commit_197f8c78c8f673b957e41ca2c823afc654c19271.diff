From 197f8c78c8f673b957e41ca2c823afc654c19271 Mon Sep 17 00:00:00 2001
From: shopizer-ecommerce <csamson777@yahoo.com>
Date: Wed, 23 Dec 2020 23:10:53 -0500
Subject: [PATCH] xss robustness

---
 sm-shop/SALESMANAGER.h2.db                    | Bin 5877760 -> 5881856 bytes
 sm-shop/files/store/DownlaodRepository.dat    | Bin 580794 -> 351113 bytes
 .../config/ShopApplicationConfiguration.java  |   4 +-
 .../salesmanager/shop/filter/XssFilter.java   |  43 ++----------------
 .../filter/XssHttpServletRequestWrapper.java  |   7 +--
 .../category/ShoppingCategoryController.java  |  11 +++--
 6 files changed, 18 insertions(+), 47 deletions(-)

diff --git a/sm-shop/SALESMANAGER.h2.db b/sm-shop/SALESMANAGER.h2.db
index b07a5adf1e19c7cfcef4fc28bc8ada3844c554ff..6f9f3c6a365bf61d7635ca6723eedb0bec14af0d 100644
GIT binary patch
delta 6225
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
NfI>N83>r81{{Td!D<c2^

delta 6619
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

diff --git a/sm-shop/files/store/DownlaodRepository.dat b/sm-shop/files/store/DownlaodRepository.dat
index dc081f850b5505195348dce434402997300ddb71..141b9309a48bdabfe5c11b0cb964682648a7734e 100644
GIT binary patch
delta 19
acmdnBQ@L}yXhREQ3sVbo3(FSP&S(HnM+YMS

delta 48
zcmeC&F1l-{azhJa3sVbo3(FSP&S(w>=0-yXAZSmx#R$YqK+L>7;TDTVBcmPwj=K-`

diff --git a/sm-shop/src/main/java/com/salesmanager/shop/application/config/ShopApplicationConfiguration.java b/sm-shop/src/main/java/com/salesmanager/shop/application/config/ShopApplicationConfiguration.java
index 59efd2ddd..5a2f38958 100755
--- a/sm-shop/src/main/java/com/salesmanager/shop/application/config/ShopApplicationConfiguration.java
+++ b/sm-shop/src/main/java/com/salesmanager/shop/application/config/ShopApplicationConfiguration.java
@@ -78,7 +78,7 @@ public TilesViewResolver tilesViewResolver() {
   }
   
 
-/*  @Bean
+  @Bean
   public FilterRegistrationBean<XssFilter> croseSiteFilter(){
       FilterRegistrationBean<XssFilter> registrationBean 
         = new FilterRegistrationBean<>();
@@ -87,7 +87,7 @@ public TilesViewResolver tilesViewResolver() {
       registrationBean.addUrlPatterns("/*");
           
       return registrationBean;    
-  }*/
+  }
 
   @Override
   public void configureMessageConverters(List<HttpMessageConverter<?>> converters) {
diff --git a/sm-shop/src/main/java/com/salesmanager/shop/filter/XssFilter.java b/sm-shop/src/main/java/com/salesmanager/shop/filter/XssFilter.java
index 0d1d5dc93..042110f28 100644
--- a/sm-shop/src/main/java/com/salesmanager/shop/filter/XssFilter.java
+++ b/sm-shop/src/main/java/com/salesmanager/shop/filter/XssFilter.java
@@ -16,8 +16,8 @@
 import org.springframework.stereotype.Component;
 
 
-//@Component
-//@Order(5) //after other defined filters
+@Component
+@Order(0)
 public class XssFilter implements Filter {
 
 	 /**
@@ -30,49 +30,16 @@ public void init(FilterConfig filterConfig) throws ServletException {
 	  LOGGER.debug("(XssFilter) initialize");
 	 }
 
-/*	 @Override
-	 public void doFilter(ServletRequest request, ServletResponse response, FilterChain chain)
-	   throws IOException, ServletException {
-	  XssHttpServletRequestWrapper xssRequest =
-	    new XssHttpServletRequestWrapper((HttpServletRequest) request);
-	  chain.doFilter(xssRequest, response);
-	 }*/
-	 
-
-/*	 protected void doFilterInternal(HttpServletRequest request, HttpServletResponse response,
-	 		FilterChain filterChain) throws ServletException, IOException {
-
-	 	filterChain.doFilter(new XssHttpServletRequestWrapper(request) {
-
-
-	 	}, new HttpServletResponseWrapper(response));
-	 }*/
 	 
 	 @Override
 	 public void doFilter(ServletRequest srequest, ServletResponse response, FilterChain filterChain) throws IOException, ServletException {
 
-/*	 		HttpServletRequest request = (HttpServletRequest) srequest;
-	 		//final String realIp = request.getHeader(X_FORWARDED_FOR);
+	 		HttpServletRequest request = (HttpServletRequest) srequest;
+	 		filterChain.doFilter(new XssHttpServletRequestWrapper(request) {}, response);
 
-	 		//if (realIp != null) {
-	 			filterChain.doFilter(new XssHttpServletRequestWrapper(request) {
-	 				*//**
-	 				public String getRemoteAddr() {
-	 					return realIp;
-	 				}
-
-	 				public String getRemoteHost() {
-	 					return realIp;
-	 				}
-	 				**//*
-	 			}, response);
-
-	 			return;
-	 		//}
+	 }
 
-*/
 
-	 }
 
 	 @Override
 	 public void destroy() {
diff --git a/sm-shop/src/main/java/com/salesmanager/shop/filter/XssHttpServletRequestWrapper.java b/sm-shop/src/main/java/com/salesmanager/shop/filter/XssHttpServletRequestWrapper.java
index eab982356..f33984531 100644
--- a/sm-shop/src/main/java/com/salesmanager/shop/filter/XssHttpServletRequestWrapper.java
+++ b/sm-shop/src/main/java/com/salesmanager/shop/filter/XssHttpServletRequestWrapper.java
@@ -1,5 +1,7 @@
 package com.salesmanager.shop.filter;
 
+import java.util.Enumeration;
+
 import javax.servlet.http.HttpServletRequest;
 import javax.servlet.http.HttpServletRequestWrapper;
 
@@ -13,18 +15,17 @@
 public class XssHttpServletRequestWrapper extends HttpServletRequestWrapper {
 
 	public XssHttpServletRequestWrapper(HttpServletRequest request) {
-		super(request);
+		super(request);	
+		
 	}
 	
 
 	 
 	 @Override
 	    public String getHeader(String name) {
-	        //logger.info("Ineader .. parameter .......");
 	        String value = super.getHeader(name);
 	        if (value == null)
 	            return null;
-	        //logger.info("Ineader RequestWrapper ........... value ....");
 	        return cleanXSS(value);
 	    }
 	 
diff --git a/sm-shop/src/main/java/com/salesmanager/shop/store/controller/category/ShoppingCategoryController.java b/sm-shop/src/main/java/com/salesmanager/shop/store/controller/category/ShoppingCategoryController.java
index 6e1b4f284..3a61d2f34 100755
--- a/sm-shop/src/main/java/com/salesmanager/shop/store/controller/category/ShoppingCategoryController.java
+++ b/sm-shop/src/main/java/com/salesmanager/shop/store/controller/category/ShoppingCategoryController.java
@@ -23,6 +23,7 @@
 import org.springframework.web.bind.annotation.PathVariable;
 import org.springframework.web.bind.annotation.RequestMapping;
 import org.springframework.web.bind.annotation.ResponseBody;
+import org.springframework.web.util.HtmlUtils;
 
 import com.salesmanager.core.business.services.catalog.category.CategoryService;
 import com.salesmanager.core.business.services.catalog.product.PricingService;
@@ -112,9 +113,7 @@
 	 */
 	@RequestMapping("/shop/category/{friendlyUrl}.html/ref={ref}")
 	public String displayCategoryWithReference(@PathVariable final String friendlyUrl, @PathVariable final String ref, Model model, HttpServletRequest request, HttpServletResponse response, Locale locale) throws Exception {
-		
-		
-		
+
 		return this.displayCategory(friendlyUrl,ref,model,request,response,locale);
 	}
 	
@@ -141,7 +140,11 @@ private String displayCategory(final String friendlyUrl, final String ref, Model
 		MerchantStore store = (MerchantStore)request.getAttribute(Constants.MERCHANT_STORE);
 		
 		//set ref as request attribute
-		request.setAttribute("ref", ref);
+		String encoded = HtmlUtils.htmlEscape(ref);
+		if(!encoded.equals(ref)) {//possible xss
+			throw new Exception("Wrong input");
+		}
+		request.setAttribute("ref", encoded);
 
 		//get category
 		Category category = categoryService.getBySeUrl(store, friendlyUrl);
