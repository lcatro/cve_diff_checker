From a1ffcc52594b1e7240501aab0ea145f1da3edb5a Mon Sep 17 00:00:00 2001
From: Syed Hassan Raza <shrhawk88@gmail.com>
Date: Tue, 13 Jan 2015 17:30:17 +0500
Subject: [PATCH] Disable referrer (TNL-1144)

---
 common/static/js/vendor/noreferrer.js | 10 ++++++++++
 lms/templates/footer-edx-new.html     | 14 ++++++++------
 2 files changed, 18 insertions(+), 6 deletions(-)
 create mode 100644 common/static/js/vendor/noreferrer.js

diff --git a/common/static/js/vendor/noreferrer.js b/common/static/js/vendor/noreferrer.js
new file mode 100644
index 000000000000..d853a0bfb4a4
--- /dev/null
+++ b/common/static/js/vendor/noreferrer.js
@@ -0,0 +1,10 @@
+/*
+ jquery.noreferrer.js, version 0.1.3
+ https://github.com/knu/noreferrer
+
+ Copyright (c) 2011 Akinori MUSHA
+ Licensed under the 2-clause BSD license.
+*/
+(function(){(function(){$.browser.webkit||$.event.add(window,"load",function(){$("a[href][rel~=noreferrer], area[href][rel~=noreferrer]").each(function(){var b,e,c,g,d,f,h;b=this;c=b.href;$.browser.opera?(b.href="http://www.google.com/url?q="+encodeURIComponent(c),b.title||(b.title="Go to "+c)):(d=!1,g=function(){b.href="javascript:void(0)"},f=function(){b.href=c},$(b).bind("mouseout mouseover focus blur",f).mousedown(function(a){a.which===2&&(d=!0)}).blur(function(){d=!1}).mouseup(function(a){if(!(a.which===
+2&&d))return!0;g();d=!1;setTimeout(function(){alert("Middle clicking on this link is disabled");f()},500);return!1}),e="<html><head><meta http-equiv='Refresh' content='0; URL="+$("<p/>").text(c).html()+"' /></head><body></body></html>",$.browser.msie?$(b).click(function(){var a;switch(a=this.target||"_self"){case "_self":case window.name:a=window;break;default:a=window.open(null,a)}a=a.document;a.clear();a.write(e);a.close();return!1}):(h="data:text/html;charset=utf-8,"+
+encodeURIComponent(e),$(b).click(function(){this.href=h;return!0})))})})})()}).call(this);
\ No newline at end of file
diff --git a/lms/templates/footer-edx-new.html b/lms/templates/footer-edx-new.html
index 9f207bc27665..b0a9d6f09116 100644
--- a/lms/templates/footer-edx-new.html
+++ b/lms/templates/footer-edx-new.html
@@ -2,7 +2,6 @@
 <%! from django.core.urlresolvers import reverse %>
 <%! from django.utils.translation import ugettext as _ %>
 <%namespace name='static' file='static_content.html'/>
-
 ## WARNING: These files are specific to edx.org and are not used in installations outside of that domain. Open edX users will want to use the file "footer.html" for any changes or overrides.
 <div class="wrapper wrapper-footer edx-footer edx-footer-new">
   <footer id="footer-global" class="footer-global" role="contentinfo" aria-label="Footer">
@@ -65,31 +64,31 @@ <h2 class="footer-follow-title">${_("Follow Us")}</h2>
       <div class="footer-follow-links">
         ## Translators: This is the website name of www.twitter.com. Please
         ## translate this the way that Twitter advertises in your language.
-        <a href="${settings.PLATFORM_TWITTER_URL}" title="${_("Twitter")}">
+        <a href="${settings.PLATFORM_TWITTER_URL}" title="${_("Twitter")}" rel="noreferrer">
           <i class="icon fa fa-twitter element-invisible"></i>
           <span class="copy">${_("Twitter")}</span>
         </a>
         ## Translators: This is the website name of www.facebook.com. Please
         ## translate this the way that Facebook advertises in your language.
-        <a href="${settings.PLATFORM_FACEBOOK_ACCOUNT}" title="${_("Facebook")}">
+        <a href="${settings.PLATFORM_FACEBOOK_ACCOUNT}" title="${_("Facebook")}" rel="noreferrer">
           <i class="icon fa fa-facebook element-invisible"></i>
           <span class="copy">${_("Facebook")}</span>
         </a>
         ## Translators: This is the website name of www.meetup.com. Please
         ## translate this the way that Meetup advertises in your language.
-        <a href="${settings.PLATFORM_MEETUP_URL}" title="${_("Meetup")}">
+        <a href="${settings.PLATFORM_MEETUP_URL}" title="${_("Meetup")}" rel="noreferrer">
           <i class="icon fa fa-calendar element-invisible"></i>
           <span class="copy">${_("Meetup")}</span>
         </a>
         ## Translators: This is the website name of www.linked.com. Please
         ## translate this the way that LinkedIn advertises in your language.
-        <a href="${settings.PLATFORM_LINKEDIN_URL}" title="${_("LinkedIn")}">
+        <a href="${settings.PLATFORM_LINKEDIN_URL}" title="${_("LinkedIn")}" rel="noreferrer">
           <i class="icon fa fa-linkedin element-invisible"></i>
           <span class="copy">${_("LinkedIn")}</span>
         </a>
         ## Translators: This is the website name of plus.google.com. Please
         ## translate this the way that Google+ advertises in your language.
-        <a href="${settings.PLATFORM_GOOGLE_PLUS_URL}" title="${_("Google+")}">
+        <a href="${settings.PLATFORM_GOOGLE_PLUS_URL}" title="${_("Google+")}" rel="noreferrer">
           <i class="icon fa fa-google-plus element-invisible"></i>
           <span class="copy">${_("Google+")}</span>
         </a>
@@ -113,3 +112,6 @@ <h2 class="footer-nav-title">${_("Mobile Apps")}</h2>
     </div>
   </footer>
 </div>
+
+<script type="text/javascript" src="/static/js/vendor/noreferrer.js" charset="utf-8"></script>
+
