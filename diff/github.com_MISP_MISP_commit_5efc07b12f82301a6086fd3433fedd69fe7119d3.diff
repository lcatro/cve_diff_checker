From 5efc07b12f82301a6086fd3433fedd69fe7119d3 Mon Sep 17 00:00:00 2001
From: iglocska <andras.iklody@gmail.com>
Date: Fri, 18 May 2018 07:27:06 +0200
Subject: [PATCH] fix: Fixed a DOM based XSS with cortex type attributes

- as reported by Dawid Czarnecki (dawid@pz.pl)
---
 app/webroot/js/misp.js | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/app/webroot/js/misp.js b/app/webroot/js/misp.js
index 1a81951da5..510115207f 100644
--- a/app/webroot/js/misp.js
+++ b/app/webroot/js/misp.js
@@ -3160,7 +3160,7 @@ function submitMISPUpdate() {
 
 $(".cortex-json").click(function() {
 	var cortex_data = $(this).data('cortex-json');
-	cortex_data = JSON.stringify(cortex_data, null, 2);
+	cortex_data = htmlEncode(JSON.stringify(cortex_data, null, 2));
 	var popupHtml = '<pre class="simplepre">' + cortex_data + '</pre>';
 	popupHtml += '<div class="close-icon useCursorPointer" onClick="closeScreenshot();"></div>';
 	$('#screenshot_box').html(popupHtml);
