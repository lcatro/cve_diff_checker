From 01f47e04fd7c8d54399c9e465f823f0017069f8f Mon Sep 17 00:00:00 2001
From: Simone Mainardi <mainardi@ntop.org>
Date: Mon, 13 Feb 2017 23:47:02 +0100
Subject: [PATCH] Security fix: prevents empty host from being used

---
 src/Lua.cpp              | 3 ++-
 src/NetworkInterface.cpp | 2 ++
 2 files changed, 4 insertions(+), 1 deletion(-)

diff --git a/src/Lua.cpp b/src/Lua.cpp
index 33ef71e7ed1..b12d79df2ff 100644
--- a/src/Lua.cpp
+++ b/src/Lua.cpp
@@ -6018,7 +6018,8 @@ void Lua::setParamsTable(lua_State* vm, const char* table_name,
       char *_equal;
 
       if(strncmp(tok, "csrf", strlen("csrf")) /* Do not put csrf into the params table */
-	 && (_equal = strchr(tok, '='))) {
+	 && (_equal = strchr(tok, '='))
+	 && (strlen(_equal) > 1)) {
 	char *decoded_buf;
         int len;
 
diff --git a/src/NetworkInterface.cpp b/src/NetworkInterface.cpp
index c35b595b040..7b92cd4dcf9 100644
--- a/src/NetworkInterface.cpp
+++ b/src/NetworkInterface.cpp
@@ -2200,6 +2200,8 @@ Host* NetworkInterface::getHost(char *host_ip, u_int16_t vlan_id) {
   struct in6_addr a6;
   Host *h = NULL;
 
+  if(!host_ip) return(NULL);
+
   /* Check if address is invalid */
   if((inet_pton(AF_INET, (const char*)host_ip, &a4) == 0)
      && (inet_pton(AF_INET6, (const char*)host_ip, &a6) == 0)) {
