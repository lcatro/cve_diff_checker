From f54b2570615d38d0302e937079233e52c2d80995 Mon Sep 17 00:00:00 2001
From: Johan Cwiklinski <johan@x-tnd.be>
Date: Sun, 14 Feb 2021 15:19:34 +0100
Subject: [PATCH] Add test on stored xss

---
 tests/Galette/Entity/tests/units/Adherent.php | 20 +++++++++++++++++++
 1 file changed, 20 insertions(+)

diff --git a/tests/Galette/Entity/tests/units/Adherent.php b/tests/Galette/Entity/tests/units/Adherent.php
index aff3b0bbb..a2d97da8a 100644
--- a/tests/Galette/Entity/tests/units/Adherent.php
+++ b/tests/Galette/Entity/tests/units/Adherent.php
@@ -432,4 +432,24 @@ public function testParents()
         $this->boolean($child->store())->isTrue();
         $this->variable($child->parent)->isNull();
     }
+
+    /**
+     * Test XSS/SQL injection
+     *
+     * @return void
+     */
+    public function testInjection()
+    {
+        $data = [
+            'nom_adh'           => 'Doe',
+            'prenom_adh'        => 'Johny <script>console.log("anything");</script>',
+            'email_adh'         => 'jdoe@doe.com',
+            'login_adh'         => 'jdoe',
+            'info_public_adh'   => 'Any <script>console.log("useful");</script> information'
+        ] + $this->dataAdherentOne();
+        $member = $this->createMember($data);
+
+        $this->string($member->sfullname)->isIdenticalTo('DOE Johny Console.log("anything");');
+        $this->string($member->others_infos)->isIdenticalTo('Any console.log("useful"); information');
+    }
 }
