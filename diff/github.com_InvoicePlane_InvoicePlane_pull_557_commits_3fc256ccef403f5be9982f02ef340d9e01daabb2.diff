From 3fc256ccef403f5be9982f02ef340d9e01daabb2 Mon Sep 17 00:00:00 2001
From: Kovah <mail@kovah.de>
Date: Mon, 25 Sep 2017 15:24:53 +0200
Subject: [PATCH] Fixes escaping for client email / web address (IP-579)

---
 application/helpers/echo_helper.php        | 11 +++++++++++
 application/modules/clients/views/view.php |  4 ++--
 2 files changed, 13 insertions(+), 2 deletions(-)

diff --git a/application/helpers/echo_helper.php b/application/helpers/echo_helper.php
index 565c1ae3d..736db44ef 100644
--- a/application/helpers/echo_helper.php
+++ b/application/helpers/echo_helper.php
@@ -51,3 +51,14 @@ function _trans($line, $id = '', $default = null)
 {
     echo trans($line, $id, $default);
 }
+
+/**
+ * Echo for the auto link function with special chars handling
+ *
+ * @param $str
+ * @param string $type
+ * @param bool $popup
+ */
+function _auto_link($str, $type = 'both', $popup = FALSE) {
+    echo auto_link(htmlsc($str), $type, $popup);
+}
diff --git a/application/modules/clients/views/view.php b/application/modules/clients/views/view.php
index 5803afa83..6a8f47aa4 100644
--- a/application/modules/clients/views/view.php
+++ b/application/modules/clients/views/view.php
@@ -144,7 +144,7 @@ class="btn btn-default">
                                 <?php if ($client->client_email) : ?>
                                     <tr>
                                         <th><?php _trans('email'); ?></th>
-                                        <td><?php echo auto_link($client->client_email, 'email'); ?></td>
+                                        <td><?php _auto_link($client->client_email, 'email'); ?></td>
                                     </tr>
                                 <?php endif; ?>
                                 <?php if ($client->client_phone) : ?>
@@ -168,7 +168,7 @@ class="btn btn-default">
                                 <?php if ($client->client_web) : ?>
                                     <tr>
                                         <th><?php _trans('web'); ?></th>
-                                        <td><?php echo auto_link($client->client_web, 'url', true); ?></td>
+                                        <td><?php _auto_link($client->client_web, 'url', true); ?></td>
                                     </tr>
                                 <?php endif; ?>
 
