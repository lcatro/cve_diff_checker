From f25486c3d4aa472fec79150f2c41ed4333395d3d Mon Sep 17 00:00:00 2001
From: Michael Adams <mdadams@ece.uvic.ca>
Date: Sat, 26 Nov 2016 20:54:24 -0800
Subject: [PATCH] Fixed a bug in the packet iterator code. Added a new
 regression test case.

---
 data/test/good/PoC2.jpc       | Bin 0 -> 569 bytes
 src/libjasper/jpc/jpc_t2cod.c |   4 ++--
 2 files changed, 2 insertions(+), 2 deletions(-)
 create mode 100644 data/test/good/PoC2.jpc

diff --git a/data/test/good/PoC2.jpc b/data/test/good/PoC2.jpc
new file mode 100644
index 0000000000000000000000000000000000000000..6ce94dd1e096a689d092b436d0d373b55afc4c8e
GIT binary patch
literal 569
zcmYk0Jxc>Y5Qb;Z^ESD=Tt18%6D5a=L`WnCD+ReANYKJBu(A;~CZGn+6oO6i2Sm@x
zPP?>9et=yHk)*Imnsm`$kiur&8#vsB8D{2r-`Qb1Y!A{P0e}uB4*;2m``r4!m#9oA
zA#5KEDggl^%RGnK0ceC^6P{&9KrO3K*kz}X0kUDA9ak&%s+m8`Y~{Ai)XAcm%Vx7_
zo|eu0#d*a%EMJ!^SL_~C_eb&uggvqc_k?yc%ACN!PWiAW?WW8einY|QrFi|cu=I`n
zh`?lI1|4j6k&OyW!JYcBI{ZLJ1?KD5V$3n<4HCaV)OJ&6j{ciKq6tKAzw?`9oCjJx
zf3OirmiQK_pvqcZS<{MjWJZlSSOmE!S(;z(SX}gTJD{JPJI!ACLKqUZg*`_^7>>1i
zG}us+r4VxzYmUD9bTmdi@p!AJ0&_@FeNH2p5ZsfVDkco4T0O;eTn14e_cRG_Q~V`>
LWLhxIxT@|S8-~Dq

literal 0
HcmV?d00001

diff --git a/src/libjasper/jpc/jpc_t2cod.c b/src/libjasper/jpc/jpc_t2cod.c
index 5e2c8627..91114e38 100644
--- a/src/libjasper/jpc/jpc_t2cod.c
+++ b/src/libjasper/jpc/jpc_t2cod.c
@@ -249,9 +249,9 @@ static int jpc_pi_nextrpcl(register jpc_pi_t *pi)
 			for (rlvlno = 0, pirlvl = picomp->pirlvls; rlvlno <
 			  picomp->numrlvls; ++rlvlno, ++pirlvl) {
 				// Check for the potential for overflow problems.
-				if (pirlvl->prcwidthexpn + pi->picomp->numrlvls >
+				if (pirlvl->prcwidthexpn + picomp->numrlvls >
 				  JAS_UINTFAST32_NUMBITS - 2 ||
-				  pirlvl->prcheightexpn + pi->picomp->numrlvls >
+				  pirlvl->prcheightexpn + picomp->numrlvls >
 				  JAS_UINTFAST32_NUMBITS - 2) {
 					return -1;
 				}
