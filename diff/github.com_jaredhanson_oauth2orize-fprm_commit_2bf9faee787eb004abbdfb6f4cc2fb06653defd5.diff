From d48b4dd0e5a25ee2094725d98c35e468f027afd8 Mon Sep 17 00:00:00 2001
From: Marcin Hoppe <marcin.hoppe@auth0.com>
Date: Fri, 27 Apr 2018 12:56:43 +0200
Subject: [PATCH] Correctly encoding values that are not strings

Bump package version to 0.2.1.
---
 lib/index.js         | 7 ++++++-
 package.json         | 2 +-
 test/package.test.js | 4 +++-
 3 files changed, 10 insertions(+), 3 deletions(-)

diff --git a/lib/index.js b/lib/index.js
index 20cdb48..d0d62fd 100644
--- a/lib/index.js
+++ b/lib/index.js
@@ -27,7 +27,12 @@ exports = module.exports = function (txn, res, params) {
   var inputs = [];
   
   Object.keys(params).forEach(function (k) {
-    inputs.push(input.replace('{NAME}', k).replace('{VALUE}', entities.encode(params[k])));
+    var encoded = params[k];
+    if (typeof params[k] === 'string') {
+      encoded = entities.encode(params[k]);
+    }
+
+    inputs.push(input.replace('{NAME}', k).replace('{VALUE}', encoded));
    });
 
   res.setHeader('Content-Type', 'text/html;charset=UTF-8');
diff --git a/package.json b/package.json
index 9413173..fb065d3 100644
--- a/package.json
+++ b/package.json
@@ -1,6 +1,6 @@
 {
   "name": "oauth2orize-fprm",
-  "version": "0.2.0",
+  "version": "0.2.1",
   "description": "Form Post response mode support for OAuth2orize.",
   "keywords": [
     "oauth2",
diff --git a/test/package.test.js b/test/package.test.js
index 09ad3e0..f2c2e5a 100644
--- a/test/package.test.js
+++ b/test/package.test.js
@@ -74,7 +74,8 @@ nrQ5IKXuNsQ1g9ccT5DMtZSwgDFwsHMDWMPFGax5Lw6ogjwJ4AQDrhzNCFc\
             scope: '"></a>openid email user_metadata',
             response_mode: '"></a>form_post',
             state: req.oauth2.req.state,
-            id_token: '"></a>eyJhbGciOiJSUzI1NiIsImtpZCI6IjEifQ.eyJzdWIiOiJqb2huIiw'
+            id_token: '"></a>eyJhbGciOiJSUzI1NiIsImtpZCI6IjEifQ.eyJzdWIiOiJqb2huIiw',
+            expires_in: 86400
           };
 
           fprm(req.oauth2, res, params);
@@ -100,6 +101,7 @@ nrQ5IKXuNsQ1g9ccT5DMtZSwgDFwsHMDWMPFGax5Lw6ogjwJ4AQDrhzNCFc\
 <input type="hidden" name="response_mode" value="&quot;&gt;&lt;/a&gt;form_post"/>\
 <input type="hidden" name="state" value="&quot;&gt;&lt;/a&gt;DcP7csa3hMlvybERqcieLHrRzKBra"/>\
 <input type="hidden" name="id_token" value="&quot;&gt;&lt;/a&gt;eyJhbGciOiJSUzI1NiIsImtpZCI6IjEifQ.eyJzdWIiOiJqb2huIiw"/>\
+<input type="hidden" name="expires_in" value="86400"/>\
 </form></body></html>');
     });
   });
