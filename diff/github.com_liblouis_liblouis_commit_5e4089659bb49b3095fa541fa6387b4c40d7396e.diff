From 5e4089659bb49b3095fa541fa6387b4c40d7396e Mon Sep 17 00:00:00 2001
From: Christian Egli <christian.egli@sbs.ch>
Date: Mon, 3 Sep 2018 11:52:24 +0200
Subject: [PATCH] Fix a buffer overflow

Fixes #635

Thanks to HongxuChen for reporting it
---
 liblouis/lou_translateString.c | 4 +++-
 1 file changed, 3 insertions(+), 1 deletion(-)

diff --git a/liblouis/lou_translateString.c b/liblouis/lou_translateString.c
index dc1cb7ad23..7c207f4530 100644
--- a/liblouis/lou_translateString.c
+++ b/liblouis/lou_translateString.c
@@ -354,7 +354,9 @@ matchCurrentInput(
 		const InString *input, int pos, const widechar *passInstructions, int passIC) {
 	int k;
 	int kk = pos;
-	for (k = passIC + 2; k < passIC + 2 + passInstructions[passIC + 1]; k++)
+	for (k = passIC + 2;
+			((k < passIC + 2 + passInstructions[passIC + 1]) && (kk < input->length));
+			k++)
 		if (input->chars[kk] == ENDSEGMENT || passInstructions[k] != input->chars[kk++])
 			return 0;
 	return 1;
