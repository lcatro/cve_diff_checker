From 5f16640725b1225e6337c62526e6577f0f88edb8 Mon Sep 17 00:00:00 2001
From: dirk <dirk@git.imagemagick.org>
Date: Sat, 6 Feb 2016 12:26:49 +0100
Subject: [PATCH] Fixed head buffer overflow reported in:
 https://github.com/ImageMagick/ImageMagick/issues/98

---
 coders/psd.c | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/coders/psd.c b/coders/psd.c
index ba9bbba660..d8fd950311 100644
--- a/coders/psd.c
+++ b/coders/psd.c
@@ -575,7 +575,7 @@ static inline MagickSizeType GetPSDSize(const PSDInfo *psd_info,Image *image)
 static inline size_t GetPSDRowSize(Image *image)
 {
   if (image->depth == 1)
-    return((image->columns+7)/8);
+    return(((image->columns+7)/8)*GetPSDPacketSize(image));
   else
     return(image->columns*GetPSDPacketSize(image));
 }
