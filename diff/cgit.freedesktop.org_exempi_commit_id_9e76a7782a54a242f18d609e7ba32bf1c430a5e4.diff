From 9e76a7782a54a242f18d609e7ba32bf1c430a5e4 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Hubert=20Figui=C3=A8re?= <hub@figuiere.net>
Date: Wed, 2 Aug 2017 23:16:10 -0400
Subject: Bug 101913 - Prevent an assert from being reached with a corrupt file

- In VPXChunk::width() and VPXChunk::height() ensure val isn't 0.
---
 XMPFiles/source/FormatSupport/WEBP_Support.cpp | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

diff --git a/XMPFiles/source/FormatSupport/WEBP_Support.cpp b/XMPFiles/source/FormatSupport/WEBP_Support.cpp
index 2b007de..a211697 100644
--- a/XMPFiles/source/FormatSupport/WEBP_Support.cpp
+++ b/XMPFiles/source/FormatSupport/WEBP_Support.cpp
@@ -141,7 +141,7 @@ XMP_Uns32 VP8XChunk::width()
 }
 void VP8XChunk::width(XMP_Uns32 val)
 {
-    PutLE24(&this->data[4], val - 1);
+    PutLE24(&this->data[4], val > 0 ? val - 1 : 0);
 }
 XMP_Uns32 VP8XChunk::height()
 {
@@ -149,7 +149,7 @@ XMP_Uns32 VP8XChunk::height()
 }
 void VP8XChunk::height(XMP_Uns32 val)
 {
-    PutLE24(&this->data[7], val - 1);
+    PutLE24(&this->data[7], val > 0 ? val - 1 : 0);
 }
 bool VP8XChunk::xmp()
 {
-- 
cgit v1.2.1

