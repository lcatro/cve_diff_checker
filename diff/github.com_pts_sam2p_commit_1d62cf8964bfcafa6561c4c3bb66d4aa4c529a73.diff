From 1d62cf8964bfcafa6561c4c3bb66d4aa4c529a73 Mon Sep 17 00:00:00 2001
From: Peter Szabo <pts@fazekas.hu>
Date: Thu, 18 Jul 2019 16:56:16 +0200
Subject: [PATCH] fixed segfault in GIF reading; this fixes
 https://github.com/pts/sam2p/issues/67

---
 cgif.c | 3 ++-
 1 file changed, 2 insertions(+), 1 deletion(-)

diff --git a/cgif.c b/cgif.c
index 96f3ea1..7c2cb7c 100644
--- a/cgif.c
+++ b/cgif.c
@@ -1551,7 +1551,8 @@ int CGIFFF DGifSlurp(CGIFFF GifFileType *GifFile)
   			  memcpy(ep->Bytes,ExtData,ep->ByteCount * sizeof(char));
   			#else
   			  if (ExtData==NULL) break;
-  			  AddExtensionBlock(sp, ExtData[0], ExtData+1);
+                          AddExtensionBlock(&ext, ExtData[0], ExtData+1);
+                          ext.ExtensionBlocks[ext.ExtensionBlockCount-1].code=ext_code;
   			#endif
 		    }
 		}
