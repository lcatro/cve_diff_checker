From 1b434748d9239f42eae8aa7d37d7a0930c061e24 Mon Sep 17 00:00:00 2001
From: Zhijun Ren <ren.zhijun@oracle.com>
Date: Fri, 11 May 2018 16:02:52 +0800
Subject: [PATCH] fixing CTS failure issue in master branch

---
 .../faces/application/applicationimpl/InstanceFactory.java    | 4 ++++
 .../com/sun/faces/application/resource/ResourceManager.java   | 2 +-
 2 files changed, 5 insertions(+), 1 deletion(-)

diff --git a/impl/src/main/java/com/sun/faces/application/applicationimpl/InstanceFactory.java b/impl/src/main/java/com/sun/faces/application/applicationimpl/InstanceFactory.java
index a983b19526..bbcb5618b8 100644
--- a/impl/src/main/java/com/sun/faces/application/applicationimpl/InstanceFactory.java
+++ b/impl/src/main/java/com/sun/faces/application/applicationimpl/InstanceFactory.java
@@ -288,6 +288,10 @@ public UIComponent createComponent(FacesContext context, Resource componentResou
     }
     
     public UIComponent createComponent(FacesContext context, String componentType, String rendererType) {
+        
+        notNull(CONTEXT, context);
+        notNull(COMPONENT_TYPE, componentType);
+        
         return createComponentApplyAnnotations(context, componentType, rendererType, true);
     }
     
diff --git a/impl/src/main/java/com/sun/faces/application/resource/ResourceManager.java b/impl/src/main/java/com/sun/faces/application/resource/ResourceManager.java
index 24f8f7df9e..53e0d6455a 100644
--- a/impl/src/main/java/com/sun/faces/application/resource/ResourceManager.java
+++ b/impl/src/main/java/com/sun/faces/application/resource/ResourceManager.java
@@ -565,7 +565,7 @@ private String getLocalePrefix(FacesContext context) {
         
         localePrefix = context.getExternalContext().getRequestParameterMap().get("loc");
         
-        if(localePrefix != null){
+        if(localePrefix != null && !nameContainsForbiddenSequence(localePrefix)){
             return localePrefix;
         }
         
