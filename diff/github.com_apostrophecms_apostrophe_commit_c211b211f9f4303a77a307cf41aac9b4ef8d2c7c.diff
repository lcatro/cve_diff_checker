From c211b211f9f4303a77a307cf41aac9b4ef8d2c7c Mon Sep 17 00:00:00 2001
From: Thomas Boutell <tom@apostrophecms.com>
Date: Wed, 8 Sep 2021 10:16:57 -0400
Subject: [PATCH] session object should exist in task reqs for better
 compatibility

---
 modules/@apostrophecms/i18n/index.js | 4 ++--
 modules/@apostrophecms/task/index.js | 3 ++-
 2 files changed, 4 insertions(+), 3 deletions(-)

diff --git a/modules/@apostrophecms/i18n/index.js b/modules/@apostrophecms/i18n/index.js
index 7a0249d5e..dc0990df2 100644
--- a/modules/@apostrophecms/i18n/index.js
+++ b/modules/@apostrophecms/i18n/index.js
@@ -467,9 +467,9 @@ module.exports = {
           debug: self.debug,
           show: self.show,
           action: self.action,
-          crossDomainClipboard: req.session.aposCrossDomainClipboard
+          crossDomainClipboard: req.session && req.session.aposCrossDomainClipboard
         };
-        if (req.session.aposCrossDomainClipboard) {
+        if (req.session && req.session.aposCrossDomainClipboard) {
           req.session.aposCrossDomainClipboard = null;
         }
         return result;
diff --git a/modules/@apostrophecms/task/index.js b/modules/@apostrophecms/task/index.js
index 88515529c..fdf9dd59d 100644
--- a/modules/@apostrophecms/task/index.js
+++ b/modules/@apostrophecms/task/index.js
@@ -214,7 +214,8 @@ module.exports = {
               Use req.t instead.
             `);
             return key;
-          }
+          },
+          session: {}
         };
         addCloneMethod(req);
         req.res.__ = req.__;
