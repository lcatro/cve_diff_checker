From 88bd6c548ba79bce176cd875e9b56e7e0ef4d8d4 Mon Sep 17 00:00:00 2001
From: Michal Vasko <mvasko@cesnet.cz>
Date: Fri, 29 Mar 2019 11:08:52 +0100
Subject: [PATCH] yang parser BUGFIX double free

Fixes #739
---
 src/parser_yang_bis.c | 1 +
 src/yang.y.in         | 1 +
 2 files changed, 2 insertions(+)

diff --git a/src/parser_yang_bis.c b/src/parser_yang_bis.c
index 3fa7a40d7..42f285821 100644
--- a/src/parser_yang_bis.c
+++ b/src/parser_yang_bis.c
@@ -9123,6 +9123,7 @@ void
 yyerror(YYLTYPE *yylloc, void *scanner, struct yang_parameter *param, ...)
 {
   free(*param->value);
+  *param->value = NULL;
   if (yylloc->first_line != -1) {
     if (*param->data_node && (*param->data_node) == (*param->actual_node)) {
       LOGVAL(param->module->ctx, LYE_INSTMT, LY_VLOG_LYS, *param->data_node, yyget_text(scanner));
diff --git a/src/yang.y.in b/src/yang.y.in
index 70d7341ac..25879f6dd 100644
--- a/src/yang.y.in
+++ b/src/yang.y.in
@@ -4833,6 +4833,7 @@ void
 yyerror(YYLTYPE *yylloc, void *scanner, struct yang_parameter *param, ...)
 {
   free(*param->value);
+  *param->value = NULL;
   if (yylloc->first_line != -1) {
     if (*param->data_node && (*param->data_node) == (*param->actual_node)) {
       LOGVAL(param->module->ctx, LYE_INSTMT, LY_VLOG_LYS, *param->data_node, yyget_text(scanner));
