From a8f9c2aabed37cd6a728532d1aed13ae0f3dfd78 Mon Sep 17 00:00:00 2001
From: Cristy <urban-warrior@imagemagick.org>
Date: Wed, 19 Jul 2017 13:15:21 -0400
Subject: [PATCH] https://github.com/ImageMagick/ImageMagick/issues/591

---
 coders/txt.c | 6 ++++++
 1 file changed, 6 insertions(+)

diff --git a/coders/txt.c b/coders/txt.c
index bc0e0f7447..f59418bbcc 100644
--- a/coders/txt.c
+++ b/coders/txt.c
@@ -580,6 +580,12 @@ static Image *ReadTXTImage(const ImageInfo *image_info,ExceptionInfo *exception)
           break;
       }
     }
+    if (EOFBlob(image) != MagickFalse)
+      {
+        ThrowFileException(exception,CorruptImageError,"UnexpectedEndOfFile",
+          image->filename);
+        break;
+      }
     (void) ReadBlobString(image,text);
     if (LocaleNCompare((char *) text,MagickID,strlen(MagickID)) == 0)
       {
