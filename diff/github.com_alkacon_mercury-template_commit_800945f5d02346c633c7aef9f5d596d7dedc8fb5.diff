From 800945f5d02346c633c7aef9f5d596d7dedc8fb5 Mon Sep 17 00:00:00 2001
From: aKandzior <a.kandzior@alkacon.com>
Date: Thu, 22 Jul 2021 09:36:42 +0200
Subject: [PATCH] Escaping of naviation text to prevent usage of script in nav
 elements.

---
 .../formatters/navigation/breadcrumbs.jsp                    | 4 ++--
 .../alkacon.mercury.template/formatters/navigation/main.jsp  | 5 +++--
 .../alkacon.mercury.template/formatters/navigation/side.jsp  | 2 +-
 3 files changed, 6 insertions(+), 5 deletions(-)

diff --git a/alkacon.mercury.template/resources/system/modules/alkacon.mercury.template/formatters/navigation/breadcrumbs.jsp b/alkacon.mercury.template/resources/system/modules/alkacon.mercury.template/formatters/navigation/breadcrumbs.jsp
index efae8c64..b4af4319 100644
--- a/alkacon.mercury.template/resources/system/modules/alkacon.mercury.template/formatters/navigation/breadcrumbs.jsp
+++ b/alkacon.mercury.template/resources/system/modules/alkacon.mercury.template/formatters/navigation/breadcrumbs.jsp
@@ -42,8 +42,8 @@
                         <c:if test="${
                             ((breadcrumbsIncludeHidden or (status.last and not cms.detailRequest)) and (navElem.navPosition > 0))
                             or (navElem.info ne 'ignoreInDefaultNav')}">
-                            <c:set var="navText" value="${(empty navElem.navText or fn:startsWith(navElem.navText, '???'))
-                                ? navElem.title : navElem.navText}" />
+                            <c:set var="navText"><c:out value="${(empty navElem.navText or fn:startsWith(navElem.navText, '???'))
+                                ? navElem.title : navElem.navText}" /></c:set>
                             <c:if test="${!empty navText}">
                                 <c:set var="navLink"><cms:link>${navElem.resourceName}</cms:link></c:set>
                                 <c:if test="${breadcrumbsFullPath or (navLink ne lastNavLink)}">
diff --git a/alkacon.mercury.template/resources/system/modules/alkacon.mercury.template/formatters/navigation/main.jsp b/alkacon.mercury.template/resources/system/modules/alkacon.mercury.template/formatters/navigation/main.jsp
index de472b7e..abd77d80 100644
--- a/alkacon.mercury.template/resources/system/modules/alkacon.mercury.template/formatters/navigation/main.jsp
+++ b/alkacon.mercury.template/resources/system/modules/alkacon.mercury.template/formatters/navigation/main.jsp
@@ -188,8 +188,9 @@
 
             <c:out value='<li${menuType}${megaMenu}>${empty menuType ? "" : nl}' escapeXml="false" />
 
-            <c:set var="navText" value="${(empty navElem.navText or fn:startsWith(navElem.navText, '???'))
-                ? navElem.title : navElem.navText}" />
+            <c:set var="navText"><c:out value="${(empty navElem.navText or fn:startsWith(navElem.navText, '???'))
+                ? navElem.title : navElem.navText}" /></c:set>
+
 
             <c:choose>
 
diff --git a/alkacon.mercury.template/resources/system/modules/alkacon.mercury.template/formatters/navigation/side.jsp b/alkacon.mercury.template/resources/system/modules/alkacon.mercury.template/formatters/navigation/side.jsp
index de1c31cd..a460e57d 100644
--- a/alkacon.mercury.template/resources/system/modules/alkacon.mercury.template/formatters/navigation/side.jsp
+++ b/alkacon.mercury.template/resources/system/modules/alkacon.mercury.template/formatters/navigation/side.jsp
@@ -67,7 +67,7 @@
                     </c:otherwise>
                 </c:choose>
 
-                <c:set var="navText" value="${(empty navElem.navText or fn:startsWith(navElem.navText, '???')) ? navElem.title : navElem.navText}" />
+                <c:set var="navText"><c:out value="${(empty navElem.navText or fn:startsWith(navElem.navText, '???')) ? navElem.title : navElem.navText}" /></c:set>
 
                 <c:set var="menuType" value="${startSubMenu ? menuType.concat(' aria-expanded=\"false\"') : menuType}" />
 
