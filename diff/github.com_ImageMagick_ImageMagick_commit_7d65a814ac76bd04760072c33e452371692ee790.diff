From 7d65a814ac76bd04760072c33e452371692ee790 Mon Sep 17 00:00:00 2001
From: Dirk Lemstra <dirk@git.imagemagick.org>
Date: Sat, 7 Jan 2017 16:56:30 +0100
Subject: [PATCH] Fix improper cast that could cause an overflow as
 demonstrated in #347.

---
 coders/psd.c | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/coders/psd.c b/coders/psd.c
index 1f15d65b1b..a6f7ec4b0b 100644
--- a/coders/psd.c
+++ b/coders/psd.c
@@ -1671,7 +1671,7 @@ ModuleExport MagickBooleanType ReadPSDLayers(Image *image,
             /*
               Layer name.
             */
-            length=(MagickSizeType) ReadBlobByte(image);
+            length=(MagickSizeType) (unsigned char) ReadBlobByte(image);
             combined_length+=length+1;
             if (length > 0)
               (void) ReadBlob(image,(size_t) length++,layer_info[i].name);
