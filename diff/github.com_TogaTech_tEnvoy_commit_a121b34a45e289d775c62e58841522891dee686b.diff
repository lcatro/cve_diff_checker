From a121b34a45e289d775c62e58841522891dee686b Mon Sep 17 00:00:00 2001
From: CMEONE <contact@kabirwearsato.ga>
Date: Tue, 15 Jun 2021 10:16:16 -0700
Subject: [PATCH] Critical security fix in verifyWithMessage

---
 node/tenvoy.js | 2 +-
 tenvoy.js      | 2 +-
 2 files changed, 2 insertions(+), 2 deletions(-)

diff --git a/node/tenvoy.js b/node/tenvoy.js
index 7b2d5816..2cf0a25f 100644
--- a/node/tenvoy.js
+++ b/node/tenvoy.js
@@ -2166,7 +2166,7 @@ function tEnvoyNaClSigningKey(key, type = "secret", password = null, passwordPro
 			throw "tEnvoyNaClSigningKey Fatal Error: Invalid signature.";
 		}
 		let hash = _tEnvoy.util.hexToBytes(signed.split("::")[0]);
-		return this.verify(signed, password) && _tEnvoy.util.bytesToHex(_nacl.hash(_tEnvoy.util.pack(message))) == _tEnvoy.util.bytesToHex(hash);
+		return this.verify(signed, password).verified && _tEnvoy.util.bytesToHex(_nacl.hash(_tEnvoy.util.pack(message))) == _tEnvoy.util.bytesToHex(hash);
 	}
 	
 	this.toPublic = (password = null) => {
diff --git a/tenvoy.js b/tenvoy.js
index 52036f0e..b941c3a2 100644
--- a/tenvoy.js
+++ b/tenvoy.js
@@ -48183,7 +48183,7 @@ function tEnvoyNaClSigningKey(key, type = "secret", password = null, passwordPro
 			throw "tEnvoyNaClSigningKey Fatal Error: Invalid signature.";
 		}
 		let hash = _tEnvoy.util.hexToBytes(signed.split("::")[0]);
-		return this.verify(signed, password) && _tEnvoy.util.bytesToHex(_nacl.hash(_tEnvoy.util.pack(message))) == _tEnvoy.util.bytesToHex(hash);
+		return this.verify(signed, password).verified && _tEnvoy.util.bytesToHex(_nacl.hash(_tEnvoy.util.pack(message))) == _tEnvoy.util.bytesToHex(hash);
 	}
 	
 	this.toPublic = (password = null) => {
