From e2a67ce8ec377b8b3468b3c18132936d22571e09 Mon Sep 17 00:00:00 2001
From: Matteo Beccati <matteo@beccati.com>
Date: Sat, 23 Jan 2021 09:29:41 +0100
Subject: [PATCH] Fix h1 report 1083231

---
 RELEASE_NOTES.txt                           | 3 ++-
 lib/OA/Admin/UI/Field/AuditDaySpanField.php | 2 +-
 2 files changed, 3 insertions(+), 2 deletions(-)

diff --git a/RELEASE_NOTES.txt b/RELEASE_NOTES.txt
index 3e9f42fd4a..6f10b92393 100644
--- a/RELEASE_NOTES.txt
+++ b/RELEASE_NOTES.txt
@@ -23,7 +23,8 @@ What's New in Revive Adserver 5.1.1
  Security Updates
  ----------------
 
- * None
+ * Fixed reflected XSS vulnerability in userlog-index.php via the
+   period_preset parameter.
 
 
  New Features
diff --git a/lib/OA/Admin/UI/Field/AuditDaySpanField.php b/lib/OA/Admin/UI/Field/AuditDaySpanField.php
index af106066f9..f3229de13e 100644
--- a/lib/OA/Admin/UI/Field/AuditDaySpanField.php
+++ b/lib/OA/Admin/UI/Field/AuditDaySpanField.php
@@ -99,7 +99,7 @@ function {$this->_name}Reset()
         {
             document.getElementById('{$this->_name}_start').value = '$startDateStr';
             document.getElementById('{$this->_name}_start').value = '$endDateStr';
-            document.getElementById('{$this->_name}_preset').value = '{$this->_fieldSelectionValue}';
+            document.getElementById('{$this->_name}_preset').value = \"".addcslashes(stripslashes($this->_fieldSelectionValue), "\0..\37/\"\\")."\";
         }
         function {$this->_name}FormSubmit() {
             submitForm();
