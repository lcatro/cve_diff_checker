From 62f15433e42fb92e45bd57dd6fc0c0bf53deb6fc Mon Sep 17 00:00:00 2001
From: iglocska <andras.iklody@gmail.com>
Date: Tue, 7 May 2019 09:01:05 +0200
Subject: [PATCH] fix: [security] Fix persistent xss due to invalid
 sanitisation of image names in titles
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

- triggered by expanding a screenshot

- as reported by Jo√£o Lucas Melo Brasio from Elytron Security S.A. (https://elytronsecurity.com)
---
 app/webroot/js/misp.js | 4 +++-
 1 file changed, 3 insertions(+), 1 deletion(-)

diff --git a/app/webroot/js/misp.js b/app/webroot/js/misp.js
index c965a31fd9..be847e7b45 100644
--- a/app/webroot/js/misp.js
+++ b/app/webroot/js/misp.js
@@ -97,7 +97,9 @@ function screenshotPopup(url, title) {
     if (!url.startsWith('data:image/')) {
         url = url.slice(0, -1);
     }
-    popupHtml = '<it class="fa fa-spin fa-spinner" style="font-size: xx-large; color: white; position: fixed; left: 50%; top: 50%;"></it>'
+    popupHtml = '<it class="fa fa-spin fa-spinner" style="font-size: xx-large; color: white; position: fixed; left: 50%; top: 50%;"></it>';
+    url = $('<div>').text(url).html();
+    title = $('<div>').text(title).html();
     popupHtml += '<img class="screenshot_box-content hidden" src="' + url + '" id="screenshot-image" title="' + title + '" alt="' + title + '" onload="$(this).show(); $(this).parent().find(\'.fa-spinner\').remove();"/>';
     popupHtml += '<div class="close-icon useCursorPointer" onClick="closeScreenshot();"></div>';
     if (!url.startsWith('data:image/')) {
