From abe0d2a29a1d8e896bfe829c8461bf8b391f1079 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Michal=20=C4=8Ciha=C5=99?= <michal@cihar.com>
Date: Tue, 17 Jan 2017 22:33:44 +0100
Subject: [PATCH] Do not show validation error on password reset
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

This can leak information whether account exists or not.

Fixes #1317

Signed-off-by: Michal Čihař <michal@cihar.com>
---
 weblate/accounts/tests/test_registration.py | 17 +++++++++++++++++
 weblate/accounts/views.py                   |  2 ++
 2 files changed, 19 insertions(+)

diff --git a/weblate/accounts/tests/test_registration.py b/weblate/accounts/tests/test_registration.py
index d4b86e88f2cf..d9a77e74da7c 100644
--- a/weblate/accounts/tests/test_registration.py
+++ b/weblate/accounts/tests/test_registration.py
@@ -210,6 +210,23 @@ def test_reset(self):
 
         self.assert_registration('[Weblate] Password reset on Weblate')
 
+    def test_reset_nonexisting(self):
+        '''
+        Test for password reset.
+        '''
+        response = self.client.get(
+            reverse('password_reset'),
+        )
+        self.assertContains(response, 'Reset my password')
+        response = self.client.post(
+            reverse('password_reset'),
+            {
+                'email': 'test@example.com'
+            }
+        )
+        self.assertRedirects(response, reverse('email-sent'))
+        self.assertEqual(len(mail.outbox), 0)
+
     def test_reset_twice(self):
         '''
         Test for password reset.
diff --git a/weblate/accounts/views.py b/weblate/accounts/views.py
index dbe5814daaa2..91e0be5edaef 100644
--- a/weblate/accounts/views.py
+++ b/weblate/accounts/views.py
@@ -572,6 +572,8 @@ def reset_password(request):
 
             request.session['password_reset'] = True
             return complete(request, 'email')
+        else:
+            return redirect('email-sent')
     else:
         form = ResetForm()
 
