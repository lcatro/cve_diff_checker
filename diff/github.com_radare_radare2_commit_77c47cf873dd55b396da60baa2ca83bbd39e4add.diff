From 77c47cf873dd55b396da60baa2ca83bbd39e4add Mon Sep 17 00:00:00 2001
From: pancake <pancake@nopcode.org>
Date: Wed, 18 Apr 2018 13:26:49 +0200
Subject: [PATCH] Fix #9903 - oobread in RAnal.sh

---
 libr/anal/p/anal_sh.c | 3 ++-
 1 file changed, 2 insertions(+), 1 deletion(-)

diff --git a/libr/anal/p/anal_sh.c b/libr/anal/p/anal_sh.c
index d0326210135..ee2b34133fa 100644
--- a/libr/anal/p/anal_sh.c
+++ b/libr/anal/p/anal_sh.c
@@ -763,8 +763,9 @@ static int (*first_nibble_decode[])(RAnal*,RAnalOp*,ut16) = {
 static int sh_op(RAnal *anal, RAnalOp *op, ut64 addr, const ut8 *data, int len) {
 	ut8 op_MSB,op_LSB;
 	int ret;
-	if (!data)
+	if (!data || len < 2) {
 		return 0;
+	}
 	memset (op, '\0', sizeof (RAnalOp));
 	op->addr = addr;
 	op->type = R_ANAL_OP_TYPE_UNK;
