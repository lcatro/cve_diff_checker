From dfae49f5dc392c00cd43badcb3043db3a646ff0c Mon Sep 17 00:00:00 2001
From: Yannick Warnier <ywarnier@beeznest.org>
Date: Tue, 20 Jul 2021 15:03:44 +0200
Subject: [PATCH] Security: Add filter for DB port in install scripts

---
 main/install/ajax.php  | 2 +-
 main/install/index.php | 1 +
 2 files changed, 2 insertions(+), 1 deletion(-)

diff --git a/main/install/ajax.php b/main/install/ajax.php
index d17c8dd98cc..70f0f5fc4c0 100644
--- a/main/install/ajax.php
+++ b/main/install/ajax.php
@@ -46,7 +46,7 @@
     $dbName = null;
 }
 
-$dbPort = isset($_POST['db_port']) ? $_POST['db_port'] : 3306;
+$dbPort = isset($_POST['db_port']) ? (int) $_POST['db_port'] : 3306;
 
 $manager = connectToDatabase($dbHost, $dbUsername, $dbPass, $dbName, $dbPort);
 
diff --git a/main/install/index.php b/main/install/index.php
index 4f0c168cb83..727cca8c4d1 100755
--- a/main/install/index.php
+++ b/main/install/index.php
@@ -279,6 +279,7 @@
         $GLOBALS[$key] = $_POST[$key];
     }
 }
+$dbPortForm = (int) $dbPortForm;
 
 /* NEXT STEPS IMPLEMENTATION */
 
