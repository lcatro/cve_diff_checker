From 7fd419441bc7103398e313558171d342c6315f44 Mon Sep 17 00:00:00 2001
From: Dirk Lemstra <dirk@git.imagemagick.org>
Date: Mon, 15 May 2017 21:43:29 +0200
Subject: [PATCH] Added check for incorrect number of meta channels report in
 #492.

---
 coders/mpc.c | 3 +++
 1 file changed, 3 insertions(+)

diff --git a/coders/mpc.c b/coders/mpc.c
index 8088da4925..86359572d1 100644
--- a/coders/mpc.c
+++ b/coders/mpc.c
@@ -568,6 +568,9 @@ static Image *ReadMPCImage(const ImageInfo *image_info,ExceptionInfo *exception)
                 if (LocaleCompare(keyword,"number-meta-channels") == 0)
                   {
                     image->number_meta_channels=StringToUnsignedLong(options);
+                    if (image->number_meta_channels > MaxPixelChannels)
+                      ThrowReaderException(CorruptImageError,
+                        "ImproperImageHeader");
                     break;
                   }
                 break;
