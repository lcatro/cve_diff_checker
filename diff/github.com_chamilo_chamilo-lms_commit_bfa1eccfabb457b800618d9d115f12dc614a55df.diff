From bfa1eccfabb457b800618d9d115f12dc614a55df Mon Sep 17 00:00:00 2001
From: Yannick Warnier <ywarnier@beeznest.org>
Date: Mon, 17 Dec 2018 10:11:45 -0500
Subject: [PATCH] Security: Fix SQL injection and likely future similar issues

---
 main/inc/lib/CoursesAndSessionsCatalog.class.php | 8 ++++++--
 1 file changed, 6 insertions(+), 2 deletions(-)

diff --git a/main/inc/lib/CoursesAndSessionsCatalog.class.php b/main/inc/lib/CoursesAndSessionsCatalog.class.php
index feca55ad1ec..32b71da33ee 100644
--- a/main/inc/lib/CoursesAndSessionsCatalog.class.php
+++ b/main/inc/lib/CoursesAndSessionsCatalog.class.php
@@ -215,8 +215,8 @@ public static function getLimitFilterFromArray($limit)
     {
         $limitFilter = '';
         if (!empty($limit) && is_array($limit)) {
-            $limitStart = isset($limit['start']) ? $limit['start'] : 0;
-            $limitLength = isset($limit['length']) ? $limit['length'] : 12;
+            $limitStart = isset($limit['start']) ? (int) $limit['start'] : 0;
+            $limitLength = isset($limit['length']) ? (int) $limit['length'] : 12;
             $limitFilter = 'LIMIT '.$limitStart.', '.$limitLength;
         }
 
@@ -470,11 +470,13 @@ public static function search_courses($search_term, $limit, $justVisible = false
      * @param array  $limit
      *
      * @return array The session list
+     * @throws Exception
      */
     public static function browseSessions($date = null, $limit = [])
     {
         $em = Database::getManager();
         $urlId = api_get_current_access_url_id();
+        $date = Database::escape_string($date);
         $sql = "SELECT s.id FROM session s ";
         $sql .= "
             INNER JOIN access_url_rel_session ars
@@ -501,6 +503,8 @@ public static function browseSessions($date = null, $limit = [])
         }
 
         if (!empty($limit)) {
+            $limit['start'] = (int) $limit['start'];
+            $limit['length'] = (int) $limit['length'];
             $sql .= "LIMIT {$limit['start']}, {$limit['length']} ";
         }
 
