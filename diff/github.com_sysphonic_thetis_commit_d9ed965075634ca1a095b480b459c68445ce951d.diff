From d9ed965075634ca1a095b480b459c68445ce951d Mon Sep 17 00:00:00 2001
From: MORITA Shintaro <shin@sysphonic.com>
Date: Tue, 7 Jul 2015 10:34:01 +0900
Subject: [PATCH] Some trivial bug-fixes. Signed-off-by: MORITA Shintaro
 <shin@sysphonic.com>

---
 app/controllers/application_controller.rb | 7 ++++++-
 1 file changed, 6 insertions(+), 1 deletion(-)

diff --git a/app/controllers/application_controller.rb b/app/controllers/application_controller.rb
index 9b83a1a..b08bd83 100644
--- a/app/controllers/application_controller.rb
+++ b/app/controllers/application_controller.rb
@@ -99,7 +99,12 @@ def gate_process
 
     HistoryHelper.keep_last(request)
 
-    @login_user = User.find(session[:login_user_id])
+    SqlHelper.validate_token([session[:login_user_id]])
+    begin
+      @login_user = User.find(session[:login_user_id])
+    rescue => evar
+      @login_user = nil
+    end
 
     begin
       if @login_user.nil? \
