From eaf1cfdc1fe0bdffabd8d879c591b864d833326c Mon Sep 17 00:00:00 2001
From: John Blackbourn <johnbillion@git.wordpress.org>
Date: Wed, 29 Nov 2017 15:52:50 +0000
Subject: [PATCH] Hardening: Use a properly generated hash for the
 `newbloguser` key instead of a determinate substring.

Built from https://develop.svn.wordpress.org/trunk@42258


git-svn-id: http://core.svn.wordpress.org/trunk@42087 1a063a9b-81f0-0310-95a4-ce76da25c4cd
---
 wp-admin/user-new.php   | 2 +-
 wp-includes/version.php | 2 +-
 2 files changed, 2 insertions(+), 2 deletions(-)

diff --git a/wp-admin/user-new.php b/wp-admin/user-new.php
index ebcd2a7dca6d..641fd822fd3c 100644
--- a/wp-admin/user-new.php
+++ b/wp-admin/user-new.php
@@ -75,7 +75,7 @@
 				$redirect = add_query_arg( array( 'update' => 'could_not_add' ), 'user-new.php' );
 			}
 		} else {
-			$newuser_key = substr( md5( $user_id ), 0, 5 );
+			$newuser_key = wp_generate_password( 20, false );
 			add_option( 'new_user_' . $newuser_key, array( 'user_id' => $user_id, 'email' => $user_details->user_email, 'role' => $_REQUEST[ 'role' ] ) );
 
 			$roles = get_editable_roles();
diff --git a/wp-includes/version.php b/wp-includes/version.php
index 05180f59f490..f5f8415d416b 100644
--- a/wp-includes/version.php
+++ b/wp-includes/version.php
@@ -4,7 +4,7 @@
  *
  * @global string $wp_version
  */
-$wp_version = '5.0-alpha-42257';
+$wp_version = '5.0-alpha-42258';
 
 /**
  * Holds the WordPress DB revision, increments when changes are made to the WordPress DB schema.
