From 3d95e3ae816f4d7c638f40d3e936a4be19724381 Mon Sep 17 00:00:00 2001
From: Pascal Birchler <pascal.birchler@gmail.com>
Date: Tue, 16 May 2017 08:46:42 +0000
Subject: [PATCH] Adjust post meta checks

Built from https://develop.svn.wordpress.org/trunk@40692


git-svn-id: http://core.svn.wordpress.org/trunk@40555 1a063a9b-81f0-0310-95a4-ce76da25c4cd
---
 wp-includes/class-wp-xmlrpc-server.php | 5 +++++
 wp-includes/version.php                | 2 +-
 2 files changed, 6 insertions(+), 1 deletion(-)

diff --git a/wp-includes/class-wp-xmlrpc-server.php b/wp-includes/class-wp-xmlrpc-server.php
index 7bbde05c2bd9..9b80f0dfe1c1 100644
--- a/wp-includes/class-wp-xmlrpc-server.php
+++ b/wp-includes/class-wp-xmlrpc-server.php
@@ -382,6 +382,11 @@ public function set_custom_fields($post_id, $fields) {
 			if ( isset($meta['id']) ) {
 				$meta['id'] = (int) $meta['id'];
 				$pmeta = get_metadata_by_mid( 'post', $meta['id'] );
+
+				if ( ! $pmeta || $pmeta->post_id != $post_id ) {
+					continue;
+				}
+
 				if ( isset($meta['key']) ) {
 					$meta['key'] = wp_unslash( $meta['key'] );
 					if ( $meta['key'] !== $pmeta->meta_key )
diff --git a/wp-includes/version.php b/wp-includes/version.php
index 9b17c304678d..616c75e14839 100644
--- a/wp-includes/version.php
+++ b/wp-includes/version.php
@@ -4,7 +4,7 @@
  *
  * @global string $wp_version
  */
-$wp_version = '4.8-beta1-40689';
+$wp_version = '4.8-beta1-40692';
 
 /**
  * Holds the WordPress DB revision, increments when changes are made to the WordPress DB schema.
