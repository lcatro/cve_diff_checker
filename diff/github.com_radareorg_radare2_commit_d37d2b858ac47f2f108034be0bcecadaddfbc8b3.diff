From d37d2b858ac47f2f108034be0bcecadaddfbc8b3 Mon Sep 17 00:00:00 2001
From: radare <pancake@nopcode.org>
Date: Mon, 25 Jun 2018 00:07:45 +0200
Subject: [PATCH] Fix #10465 - Avoid string on low addresses (workaround) for
 corrupted dwarf (#10478)

---
 libr/bin/dwarf.c | 6 +++++-
 1 file changed, 5 insertions(+), 1 deletion(-)

diff --git a/libr/bin/dwarf.c b/libr/bin/dwarf.c
index edd062c7ba9..7b9ca6bfc80 100644
--- a/libr/bin/dwarf.c
+++ b/libr/bin/dwarf.c
@@ -1361,7 +1361,11 @@ static const ut8 *r_bin_dwarf_parse_comp_unit(Sdb *s, const ut8 *obuf,
 					&cu->hdr, debug_str, debug_str_len);
 			if (cu->dies[cu->length].attr_values[i].name == DW_AT_comp_dir) {
 				const char *name = cu->dies[cu->length].attr_values[i].encoding.str_struct.string;
-				sdb_set (s, "DW_AT_comp_dir", name, 0);
+				if (name > 1024) { // solve some null derefs
+					sdb_set (s, "DW_AT_comp_dir", name, 0);
+				} else {
+					eprintf ("Invalid string pointer at %p\n", name);
+				}
 			}
 			cu->dies[cu->length].length++;
 		}
