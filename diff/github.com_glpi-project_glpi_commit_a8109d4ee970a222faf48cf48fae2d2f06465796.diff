From a8109d4ee970a222faf48cf48fae2d2f06465796 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?C=C3=A9dric=20Anne?= <cedric.anne@gmail.com>
Date: Tue, 6 Oct 2020 13:58:15 +0200
Subject: [PATCH] Merge pull request from GHSA-prvh-9m4h-4m79

---
 install/install.php | 9 ++++++++-
 1 file changed, 8 insertions(+), 1 deletion(-)

diff --git a/install/install.php b/install/install.php
index 8c7cc5a80b6..f10834b58ba 100644
--- a/install/install.php
+++ b/install/install.php
@@ -598,10 +598,17 @@ function checkConfigFile() {
    }
 }
 
-if (!isset($_POST["install"])) {
+if (!isset($_SESSION['can_process_install']) || !isset($_POST["install"])) {
    $_SESSION = [];
 
    checkConfigFile();
+
+   // Add a flag that will be used to validate that installation can be processed.
+   // This flag is put here just after checking that DB config file does not exist yet.
+   // It is mandatory to validate that `Etape_4` to `Etape_6` are not used outside installation process
+   // to change GLPI base URL without even being authenticated.
+   $_SESSION['can_process_install'] = true;
+
    header_html("Select your language");
    choose_language();
 
