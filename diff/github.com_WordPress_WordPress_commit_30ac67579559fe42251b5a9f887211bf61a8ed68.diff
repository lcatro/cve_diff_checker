From 30ac67579559fe42251b5a9f887211bf61a8ed68 Mon Sep 17 00:00:00 2001
From: desrosj <desrosj@git.wordpress.org>
Date: Wed, 4 Sep 2019 17:52:56 +0000
Subject: [PATCH] Fix for URL sanitization that can lead to cross-site
 scripting (XSS) attacks.

Props irsdl, sstoqnov, whyisjake.
Built from https://develop.svn.wordpress.org/trunk@45997


git-svn-id: http://core.svn.wordpress.org/trunk@45808 1a063a9b-81f0-0310-95a4-ce76da25c4cd
---
 wp-includes/kses.php    | 1 +
 wp-includes/version.php | 2 +-
 2 files changed, 2 insertions(+), 1 deletion(-)

diff --git a/wp-includes/kses.php b/wp-includes/kses.php
index b707dca81392..797594937069 100644
--- a/wp-includes/kses.php
+++ b/wp-includes/kses.php
@@ -1664,6 +1664,7 @@ function wp_kses_html_error( $string ) {
  * @return string Sanitized content.
  */
 function wp_kses_bad_protocol_once( $string, $allowed_protocols, $count = 1 ) {
+	$string  = preg_replace( '/(&#0*58(?![;0-9])|&#x0*3a(?![;a-f0-9]))/i', '$1;', $string );
 	$string2 = preg_split( '/:|&#0*58;|&#x0*3a;/i', $string, 2 );
 	if ( isset( $string2[1] ) && ! preg_match( '%/\?%', $string2[0] ) ) {
 		$string   = trim( $string2[1] );
diff --git a/wp-includes/version.php b/wp-includes/version.php
index f0c3f56b0d91..b4e1f225caa9 100644
--- a/wp-includes/version.php
+++ b/wp-includes/version.php
@@ -13,7 +13,7 @@
  *
  * @global string $wp_version
  */
-$wp_version = '5.3-alpha-45990';
+$wp_version = '5.3-alpha-45997';
 
 /**
  * Holds the WordPress DB revision, increments when changes are made to the WordPress DB schema.
