From 270f05ca6e51c87bb0867abb0511b61bf2aae182 Mon Sep 17 00:00:00 2001
From: BuffaloWill <wvandevanter@gmail.com>
Date: Tue, 31 Dec 2019 11:51:41 -0500
Subject: [PATCH] rack protection updates

---
 views/add_user.haml        | 1 +
 views/add_user_report.haml | 5 +++--
 views/list_user.haml       | 6 ++++--
 3 files changed, 8 insertions(+), 4 deletions(-)

diff --git a/views/add_user.haml b/views/add_user.haml
index adc940b..3139a1a 100644
--- a/views/add_user.haml
+++ b/views/add_user.haml
@@ -50,6 +50,7 @@
           %option Administrator
 
   %br
+  %input#authenticity-token{:type => "hidden", :name => "authenticity_token", :value => "#{env['rack.session'][:csrf]}" }
   %input.btn.btn-primary{ :type => "submit", :value => "Add" }
   %a.btn.btn-secondary{ :href => "/admin/list_user" }
     Cancel
diff --git a/views/add_user_report.haml b/views/add_user_report.haml
index f79a784..e7937f0 100644
--- a/views/add_user_report.haml
+++ b/views/add_user_report.haml
@@ -1,5 +1,5 @@
 .d-flex.justify-content-between.flex-wrap.flex-md-nowrap.align-items-center.pt-3.pb-2.mb-3.border-bottom
-  %h1.h2 Editing #{@report.report_name} Report
+  %h1.h2 Editing #{@report.report_name} Report FFFF
 
 %h2.h4 Current Authors
 .table-responsive.col-6.px-0
@@ -14,7 +14,8 @@
         - @report.authors.each do |user|
           %tr
             %td
-              #{user}
+              :escaped
+                #{user}
             %td.text-right
               %a.btn.btn-sm.btn-danger{ :href => "/admin/del_user_report/#{@report.id}/#{user}" }
                 %i.far.fa-trash-alt{ :title => "Remove Author" }
diff --git a/views/list_user.haml b/views/list_user.haml
index 782d843..cd0d01f 100644
--- a/views/list_user.haml
+++ b/views/list_user.haml
@@ -16,9 +16,11 @@
         - @users.each do |user|
           %tr
             %td
-              #{user.username}
+              :escaped
+                #{user.username}
             %td
-              #{user.type} / #{user.auth_type}
+              :escaped
+                #{user.type} / #{user.auth_type}
             %td.text-right
               %a.btn.btn-sm.btn-warning{ :href => "/admin/edit_user/#{user.id}" }
                 %i.fas.fa-pencil-alt{ :title => "Edit Password" }
