From 8279c5818425b6812523e3805bbe242fb6a5d961 Mon Sep 17 00:00:00 2001
From: Ryan Gonzalez <rymg19@gmail.com>
Date: Tue, 2 Mar 2021 13:20:07 -0600
Subject: [PATCH] Disallow @@ and @@u usage in desktop files

Fixes #4146.

(cherry picked from commit 652a28ffab67cb6cd7d12dc3a93979bcd3731c7f)
---
 common/flatpak-dir.c | 2 ++
 1 file changed, 2 insertions(+)

diff --git a/common/flatpak-dir.c b/common/flatpak-dir.c
index 507a71b124..82f2ce68a4 100644
--- a/common/flatpak-dir.c
+++ b/common/flatpak-dir.c
@@ -7139,6 +7139,8 @@ export_desktop_file (const char         *app,
                 g_string_append_printf (new_exec, " @@ %s @@", arg);
               else if (strcasecmp (arg, "%u") == 0)
                 g_string_append_printf (new_exec, " @@u %s @@", arg);
+              else if (strcmp (arg, "@@") == 0 || strcmp (arg, "@@u") == 0)
+                g_print (_("Skipping invalid Exec argument %s\n"), arg);
               else
                 g_string_append_printf (new_exec, " %s", arg);
             }
