From 4155bfe068bf211b49a0b3ffd06e78cbaf1b40fa Mon Sep 17 00:00:00 2001
From: omphalos <omph.alos@yahoo.com>
Date: Wed, 14 Feb 2018 17:29:21 -0600
Subject: [PATCH] Fix not sanitizing file names rendered in html

---
 crud-file-server.js | 4 +++-
 1 file changed, 3 insertions(+), 1 deletion(-)

diff --git a/crud-file-server.js b/crud-file-server.js
index ad8ae00..c6147c2 100644
--- a/crud-file-server.js
+++ b/crud-file-server.js
@@ -140,7 +140,9 @@ exports.handleRequest = function(vpath, path, req, res, readOnly, logHeadRequest
 															var name = results[f].name;
 															var normalized = url + '/' + name;
 															while(normalized[0] == '/') { normalized = normalized.slice(1, normalized.length); }
-															res.write('\r\n<p><a href="/' + normalized + '">' + name + '</a></p>');
+															if(normalized.indexOf('"') >= 0) throw new Error('unsupported file name')
+															name = name.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;');
+															res.write('\r\n<p><a href="/' + normalized + '"><span>' + name + '</span></a></p>');
 														}
 														res.end('\r\n</body></html>');
 													}
