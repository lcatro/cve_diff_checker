From b280beae2e0de37b9e998c31c5d1839852724fc1 Mon Sep 17 00:00:00 2001
From: Remigijus Kiminas <remdex@gmail.com>
Date: Mon, 27 Dec 2021 01:37:08 -0500
Subject: [PATCH] Disable to change city database location

---
 .../defaulttheme/tpl/lhchat/geoconfiguration.tpl.php     | 4 ++--
 lhc_web/ezcomponents/Base/src/file.php                   | 2 +-
 lhc_web/ezcomponents/ConsoleTools/src/input/option.php   | 4 ++--
 lhc_web/modules/lhchat/geoconfiguration.php              | 9 +++------
 4 files changed, 8 insertions(+), 11 deletions(-)

diff --git a/lhc_web/design/defaulttheme/tpl/lhchat/geoconfiguration.tpl.php b/lhc_web/design/defaulttheme/tpl/lhchat/geoconfiguration.tpl.php
index e4cbac9c7..b1756f808 100644
--- a/lhc_web/design/defaulttheme/tpl/lhchat/geoconfiguration.tpl.php
+++ b/lhc_web/design/defaulttheme/tpl/lhchat/geoconfiguration.tpl.php
@@ -128,8 +128,8 @@
       	</p>
 
       	                        <div class="form-group">
-								    <label><?php echo erTranslationClassLhTranslation::getInstance()->getTranslation('chat/onlineusers','Location of city database'); ?></label> 
-								    <input class="form-control" type="text" name="CityGeoLocation" value="<?php isset($geo_data['max_mind_city_location']) && ($geo_data['max_mind_city_location'] != '') ?  print htmlspecialchars($geo_data['max_mind_city_location']) : print 'var/external/geoip/GeoLite2-City.mmdb' ?>" />
+								    <label><?php echo erTranslationClassLhTranslation::getInstance()->getTranslation('chat/onlineusers','Location of city database. Make sure you uploaded file in this location.'); ?></label>
+								    <input class="form-control" type="text" readonly value="<?php isset($geo_data['max_mind_city_location']) && ($geo_data['max_mind_city_location'] != '') ?  print htmlspecialchars($geo_data['max_mind_city_location']) : print 'var/external/geoip/GeoLite2-City.mmdb' ?>" />
                                 </div>
 								
 								<div class="row">
diff --git a/lhc_web/ezcomponents/Base/src/file.php b/lhc_web/ezcomponents/Base/src/file.php
index 843399c79..9d5329b9f 100644
--- a/lhc_web/ezcomponents/Base/src/file.php
+++ b/lhc_web/ezcomponents/Base/src/file.php
@@ -110,7 +110,7 @@ static protected function findRecursiveCallback( ezcBaseFileFindContext $context
      *         not be opened for reading.
      * @return array
      */
-    static public function walkRecursive( $sourceDir, array $includeFilters = array(), array $excludeFilters = array(), $callback, &$callbackContext )
+    static public function walkRecursive( $sourceDir, array $includeFilters, array $excludeFilters, $callback, &$callbackContext )
     {
         if ( !is_dir( $sourceDir ) )
         {
diff --git a/lhc_web/ezcomponents/ConsoleTools/src/input/option.php b/lhc_web/ezcomponents/ConsoleTools/src/input/option.php
index 447688efd..e9d4f03a6 100644
--- a/lhc_web/ezcomponents/ConsoleTools/src/input/option.php
+++ b/lhc_web/ezcomponents/ConsoleTools/src/input/option.php
@@ -147,8 +147,8 @@ class ezcConsoleOption
      *                                              sign or contain whitespaces.
      */
     public function __construct( 
-        $short = '', 
-        $long, 
+        $short = '',
+        $long = '',
         $type = ezcConsoleInput::TYPE_NONE, 
         $default = null, 
         $multiple = false,
diff --git a/lhc_web/modules/lhchat/geoconfiguration.php b/lhc_web/modules/lhchat/geoconfiguration.php
index 18d6f516f..dc90e67ec 100644
--- a/lhc_web/modules/lhchat/geoconfiguration.php
+++ b/lhc_web/modules/lhchat/geoconfiguration.php
@@ -109,9 +109,6 @@
         'MaxMindDetectionType' => new ezcInputFormDefinitionElement(
             ezcInputFormDefinitionElement::OPTIONAL, 'string'
         ),
-        'CityGeoLocation' => new ezcInputFormDefinitionElement(
-            ezcInputFormDefinitionElement::OPTIONAL, 'string'
-        ),
         'ipapi_key' => new ezcInputFormDefinitionElement(
             ezcInputFormDefinitionElement::OPTIONAL, 'string'
         ),
@@ -198,15 +195,15 @@
             } elseif ($form->UseGeoIP == 'max_mind') {
                 $data['geo_service_identifier'] = 'max_mind';                
                 $data['max_mind_detection_type'] = $form->hasValidData('MaxMindDetectionType') ? $form->MaxMindDetectionType : 'city';
-                $data['max_mind_city_location'] = $form->CityGeoLocation != '' ? $form->CityGeoLocation : 'var/external/geoip/GeoLite2-City.mmdb';
-                          
+                $data['max_mind_city_location'] = 'var/external/geoip/GeoLite2-City.mmdb';
+
                 if ($data['max_mind_detection_type'] == 'city' && !file_exists($data['max_mind_city_location'])) {
                 	$Errors[] = erTranslationClassLhTranslation::getInstance()->getTranslation('chat/onlineusers','MaxMind city file does not exists!');
                 } elseif (!file_exists('var/external/geoip/GeoLite2-Country.mmdb')) {
                 	$data['max_mind_detection_type'] = 'country';
                 	$Errors[] = erTranslationClassLhTranslation::getInstance()->getTranslation('chat/onlineusers','MaxMind country file does not exists!');
                 }
-                
+
                 if (empty($Errors)) {
 	                $responseDetection = erLhcoreClassModelChatOnlineUser::getUserData('max_mind','94.23.200.91',array('city_file' => $data['max_mind_city_location'],'detection_type' => $data['max_mind_detection_type']));                
 	                if ( $responseDetection == false || !isset($responseDetection->country_code) || !isset($responseDetection->country_name) ) {
