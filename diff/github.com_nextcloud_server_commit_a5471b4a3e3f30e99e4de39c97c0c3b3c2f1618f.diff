From a5471b4a3e3f30e99e4de39c97c0c3b3c2f1618f Mon Sep 17 00:00:00 2001
From: Joas Schilling <coding@schilljs.com>
Date: Wed, 3 Aug 2016 09:22:18 +0200
Subject: [PATCH] Do not allow to delete/update group shares as a group member

---
 apps/files_sharing/api/share20ocs.php | 9 +++++----
 1 file changed, 5 insertions(+), 4 deletions(-)

diff --git a/apps/files_sharing/api/share20ocs.php b/apps/files_sharing/api/share20ocs.php
index 01cb15a8ac87..6a5a1546c32b 100644
--- a/apps/files_sharing/api/share20ocs.php
+++ b/apps/files_sharing/api/share20ocs.php
@@ -240,7 +240,7 @@ public function deleteShare($id) {
 			}
 		}
 
-		if (!$this->canAccessShare($share)) {
+		if (!$this->canAccessShare($share, false)) {
 			return new \OC_OCS_Result(null, 404, 'could not delete share');
 		}
 
@@ -564,7 +564,7 @@ public function updateShare($id) {
 			}
 		}
 
-		if (!$this->canAccessShare($share)) {
+		if (!$this->canAccessShare($share, false)) {
 			return new \OC_OCS_Result(null, 404, 'wrong share Id, share doesn\'t exist.');
 		}
 
@@ -669,9 +669,10 @@ public function updateShare($id) {
 
 	/**
 	 * @param \OCP\Share\IShare $share
+	 * @param bool $checkGroups
 	 * @return bool
 	 */
-	protected function canAccessShare(\OCP\Share\IShare $share) {
+	protected function canAccessShare(\OCP\Share\IShare $share, $checkGroups = true) {
 		// A file with permissions 0 can't be accessed by us. So Don't show it
 		if ($share->getPermissions() === 0) {
 			return false;
@@ -690,7 +691,7 @@ protected function canAccessShare(\OCP\Share\IShare $share) {
 			return true;
 		}
 
-		if ($share->getShareType() === \OCP\Share::SHARE_TYPE_GROUP) {
+		if ($checkGroups && $share->getShareType() === \OCP\Share::SHARE_TYPE_GROUP) {
 			$sharedWith = $this->groupManager->get($share->getSharedWith());
 			if ($sharedWith->inGroup($this->currentUser)) {
 				return true;
