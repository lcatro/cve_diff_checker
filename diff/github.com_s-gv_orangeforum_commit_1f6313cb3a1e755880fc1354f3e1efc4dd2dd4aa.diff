From 1f6313cb3a1e755880fc1354f3e1efc4dd2dd4aa Mon Sep 17 00:00:00 2001
From: Sagar Gubbi <sagar.writeme@gmail.com>
Date: Sun, 4 Mar 2018 00:37:49 +0530
Subject: [PATCH] Fix open redirection

---
 views/auth.go | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

diff --git a/views/auth.go b/views/auth.go
index ae8568c..159a02d 100644
--- a/views/auth.go
+++ b/views/auth.go
@@ -20,7 +20,7 @@ import (
 
 var LoginHandler = UA(func(w http.ResponseWriter, r *http.Request, sess Session) {
 	redirectURL, err := url.QueryUnescape(r.FormValue("next"))
-	if redirectURL == "" || err != nil {
+	if err != nil || redirectURL == "" || redirectURL[0] != '/' {
 		redirectURL = "/"
 	}
 	if sess.IsUserValid() {
@@ -59,7 +59,7 @@ func LogoutHandler(w http.ResponseWriter, r *http.Request) {
 
 var SignupHandler = UA(func(w http.ResponseWriter, r *http.Request, sess Session) {
 	redirectURL, err := url.QueryUnescape(r.FormValue("next"))
-	if redirectURL == "" || err != nil {
+	if err != nil || redirectURL == "" || redirectURL[0] != '/' {
 		redirectURL = "/"
 	}
 	if sess.IsUserValid() && !sess.IsUserSuperAdmin() {
