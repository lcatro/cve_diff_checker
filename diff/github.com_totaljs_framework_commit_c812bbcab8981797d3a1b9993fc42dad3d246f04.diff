From c812bbcab8981797d3a1b9993fc42dad3d246f04 Mon Sep 17 00:00:00 2001
From: Peter Sirka <petersirka@gmail.com>
Date: Sun, 21 Feb 2021 23:59:45 +0100
Subject: [PATCH] Fixed potential vulnerability in `U.set()` method.

---
 changes.txt | 1 +
 utils.js    | 4 ++--
 2 files changed, 3 insertions(+), 2 deletions(-)

diff --git a/changes.txt b/changes.txt
index bb2194e6..9b739d45 100755
--- a/changes.txt
+++ b/changes.txt
@@ -1,6 +1,7 @@
 ======= 3.4.9
 
 - fixed measuring dimension for `.gif` images
+- fixed potential remote code execution in `U.set()` founded by [Snyk](https://snyk.io/vuln)
 
 ======= 3.4.7
 
diff --git a/utils.js b/utils.js
index 91695434..1a5512cc 100755
--- a/utils.js
+++ b/utils.js
@@ -6622,8 +6622,8 @@ exports.set = function(obj, path, value) {
 	var ispush = v.lastIndexOf('[]') !== -1;
 	var a = builder.join(';') + ';var v=typeof(a)===\'function\'?a(U.get(b)):a;w' + (v[0] === '[' ? '' : '.') + (ispush ? v.replace(REGREPLACEARR, '.push(v)') : (v + '=v')) + ';return v';
 
-	if ((/__proto__|constructor|prototype/).test(a))
-		throw new Error('Prototype pollution');
+	if ((/__proto__|constructor|prototype|eval/).test(a))
+		throw new Error('Potential vulnerability');
 
 	var fn = new Function('w', 'a', 'b', a);
 	F.temporary.other[cachekey] = fn;
