From 9659f9b7ce15a723da8e361bd41b9203b19c97de Mon Sep 17 00:00:00 2001
From: Pierre RAMBAUD <pierre.rambaud86@gmail.com>
Date: Tue, 14 Nov 2017 13:03:20 +0100
Subject: [PATCH] Security Fix again, thanks to Yasin Soliman

---
 Gemfile.lock          |  2 +-
 lib/gemirro/server.rb | 11 +++++++++++
 views/gem.erb         |  2 +-
 3 files changed, 13 insertions(+), 2 deletions(-)

diff --git a/Gemfile.lock b/Gemfile.lock
index 97dd6cf..fc73164 100644
--- a/Gemfile.lock
+++ b/Gemfile.lock
@@ -1,7 +1,7 @@
 PATH
   remote: .
   specs:
-    gemirro (0.14.0)
+    gemirro (0.15.0)
       builder (~> 3.2)
       confstruct (~> 1.0)
       erubis (~> 2.7)
diff --git a/lib/gemirro/server.rb b/lib/gemirro/server.rb
index 34b68fc..94ce663 100644
--- a/lib/gemirro/server.rb
+++ b/lib/gemirro/server.rb
@@ -1,5 +1,6 @@
 require 'sinatra/base'
 require 'thin'
+require 'uri'
 
 module Gemirro
   ##
@@ -271,6 +272,16 @@ def spec_for(gemname, version, platform = 'ruby')
       def escape(string)
         Rack::Utils.escape_html(string)
       end
+
+      ##
+      # Homepage link
+      #
+      # @param [Gem] spec
+      # @return [String]
+      #
+      def homepage(spec)
+        URI.parse(URI.escape(spec.homepage))
+      end
     end
   end
 end
diff --git a/views/gem.erb b/views/gem.erb
index be977a2..bce197a 100644
--- a/views/gem.erb
+++ b/views/gem.erb
@@ -31,7 +31,7 @@
             <ul class="list-group">
               <% spec.authors.each do |author| %>
                 <li class="list-group-item">
-                  <a href="<%= escape(spec.homepage) %>"><%= escape(author) %></a>
+                  <a href="<%= homepage(spec) %>"><%= escape(author) %></a>
                 </li>
               <% end %>
             </ul>
