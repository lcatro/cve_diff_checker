From d04c78773f6959bcb427453f8e5b9824d5ba9eff Mon Sep 17 00:00:00 2001
From: pancake <pancake@nopcode.org>
Date: Tue, 15 May 2018 14:44:47 +0200
Subject: [PATCH] Fix #10091 - crash in AVR analysis

---
 libr/anal/p/anal_avr.c | 3 +++
 1 file changed, 3 insertions(+)

diff --git a/libr/anal/p/anal_avr.c b/libr/anal/p/anal_avr.c
index 93d72ce52ad..3b453f14a1f 100644
--- a/libr/anal/p/anal_avr.c
+++ b/libr/anal/p/anal_avr.c
@@ -925,6 +925,9 @@ INST_HANDLER (lds) {	// LDS Rd, k
 }
 
 INST_HANDLER (sts) {	// STS k, Rr
+	if (len < 4) {
+		return;
+	}
 	int r = ((buf[0] >> 4) & 0xf) | ((buf[1] & 0x1) << 4);
 	int k = (buf[3] << 8) | buf[2];
 	op->ptr = k;
