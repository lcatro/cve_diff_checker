From f70ca0749ac280dbe7df10efb90faf736af8f07a Mon Sep 17 00:00:00 2001
From: Pierre RAMBAUD <pierre.rambaud@prestashop.com>
Date: Thu, 28 May 2020 18:39:06 +0200
Subject: [PATCH] Protect the composer.lock file and remove docker-compose.yml
 in the zip archive

---
 classes/Tools.php                      | 12 ++++++++++++
 tools/build/Library/ReleaseCreator.php |  2 +-
 2 files changed, 13 insertions(+), 1 deletion(-)

diff --git a/classes/Tools.php b/classes/Tools.php
index 93b365c62980..17919672bb39 100644
--- a/classes/Tools.php
+++ b/classes/Tools.php
@@ -2647,7 +2647,19 @@ public static function generateHtaccess($path = null, $rewrite_settings = null,
 		Header set Access-Control-Allow-Origin \"*\"
 	</FilesMatch>
 </IfModule>\n\n");
+        fwrite($write_fd, "<Files composer.lock>
+    # Apache 2.2
+    <IfModule !mod_authz_core.c>
+        Order deny,allow
+        Deny from all
+    </IfModule>
 
+    # Apache 2.4
+    <IfModule mod_authz_core.c>
+        Require all denied
+    </IfModule>
+</Files>
+");
         // Cache control
         if ($cache_control) {
             $cache_control = "<IfModule mod_expires.c>
diff --git a/tools/build/Library/ReleaseCreator.php b/tools/build/Library/ReleaseCreator.php
index 2a761021d369..a7d4664c1ae2 100644
--- a/tools/build/Library/ReleaseCreator.php
+++ b/tools/build/Library/ReleaseCreator.php
@@ -140,7 +140,7 @@ class ReleaseCreator
         '\.eslintignore$',
         '\.eslintrc\.js$',
         '\.php_cs\.dist$',
-        '\.docker-compose\.yml$',
+        'docker-compose\.yml$',
         'tools/assets$',
         '\.webpack$',
     ];
