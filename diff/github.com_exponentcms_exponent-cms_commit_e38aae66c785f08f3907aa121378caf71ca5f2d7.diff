From e38aae66c785f08f3907aa121378caf71ca5f2d7 Mon Sep 17 00:00:00 2001
From: dleffler <dleffler@hughes.net>
Date: Sat, 5 Nov 2016 15:31:58 -0400
Subject: [PATCH] Prevent logged in uses from view other user records and
 admins from super-admin records; thanks to pang0lin

---
 .../users/controllers/usersController.php     | 19 +++++++++++++++++++
 1 file changed, 19 insertions(+)

diff --git a/framework/modules/users/controllers/usersController.php b/framework/modules/users/controllers/usersController.php
index 73820bb6b3..352c982c4e 100755
--- a/framework/modules/users/controllers/usersController.php
+++ b/framework/modules/users/controllers/usersController.php
@@ -62,6 +62,25 @@ static function canImportData() {
         return true;
     }
 
+    public function show() {
+        global $user;
+
+        $id = !empty($this->params['id']) ? $this->params['id'] : null;
+
+        // check to see if we should be editing.  You either need to be an admin, or viewing own account.
+        if ($user->isAdmin() || ($user->id == $id)) {
+            $u = new user($id);
+            if ($u->isSuperAdmin() && $user->isActingAdmin()) {
+                flash('error', gt('You do not have the proper permissions to view this record'));
+                expHistory::back();
+            }
+            parent::show();
+        } else {
+            flash('error', gt('You do not have the proper permissions to view this record'));
+            expHistory::back();
+        }
+    }
+
     public function manage() {
         global $user;
 
