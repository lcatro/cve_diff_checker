From 1c581a072651524f3b0d91f33e22a42c4166dd96 Mon Sep 17 00:00:00 2001
From: "Jason A. Donenfeld" <Jason@zx2c4.com>
Date: Thu, 14 Jan 2016 14:31:13 +0100
Subject: ui-blob: Do not accept mimetype from user

---
 cgit.c    | 2 --
 cgit.h    | 1 -
 ui-blob.c | 1 -
 3 files changed, 4 deletions(-)

diff --git a/cgit.c b/cgit.c
index 05e5d57..3ed1935 100644
--- a/cgit.c
+++ b/cgit.c
@@ -314,8 +314,6 @@ static void querystring_cb(const char *name, const char *value)
 		ctx.qry.path = trim_end(value, '/');
 	} else if (!strcmp(name, "name")) {
 		ctx.qry.name = xstrdup(value);
-	} else if (!strcmp(name, "mimetype")) {
-		ctx.qry.mimetype = xstrdup(value);
 	} else if (!strcmp(name, "s")) {
 		ctx.qry.sort = xstrdup(value);
 	} else if (!strcmp(name, "showmsg")) {
diff --git a/cgit.h b/cgit.h
index b7eccdd..4b4bcf4 100644
--- a/cgit.h
+++ b/cgit.h
@@ -173,7 +173,6 @@ struct cgit_query {
 	char *sha2;
 	char *path;
 	char *name;
-	char *mimetype;
 	char *url;
 	char *period;
 	int   ofs;
diff --git a/ui-blob.c b/ui-blob.c
index 1ded839..2cce11c 100644
--- a/ui-blob.c
+++ b/ui-blob.c
@@ -161,7 +161,6 @@ void cgit_print_blob(const char *hex, char *path, const char *head, int file_onl
 	}
 
 	buf[size] = '\0';
-	ctx.page.mimetype = ctx.qry.mimetype;
 	if (!ctx.page.mimetype) {
 		if (buffer_is_binary(buf, size))
 			ctx.page.mimetype = "application/octet-stream";
-- 
cgit v1.2.3-11-g984f

