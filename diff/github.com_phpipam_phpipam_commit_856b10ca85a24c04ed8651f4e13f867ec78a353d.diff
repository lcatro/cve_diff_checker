From 856b10ca85a24c04ed8651f4e13f867ec78a353d Mon Sep 17 00:00:00 2001
From: Gary Allan <github@gallan.co.uk>
Date: Tue, 4 Dec 2018 19:48:37 +0000
Subject: [PATCH] Bugfix: Possible SQL injection in nat/item-add-submit.php.
 Fixes #2344

---
 app/admin/nat/item-add-submit.php | 6 ++++++
 misc/CHANGELOG                    | 1 +
 2 files changed, 7 insertions(+)

diff --git a/app/admin/nat/item-add-submit.php b/app/admin/nat/item-add-submit.php
index d95414ac2..7e7033023 100644
--- a/app/admin/nat/item-add-submit.php
+++ b/app/admin/nat/item-add-submit.php
@@ -91,6 +91,12 @@
     $nat_id   = $_POST['id'];               // nat id
     $nat_type = $_POST['type'];             // src, dst
 
+    // validate object type
+    if (!in_array($obj_type, ['subnets', 'ipaddresses'])) { $Result->show("danger", _("Invalid object type"), true); }
+
+    // validate object id
+    if (!is_numeric($obj_id)) { $Result->show("danger", _("Invalid object id"), true); }
+
     // validate object
     $item = $Tools->fetch_object ($obj_type, "id", $obj_id);
     if($item!==false) {
diff --git a/misc/CHANGELOG b/misc/CHANGELOG
index fa0f856c6..1ba61b926 100755
--- a/misc/CHANGELOG
+++ b/misc/CHANGELOG
@@ -51,6 +51,7 @@
     + Hide LDAP/AD/Radius username / password and secret from logs and syslog (#2006);
     + XSS in phpipamredirect cookie (#2338);
     + XSS in print-user.php, CSRF in user-edit.php (#2326);
+    + Possible SQL injection in nat/item-add-submit.php (#2344);
 
 == 1.3.2
 
