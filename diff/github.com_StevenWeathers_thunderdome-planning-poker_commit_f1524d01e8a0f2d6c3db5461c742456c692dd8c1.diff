From f1524d01e8a0f2d6c3db5461c742456c692dd8c1 Mon Sep 17 00:00:00 2001
From: Steven Weathers <steven@weathers.me>
Date: Mon, 1 Nov 2021 20:48:52 -0400
Subject: [PATCH] Fix LDAP vulnerability

---
 auth.go | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/auth.go b/auth.go
index 8f74555a..43cb1415 100644
--- a/auth.go
+++ b/auth.go
@@ -68,7 +68,7 @@ func (s *server) authAndCreateUserLdap(UserName string, UserPassword string) (*d
 
 	searchRequest := ldap.NewSearchRequest(viper.GetString("auth.ldap.basedn"),
 		ldap.ScopeWholeSubtree, ldap.NeverDerefAliases, 0, 0, false,
-		fmt.Sprintf(viper.GetString("auth.ldap.filter"), UserName),
+		fmt.Sprintf(viper.GetString("auth.ldap.filter"), ldap.EscapeFilter(UserName)),
 		[]string{"dn", viper.GetString("auth.ldap.mail_attr"), viper.GetString("auth.ldap.cn_attr")},
 		nil,
 	)
