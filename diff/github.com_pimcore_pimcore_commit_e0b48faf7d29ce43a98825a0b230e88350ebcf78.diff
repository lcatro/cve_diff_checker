From e0b48faf7d29ce43a98825a0b230e88350ebcf78 Mon Sep 17 00:00:00 2001
From: Bernhard Rusch <bernhard.rusch@elements.at>
Date: Wed, 30 Oct 2019 17:00:19 +0100
Subject: [PATCH] [Email] Email log: do not allow script/iframe execution in
 preview window

---
 bundles/AdminBundle/Controller/Admin/EmailController.php | 4 +++-
 1 file changed, 3 insertions(+), 1 deletion(-)

diff --git a/bundles/AdminBundle/Controller/Admin/EmailController.php b/bundles/AdminBundle/Controller/Admin/EmailController.php
index 15002770f59..ff08a3bbc79 100644
--- a/bundles/AdminBundle/Controller/Admin/EmailController.php
+++ b/bundles/AdminBundle/Controller/Admin/EmailController.php
@@ -133,7 +133,9 @@ public function showEmailLogAction(Request $request, ?Profiler $profiler)
 
             return new Response('<html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><style>body{background-color:#fff;}</style></head><body><pre>' . $templatingEnginePhp->escape($emailLog->getTextLog()) . '</pre></body></html>');
         } elseif ($request->get('type') == 'html') {
-            return new Response($emailLog->getHtmlLog());
+            return new Response($emailLog->getHtmlLog(), 200, [
+                'Content-Security-Policy' => "default-src 'self'; style-src 'self' 'unsafe-inline'"
+            ]);
         } elseif ($request->get('type') == 'params') {
             try {
                 $params = $this->decodeJson($emailLog->getParams());
