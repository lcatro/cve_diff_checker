From 20d9020b76d1f6790c4d84e020d0cc97c929f66b Mon Sep 17 00:00:00 2001
From: Luciano Righetti <luciano.righetti@gmail.com>
Date: Thu, 19 Aug 2021 14:53:10 +0200
Subject: [PATCH] security: fix unescaped parameter leading to sqli

---
 app/Model/Log.php | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/app/Model/Log.php b/app/Model/Log.php
index 71708f621a..4e0d25775e 100644
--- a/app/Model/Log.php
+++ b/app/Model/Log.php
@@ -174,7 +174,7 @@ public function returnDates($org = 'all')
             // cakephp ORM would escape "DATE" datatype in CAST expression
             $condnotinaction = "'" . implode("', '", $conditions['AND']['NOT']['action']) . "'";
             if (!empty($conditions['org'])) {
-                $condOrg = ' AND org = "' . $conditions['org'] . '"';
+                $condOrg = sprintf('AND org = %s', $this->getDataSource()->value($conditions['org']));
             } else {
                 $condOrg = '';
             }
