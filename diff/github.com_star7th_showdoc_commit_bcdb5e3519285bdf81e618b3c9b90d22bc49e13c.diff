From bcdb5e3519285bdf81e618b3c9b90d22bc49e13c Mon Sep 17 00:00:00 2001
From: star7th <xing7th@gmail.com>
Date: Wed, 28 Nov 2018 10:13:59 +0800
Subject: [PATCH] Update CatalogController.class.php

---
 .../Application/Api/Controller/CatalogController.class.php | 7 ++++++-
 1 file changed, 6 insertions(+), 1 deletion(-)

diff --git a/server/Application/Api/Controller/CatalogController.class.php b/server/Application/Api/Controller/CatalogController.class.php
index 700f0bde..fe06fadb 100644
--- a/server/Application/Api/Controller/CatalogController.class.php
+++ b/server/Application/Api/Controller/CatalogController.class.php
@@ -112,7 +112,12 @@ public function save(){
         }
 
         if ($cat_id > 0 ) {
-            
+            $cat = D("Catalog")->where(" cat_id = '$cat_id' ")->find();
+            $item_id = $cat['item_id']; 
+            if (!$this->checkItemPermn($login_user['uid'] , $item_id)) {
+                $this->sendError(10103);
+                return;
+            }
             //如果一个目录已经是别的目录的父目录，那么它将无法再转为level4目录
             if (D("Catalog")->where(" parent_cat_id = '$cat_id' ")->find() && $data['level'] == 4 ) {
                 $this->sendError(10101,"该目录含有子目录，不允许转为底层目录。");
