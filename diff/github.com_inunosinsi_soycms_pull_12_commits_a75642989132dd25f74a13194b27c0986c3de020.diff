From a75642989132dd25f74a13194b27c0986c3de020 Mon Sep 17 00:00:00 2001
From: stypr <me@harold.kim>
Date: Tue, 15 Sep 2020 14:57:06 +0900
Subject: [PATCH] Fix unserialize/serialize to json decode/encode

---
 cms/app/webapp/inquiry/page.php | 22 +++++++++++-----------
 1 file changed, 11 insertions(+), 11 deletions(-)

diff --git a/cms/app/webapp/inquiry/page.php b/cms/app/webapp/inquiry/page.php
index 1ef2241ee..47571fa17 100755
--- a/cms/app/webapp/inquiry/page.php
+++ b/cms/app/webapp/inquiry/page.php
@@ -128,7 +128,7 @@ function getForm($formId){
 
 	    	//不正な書き換えでない場合のみ
 	    	if(md5($value) == $_POST["form_hash"]){
-	    		$_POST["data"] = unserialize($value);
+	    		$_POST["data"] = json_decode($value, true);
 	    	}
 	    }
 
@@ -275,8 +275,8 @@ function getForm($formId){
 					$captcha_url = $this->pageUrl . "?captcha=" . $captcha_filename;
 				}
 
-				$hidden_hash = md5(serialize($_POST["data"]));
-				$hidden_value = base64_encode(serialize($_POST["data"]));
+				$hidden_hash = md5(json_encode($_POST["data"]));
+				$hidden_value = base64_encode(json_encode($_POST["data"]));
 
 				$hidden_forms = '<input type="hidden" name="form_hash" value="' . $hidden_hash . '" />';
 				$hidden_forms.= '<input type="hidden" name="form_value" value="' . $hidden_value . '" />';
@@ -578,18 +578,18 @@ private function generateCaptchaImage($captcha_value, $captcha_filename){
 class SOYInquiry_FormComponent extends HTMLLabel{
 
 	private $application;
-
+
 	function execute(){
 		parent::execute();
 		$html = $this->application->getForm($this->getAttribute("app:formid"));
 		$this->setHtml($html);
-	}
-	function getApplication() {
-		return $this->application;
-	}
-	function setApplication($application) {
-		$this->application = $application;
-	}
+	}
+	function getApplication() {
+		return $this->application;
+	}
+	function setApplication($application) {
+		$this->application = $application;
+	}
 }
 
 $app = new SOYInquiry_PageApplication();
