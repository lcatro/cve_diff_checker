From ee58aff6918b8bbc3be29b9e3089485ea46ff956 Mon Sep 17 00:00:00 2001
From: Andre Renaud <arenaud@designa-electronics.com>
Date: Tue, 10 Apr 2018 09:21:34 +1200
Subject: [PATCH] jpeg: Fix another possible buffer overrun

Found via the clang libfuzzer
---
 pdfgen.c | 3 ++-
 1 file changed, 2 insertions(+), 1 deletion(-)

diff --git a/pdfgen.c b/pdfgen.c
index 4ae05df..90ce287 100644
--- a/pdfgen.c
+++ b/pdfgen.c
@@ -2036,7 +2036,8 @@ static int jpeg_size(unsigned char* data, unsigned int data_size,
                     return 0;
                 }
                 i+=2;
-                block_length = data[i] * 256 + data[i+1];
+                if (i + 1 < data_size)
+                    block_length = data[i] * 256 + data[i+1];
             }
         }
     }
