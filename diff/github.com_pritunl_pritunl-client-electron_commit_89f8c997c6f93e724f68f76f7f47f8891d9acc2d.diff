From 89f8c997c6f93e724f68f76f7f47f8891d9acc2d Mon Sep 17 00:00:00 2001
From: Zachary Huff <zach.huff.386@gmail.com>
Date: Mon, 31 Aug 2020 05:55:29 -0400
Subject: [PATCH] Remove file before io write file

---
 service/profile/profile.go | 8 +++++++-
 service/utils/utils.go     | 1 +
 2 files changed, 8 insertions(+), 1 deletion(-)

diff --git a/service/profile/profile.go b/service/profile/profile.go
index b6362cc3..ba0bc05b 100644
--- a/service/profile/profile.go
+++ b/service/profile/profile.go
@@ -214,6 +214,7 @@ func (p *Profile) write() (pth string, err error) {
 
 	pth = filepath.Join(rootDir, p.Id)
 
+	_ = os.Remove(pth)
 	err = ioutil.WriteFile(pth, []byte(p.Data), os.FileMode(0600))
 	if err != nil {
 		err = &WriteError{
@@ -261,6 +262,7 @@ func (p *Profile) writeUp() (pth string, err error) {
 		panic("profile: Not implemented")
 	}
 
+	_ = os.Remove(pth)
 	err = ioutil.WriteFile(pth, []byte(script), os.FileMode(0755))
 	if err != nil {
 		err = &WriteError{
@@ -308,6 +310,7 @@ func (p *Profile) writeDown() (pth string, err error) {
 		panic("profile: Not implemented")
 	}
 
+	_ = os.Remove(pth)
 	err = ioutil.WriteFile(pth, []byte(script), os.FileMode(0755))
 	if err != nil {
 		err = &WriteError{
@@ -327,6 +330,7 @@ func (p *Profile) writeBlock() (pth string, err error) {
 
 	pth = filepath.Join(rootDir, p.Id+"-block.sh")
 
+	_ = os.Remove(pth)
 	err = ioutil.WriteFile(pth, []byte(blockScript), os.FileMode(0755))
 	if err != nil {
 		err = &WriteError{
@@ -468,6 +472,7 @@ func (p *Profile) writeAuth() (pth string, err error) {
 
 	pth = filepath.Join(rootDir, p.Id+".auth")
 
+	_ = os.Remove(pth)
 	err = ioutil.WriteFile(pth, []byte(username+"\n"+password+"\n"),
 		os.FileMode(0600))
 	if err != nil {
@@ -511,6 +516,7 @@ func (p *Profile) writeConfWgLinux() (pth string, err error) {
 
 	pth = filepath.Join(rootDir, p.Id+".key")
 
+	_ = os.Remove(pth)
 	err = ioutil.WriteFile(
 		pth,
 		[]byte(p.PrivateKeyWg+"\n"),
@@ -599,7 +605,7 @@ func (p *Profile) writeConfWgQuick(data *WgConf) (pth string, err error) {
 
 	pth = filepath.Join(rootDir, p.Iface+".conf")
 
-	os.Remove(pth)
+	_ = os.Remove(pth)
 	err = ioutil.WriteFile(
 		pth,
 		[]byte(output.String()),
diff --git a/service/utils/utils.go b/service/utils/utils.go
index 9ac7e383..79da8ade 100644
--- a/service/utils/utils.go
+++ b/service/utils/utils.go
@@ -914,6 +914,7 @@ func PidInit() (err error) {
 		}
 	}
 
+	_ = os.Remove(pth)
 	err = ioutil.WriteFile(
 		pth,
 		[]byte(strconv.Itoa(os.Getpid())),
