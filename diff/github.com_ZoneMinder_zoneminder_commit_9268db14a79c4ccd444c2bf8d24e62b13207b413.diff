From 9268db14a79c4ccd444c2bf8d24e62b13207b413 Mon Sep 17 00:00:00 2001
From: Isaac Connor <isaac@zoneminder.com>
Date: Wed, 16 Sep 2020 14:14:31 -0400
Subject: [PATCH] Fix xss reported by Noccolo Picca relating to not sanitizing
 connkey

---
 web/skins/classic/views/download.php | 4 ++--
 web/skins/classic/views/export.php   | 2 +-
 2 files changed, 3 insertions(+), 3 deletions(-)

diff --git a/web/skins/classic/views/download.php b/web/skins/classic/views/download.php
index 88bb0958bb..3e504e5f4d 100644
--- a/web/skins/classic/views/download.php
+++ b/web/skins/classic/views/download.php
@@ -62,7 +62,7 @@
 }
 
 $focusWindow = true;
-$connkey = isset($_REQUEST['connkey']) ? $_REQUEST['connkey'] : generateConnKey();
+$connkey = isset($_REQUEST['connkey']) ? validInt($_REQUEST['connkey']) : generateConnKey();
 
 xhtmlHeaders(__FILE__, translate('Download'));
 ?>
@@ -75,7 +75,7 @@
       <h2><?php echo translate('Download') ?></h2>
     </div>
     <div id="content">
-      <form name="contentForm" id="contentForm" method="post" action="<?php echo $_SERVER['PHP_SELF'] ?>">
+      <form name="contentForm" id="contentForm" method="post" action="?">
         <input type="hidden" name="connkey" value="<?php echo $connkey; ?>"/>
 <?php
 if ( !empty($_REQUEST['eid']) ) {
diff --git a/web/skins/classic/views/export.php b/web/skins/classic/views/export.php
index 6abfd62bf7..f8fd64fbbc 100644
--- a/web/skins/classic/views/export.php
+++ b/web/skins/classic/views/export.php
@@ -55,7 +55,7 @@
 }
 
 $focusWindow = true;
-$connkey = isset($_REQUEST['connkey']) ? $_REQUEST['connkey'] : generateConnKey();
+$connkey = isset($_REQUEST['connkey']) ? validInt($_REQUEST['connkey']) : generateConnKey();
 
 xhtmlHeaders(__FILE__, translate('Export'));
 ?>
