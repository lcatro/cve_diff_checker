From 101dc1d37010a1d877d6961ed2f32d089c708e91 Mon Sep 17 00:00:00 2001
From: RemRem <remrem@users.noreply.github.com>
Date: Mon, 11 Dec 2017 23:45:04 +0100
Subject: [PATCH] fix windows server zip file name for backup

---
 admin/maintenance.php | 4 +++-
 1 file changed, 3 insertions(+), 1 deletion(-)

diff --git a/admin/maintenance.php b/admin/maintenance.php
index 492cfc0..17fa55e 100755
--- a/admin/maintenance.php
+++ b/admin/maintenance.php
@@ -337,7 +337,9 @@ function addFolder2zip($zip, $folder)
  */
 function creer_fichier_zip($folders)
 {
-    $zipfile = 'archive_site-'.date('Ymd').'-'.substr(md5(rand(10, 99)), 3, 5).'.zip';
+    // fix on windows server, file can be found using "archiv~1.zip" as file name in URL
+    // $zipfile = 'archive_site-'.date('Ymd').'-'.substr(md5(rand(10, 99)), 3, 5).'.zip';
+    $zipfile = substr(md5(rand(10, 99)), 3, 5).'-archive_site-'.date('Ymd').'.zip';
     $zip = new ZipArchive;
     if ($zip->open(DIR_BACKUP.$zipfile, ZipArchive::CREATE) === true) {
         foreach ($folders as $folder) {
