From c97f870f5ae13112988d9f8ad464b4f679903706 Mon Sep 17 00:00:00 2001
From: Armin Burgmeier <armin@arbur.net>
Date: Mon, 11 May 2015 22:59:34 -0400
Subject: [PATCH] Fix expired certificate validation (gobby #61)

---
 libinfgtk/inf-gtk-certificate-manager.c | 6 ++++--
 1 file changed, 4 insertions(+), 2 deletions(-)

diff --git a/libinfgtk/inf-gtk-certificate-manager.c b/libinfgtk/inf-gtk-certificate-manager.c
index ace4333..cd36632 100644
--- a/libinfgtk/inf-gtk-certificate-manager.c
+++ b/libinfgtk/inf-gtk-certificate-manager.c
@@ -709,9 +709,11 @@ inf_gtk_certificate_manager_certificate_func(InfXmppConnection* connection,
 
       if(ret != GNUTLS_E_SUCCESS)
         inf_gnutls_set_error(&error, ret);
-      else if(verify & GNUTLS_CERT_INVALID)
-        inf_gnutls_certificate_verification_set_error(&error, verify);
     }
+
+    if(error == NULL)
+      if(verify & GNUTLS_CERT_INVALID)
+        inf_gnutls_certificate_verification_set_error(&error, verify);
   }
 
   /* Look up the host in our database of pinned certificates if we could not
