From 5c3e4f96ff0ef6b91a3f0aa64eb28197c5cf5435 Mon Sep 17 00:00:00 2001
From: Thorsten Rinne <thorsten@phpmyfaq.de>
Date: Mon, 2 Oct 2017 15:30:45 +0200
Subject: [PATCH] Prevent users to upload HTML files as attachments

---
 phpmyfaq/admin/attachment.php | 6 +++++-
 1 file changed, 5 insertions(+), 1 deletion(-)

diff --git a/phpmyfaq/admin/attachment.php b/phpmyfaq/admin/attachment.php
index 5312273b8d..f1fcb0e5b6 100644
--- a/phpmyfaq/admin/attachment.php
+++ b/phpmyfaq/admin/attachment.php
@@ -139,7 +139,11 @@
     <strong><?php echo $PMF_LANG['ad_att_addto'].' '.$PMF_LANG['ad_att_addto_2'] ?></strong>
 </p>
 <?php
-    if (is_uploaded_file($_FILES['userfile']['tmp_name']) && !($_FILES['userfile']['size'] > $faqConfig->get('records.maxAttachmentSize'))) {
+    if (
+        is_uploaded_file($_FILES['userfile']['tmp_name']) &&
+        !($_FILES['userfile']['size'] > $faqConfig->get('records.maxAttachmentSize')) &&
+        $_FILES['userfile']['type'] !== "text/html"
+    ) {
         $att = PMF_Attachment_Factory::create();
         $att->setRecordId($recordId);
         $att->setRecordLang($recordLang);
