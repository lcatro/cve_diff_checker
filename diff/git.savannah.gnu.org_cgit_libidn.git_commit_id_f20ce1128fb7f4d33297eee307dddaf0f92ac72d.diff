From f20ce1128fb7f4d33297eee307dddaf0f92ac72d Mon Sep 17 00:00:00 2001
From: Simon Josefsson <simon@josefsson.org>
Date: Thu, 14 Jan 2016 13:46:52 +0100
Subject: =?UTF-8?q?Fix=20out-of-bounds=20stack=20read.=20=20Report=20and?=
 =?UTF-8?q?=20patch=20by=20Hanno=20B=C3=B6ck.?=
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

---
 lib/idna.c | 4 +++-
 1 file changed, 3 insertions(+), 1 deletion(-)

diff --git a/lib/idna.c b/lib/idna.c
index 5107d739..0ccd102c 100644
--- a/lib/idna.c
+++ b/lib/idna.c
@@ -212,6 +212,8 @@ step3:
       }
     if (i < 64)
       out[i] = '\0';
+    else
+      return IDNA_INVALID_LENGTH;
     if (inasciirange)
       goto step8;
   }
@@ -266,7 +268,7 @@ step3:
 
 step8:
   free (src);
-  if (strlen (out) < 1 || strlen (out) > 63)
+  if (strlen (out) < 1)
     return IDNA_INVALID_LENGTH;
 
   return IDNA_SUCCESS;
-- 
cgit v1.2.1

