From 27bca8280419966ba80c6fa283d985ddffa84bb6 Mon Sep 17 00:00:00 2001
From: Seb Dangerfield <1449113+sedan07@users.noreply.github.com>
Date: Fri, 15 Jan 2021 14:17:35 +0000
Subject: [PATCH] Ensure only allowed searchable columns are used in DB Query

---
 app/Models/Traits/SearchableTrait.php | 5 +++--
 1 file changed, 3 insertions(+), 2 deletions(-)

diff --git a/app/Models/Traits/SearchableTrait.php b/app/Models/Traits/SearchableTrait.php
index 8038b47aae83..8db2300e6212 100644
--- a/app/Models/Traits/SearchableTrait.php
+++ b/app/Models/Traits/SearchableTrait.php
@@ -34,10 +34,11 @@ public function scopeSearch(Builder $query, array $search = [])
             return $query;
         }
 
-        if (!array_intersect(array_keys($search), $this->searchable)) {
+        $allowed_search = array_intersect_key($search, array_flip($this->searchable));
+        if (! $allowed_search) {
             return $query;
         }
 
-        return $query->where($search);
+        return $query->where($allowed_search);
     }
 }
