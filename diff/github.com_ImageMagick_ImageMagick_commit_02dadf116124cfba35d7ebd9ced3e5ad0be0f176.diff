From 02dadf116124cfba35d7ebd9ced3e5ad0be0f176 Mon Sep 17 00:00:00 2001
From: dirk <dirk@git.imagemagick.org>
Date: Sun, 14 Feb 2016 08:39:52 +0100
Subject: [PATCH] Fixed SEGV reported in
 https://github.com/ImageMagick/ImageMagick/issues/130

---
 MagickCore/profile.c | 3 ++-
 1 file changed, 2 insertions(+), 1 deletion(-)

diff --git a/MagickCore/profile.c b/MagickCore/profile.c
index 3b5048b97f..e2e437d52d 100644
--- a/MagickCore/profile.c
+++ b/MagickCore/profile.c
@@ -1442,7 +1442,8 @@ static void WriteTo8BimProfile(Image *image,const char *name,
     count=(ssize_t) value;
     if ((count & 0x01) != 0)
       count++;
-    if ((p > (datum+length-count)) || (count > (ssize_t) length))
+    if ((count < 0) || (p > (datum+length-count)) ||
+        (count > (ssize_t) length))
       break;
     if (id != profile_id)
       p+=count;
