From 2dad81128250cb2e5d950cddc9d3c0314a80b4bb Mon Sep 17 00:00:00 2001
From: Jens Vagelpohl <jens@netz.ooo>
Date: Tue, 23 Feb 2021 12:25:04 +0100
Subject: [PATCH] - Fix missing access control on ZODB Role Manager
 enumerateRoles

---
 CHANGES.rst                                                  | 2 ++
 src/Products/PluggableAuthService/plugins/ZODBRoleManager.py | 1 +
 2 files changed, 3 insertions(+)

diff --git a/CHANGES.rst b/CHANGES.rst
index d0683af..a1bfbd8 100644
--- a/CHANGES.rst
+++ b/CHANGES.rst
@@ -4,6 +4,8 @@ Change Log
 2.6.0 (unreleased)
 ------------------
 
+- Fix missing access control on ZODB Role Manager ``enumerateRoles``
+
 - Fix open redirect issue in `Cookie Auth Helper` redirect handling
 
 - Add support for Python 3.9.
diff --git a/src/Products/PluggableAuthService/plugins/ZODBRoleManager.py b/src/Products/PluggableAuthService/plugins/ZODBRoleManager.py
index e0aa1ea..9167b3b 100644
--- a/src/Products/PluggableAuthService/plugins/ZODBRoleManager.py
+++ b/src/Products/PluggableAuthService/plugins/ZODBRoleManager.py
@@ -112,6 +112,7 @@ def getRolesForPrincipal(self, principal, request=None):
     #
     #   IRoleEnumerationPlugin implementation
     #
+    @security.private
     def enumerateRoles(self, id=None, exact_match=False, sort_by=None,
                        max_results=None, **kw):
         """ See IRoleEnumerationPlugin.
