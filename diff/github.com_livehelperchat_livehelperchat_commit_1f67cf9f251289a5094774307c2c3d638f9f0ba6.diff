From 1f67cf9f251289a5094774307c2c3d638f9f0ba6 Mon Sep 17 00:00:00 2001
From: Remigijus Kiminas <remdex@gmail.com>
Date: Mon, 27 Dec 2021 00:47:39 -0500
Subject: [PATCH] Old widget postMessage escape string

---
 lhc_web/design/defaulttheme/tpl/pagelayouts/widget.php | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

diff --git a/lhc_web/design/defaulttheme/tpl/pagelayouts/widget.php b/lhc_web/design/defaulttheme/tpl/pagelayouts/widget.php
index 4f4ac70ce..62ac1ffb2 100644
--- a/lhc_web/design/defaulttheme/tpl/pagelayouts/widget.php
+++ b/lhc_web/design/defaulttheme/tpl/pagelayouts/widget.php
@@ -64,11 +64,11 @@
 	parent.postMessage("lhc_ch:hash_resume:<?php echo $Result['chat']->id,'_',$Result['chat']->hash?>", '*');
 	<?php endif; ?>
 	<?php if (isset($Result['additional_post_message'])) : ?>
-	parent.postMessage("<?php echo $Result['additional_post_message']?>", '*');
+	parent.postMessage(<?php echo json_encode($Result['additional_post_message'])?>, '*');
 	<?php endif;?>
 	<?php if (isset($Result['parent_messages'])) : 
 	foreach ($Result['parent_messages'] as $msgPArent) : ?>
-	parent.postMessage("<?php echo $msgPArent?>", '*');
+	parent.postMessage(<?php echo json_encode($msgPArent)?>, '*');
 	<?php endforeach;endif;?>
 
     function handleCrossMessage(e) {
