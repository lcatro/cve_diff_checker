From dd96d671e4d5ae22c6894c302e8996c13f24c45a Mon Sep 17 00:00:00 2001
From: Dirk Lemstra <dirk@git.imagemagick.org>
Date: Sat, 18 Nov 2017 10:23:53 +0100
Subject: [PATCH] Added missing return to avoid use after free.

---
 Magick++/lib/Image.cpp | 9 +++++++--
 1 file changed, 7 insertions(+), 2 deletions(-)

diff --git a/Magick++/lib/Image.cpp b/Magick++/lib/Image.cpp
index 3e42e0b7a4..5344686489 100644
--- a/Magick++/lib/Image.cpp
+++ b/Magick++/lib/Image.cpp
@@ -5140,9 +5140,14 @@ void Magick::Image::read(MagickCore::Image *image,
       image == (MagickCore::Image *) NULL)
     {
       (void) MagickCore::DestroyExceptionInfo(exceptionInfo);
-      throwExceptionExplicit(ImageWarning,"No image was loaded.");
+      if (!quiet())
+        throwExceptionExplicit(MagickCore::ImageWarning,
+          "No image was loaded.");
+    }
+  else
+    {
+      ThrowImageException;
     }
-  ThrowImageException;
   if (image != (MagickCore::Image *) NULL)
     throwException(&image->exception,quiet());
 }
