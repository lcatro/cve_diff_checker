From 72a02ebaaf95a80e26127ee7ee2b123cccce05a7 Mon Sep 17 00:00:00 2001
From: LouisGac <louis.gac@limesurvey.org>
Date: Wed, 15 Aug 2018 13:25:47 +0200
Subject: [PATCH] [security] fixed issue #13959: RCE via resource file upload
 as authenticated user

---
 application/third_party/pclzip/pclzip.lib.php | 3 +++
 1 file changed, 3 insertions(+)

diff --git a/application/third_party/pclzip/pclzip.lib.php b/application/third_party/pclzip/pclzip.lib.php
index 2ac786dd25..8c7cbc7939 100644
--- a/application/third_party/pclzip/pclzip.lib.php
+++ b/application/third_party/pclzip/pclzip.lib.php
@@ -3669,6 +3669,9 @@ function privExtractFile(&$p_entry, $p_path, $p_remove_path, $p_remove_all_path,
       }
     }
 
+    // Added by LS Team to check for invalid paths
+    $p_entry['filename'] = get_absolute_path($p_entry['filename']);    
+
     // ----- Add the path
     if ($p_path != '') {
       $p_entry['filename'] = $p_path."/".$p_entry['filename'];
