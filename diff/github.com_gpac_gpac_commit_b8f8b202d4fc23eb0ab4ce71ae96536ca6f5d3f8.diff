From b8f8b202d4fc23eb0ab4ce71ae96536ca6f5d3f8 Mon Sep 17 00:00:00 2001
From: jeanlf <jeanlf@gpac.io>
Date: Fri, 23 Apr 2021 14:37:01 +0200
Subject: [PATCH] fixed #1757

---
 src/isomedia/box_code_base.c | 2 ++
 1 file changed, 2 insertions(+)

diff --git a/src/isomedia/box_code_base.c b/src/isomedia/box_code_base.c
index 752bd5464..5964aa450 100644
--- a/src/isomedia/box_code_base.c
+++ b/src/isomedia/box_code_base.c
@@ -6743,6 +6743,8 @@ GF_Err trak_box_size(GF_Box *s)
 	GF_TrackBox *ptr = (GF_TrackBox *)s;
 
 	if (ptr->sample_encryption && ptr->sample_encryption->load_needed) {
+		if (!ptr->moov || !!ptr->moov->mov || !ptr->moov->mov->movieFileMap)
+			return GF_ISOM_INVALID_FILE;
 		GF_Err e = senc_Parse(ptr->moov->mov->movieFileMap->bs, ptr, NULL, ptr->sample_encryption);
 		if (e) return e;
 	}
