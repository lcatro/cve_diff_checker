From 01ef56cd5824ed6da1c11b37013a027fdef67524 Mon Sep 17 00:00:00 2001
From: Sebastian Hildebrandt <hildebrandt@plus-innovations.com>
Date: Mon, 15 Mar 2021 11:51:30 +0100
Subject: [PATCH] sanitizeShellString() and other security improvements

---
 lib/internet.js | 7 +++----
 1 file changed, 3 insertions(+), 4 deletions(-)

diff --git a/lib/internet.js b/lib/internet.js
index 1f75a71..2dc0d5a 100644
--- a/lib/internet.js
+++ b/lib/internet.js
@@ -14,7 +14,6 @@
 // ----------------------------------------------------------------------------------
 
 // const exec = require('child_process').exec;
-const execFile = require('child_process').execFile;
 const util = require('./util');
 
 let _platform = process.platform;
@@ -213,9 +212,9 @@ function inetLatency(host, callback) {
         let result = null;
         try {
           const params = hostSanitized + ' -n 1';
-          execFile('ping', params.split(' '), util.execOptsWin, function (error, stdout) {
-            if (!error) {
-              let lines = stdout.toString().split('\r\n');
+          util.execSave('ping', params.split(' '), util.execOptsWin).then((stdout) => {
+            if (stdout) {
+              let lines = stdout.split('\r\n');
               lines.shift();
               lines.forEach(function (line) {
                 if ((line.toLowerCase().match(/ms/g) || []).length === 3) {
