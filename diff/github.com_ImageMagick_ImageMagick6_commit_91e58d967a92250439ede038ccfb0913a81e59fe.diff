From 91e58d967a92250439ede038ccfb0913a81e59fe Mon Sep 17 00:00:00 2001
From: Cristy <urban-warrior@imagemagick.org>
Date: Sat, 22 Jun 2019 08:23:29 -0400
Subject: [PATCH] https://github.com/ImageMagick/ImageMagick/issues/1615

---
 magick/statistic.c | 11 +++++------
 1 file changed, 5 insertions(+), 6 deletions(-)

diff --git a/magick/statistic.c b/magick/statistic.c
index 7a07c52825..2cf7830a39 100644
--- a/magick/statistic.c
+++ b/magick/statistic.c
@@ -163,18 +163,17 @@ static MagickPixelPacket **AcquirePixelThreadSet(const Image *images)
 
   size_t
     columns,
-    number_threads;
+    rows;
 
-  number_threads=(size_t) GetMagickResourceLimit(ThreadResource);
-  pixels=(MagickPixelPacket **) AcquireQuantumMemory(number_threads,
-    sizeof(*pixels));
+  rows=MagickMax(GetImageListLength(images),
+    (size_t) GetMagickResourceLimit(ThreadResource));
+  pixels=(MagickPixelPacket **) AcquireQuantumMemory(rows,sizeof(*pixels));
   if (pixels == (MagickPixelPacket **) NULL)
     return((MagickPixelPacket **) NULL);
-  (void) memset(pixels,0,number_threads*sizeof(*pixels));
   columns=images->columns;
   for (next=images; next != (Image *) NULL; next=next->next)
     columns=MagickMax(next->columns,columns);
-  for (i=0; i < (ssize_t) number_threads; i++)
+  for (i=0; i < (ssize_t) rows; i++)
   {
     pixels[i]=(MagickPixelPacket *) AcquireQuantumMemory(columns,
       sizeof(**pixels));
