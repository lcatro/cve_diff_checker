From c69402c4764ed9a76301c57277aefe70141b6418 Mon Sep 17 00:00:00 2001
From: Tim Buckingham <mr@timbuckingham.com>
Date: Thu, 11 Oct 2018 12:20:25 -0400
Subject: [PATCH] Regenerating session IDs on login state change. Thanks to
 Juttikhun Khamchaiyaphum for the suggestion.

---
 core/inc/bigtree/admin.php | 3 +++
 1 file changed, 3 insertions(+)

diff --git a/core/inc/bigtree/admin.php b/core/inc/bigtree/admin.php
index 7985374ab..d91d46651 100755
--- a/core/inc/bigtree/admin.php
+++ b/core/inc/bigtree/admin.php
@@ -118,6 +118,7 @@ function __construct() {
 							$this->CSRFToken = $csrf_token;
 							$this->CSRFTokenField = $csrf_token_field;
 
+							session_regenerate_id();
 							$_SESSION["bigtree_admin"]["id"] = $f["id"];
 							$_SESSION["bigtree_admin"]["email"] = $f["email"];
 							$_SESSION["bigtree_admin"]["name"] = $f["name"];
@@ -6053,6 +6054,7 @@ static function login($email,$password,$stay_logged_in = false,$domain = null,$t
 						setcookie('bigtree_admin[login]', $cookie_value, strtotime("+1 month"), $cookie_domain, "", false, true);
 					}
 
+					session_regenerate_id();
 					$_SESSION["bigtree_admin"]["id"] = $user["id"];
 					$_SESSION["bigtree_admin"]["email"] = $user["email"];
 					$_SESSION["bigtree_admin"]["level"] = $user["level"];
@@ -6184,6 +6186,7 @@ static function loginSession($session_key) {
 						setcookie('bigtree_admin[login]', $cookie_value, strtotime("+1 month"), $cookie_domain, "", false, true);
 					}
 
+					session_regenerate_id();
 					$_SESSION["bigtree_admin"]["id"] = $user["id"];
 					$_SESSION["bigtree_admin"]["email"] = $user["email"];
 					$_SESSION["bigtree_admin"]["level"] = $user["level"];
