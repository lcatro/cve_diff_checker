From 568d4cab5ba1cdee7bbf0133c676d02a98f6d7bc Mon Sep 17 00:00:00 2001
From: ryuring <ryuring55@gmail.com>
Date: Wed, 25 Aug 2021 21:52:17 +0900
Subject: [PATCH] Merge pull request from GHSA-hgjr-632x-qpp3

---
 .../admin-third/UploaderFiles/admin/ajax_image.php   | 12 +++++++++---
 .../Uploader/View/UploaderFiles/admin/ajax_image.php | 10 ++++++++--
 2 files changed, 17 insertions(+), 5 deletions(-)

diff --git a/app/webroot/theme/admin-third/UploaderFiles/admin/ajax_image.php b/app/webroot/theme/admin-third/UploaderFiles/admin/ajax_image.php
index a692c3d269..8bbd939fd7 100755
--- a/app/webroot/theme/admin-third/UploaderFiles/admin/ajax_image.php
+++ b/app/webroot/theme/admin-third/UploaderFiles/admin/ajax_image.php
@@ -5,16 +5,22 @@
  *
  * @copyright       Copyright (c) baserCMS Users Community
  * @link            https://basercms.net baserCMS Project
- * @package            Uploader.View
+ * @package         Uploader.View
  * @since           baserCMS v 3.0.10
  * @license         https://basercms.net/license/index.html
  */
-$url = $this->BcBaser->getUrl($this->Uploader->getFileUrl($file['UploaderFile']['name']));
+
+/**
+ * @var BcAppView $this
+ * @var array $file
+ * @var string $size
+ */
+$url = h($this->BcBaser->getUrl($this->Uploader->getFileUrl($file['UploaderFile']['name'])));
 ?>
 
 
 <p class="url">
-	<a href="<?php echo $url ?>" target="_blank"><?php echo FULL_BASE_URL . $url ?></a>
+	<a href="<?php echo $url ?>" target="_blank"><?php echo Router::url($url, true) ?></a>
 </p>
 <p class="image">
 	<a href="<?php echo $url ?>"
diff --git a/lib/Baser/Plugin/Uploader/View/UploaderFiles/admin/ajax_image.php b/lib/Baser/Plugin/Uploader/View/UploaderFiles/admin/ajax_image.php
index 87802ecd5e..8bbd939fd7 100755
--- a/lib/Baser/Plugin/Uploader/View/UploaderFiles/admin/ajax_image.php
+++ b/lib/Baser/Plugin/Uploader/View/UploaderFiles/admin/ajax_image.php
@@ -9,12 +9,18 @@
  * @since           baserCMS v 3.0.10
  * @license         https://basercms.net/license/index.html
  */
-$url = $this->BcBaser->getUrl($this->Uploader->getFileUrl($file['UploaderFile']['name']));
+
+/**
+ * @var BcAppView $this
+ * @var array $file
+ * @var string $size
+ */
+$url = h($this->BcBaser->getUrl($this->Uploader->getFileUrl($file['UploaderFile']['name'])));
 ?>
 
 
 <p class="url">
-	<a href="<?php echo $url ?>" target="_blank"><?php echo FULL_BASE_URL . $url ?></a>
+	<a href="<?php echo $url ?>" target="_blank"><?php echo Router::url($url, true) ?></a>
 </p>
 <p class="image">
 	<a href="<?php echo $url ?>"
