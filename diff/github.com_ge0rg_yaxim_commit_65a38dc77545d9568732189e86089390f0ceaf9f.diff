From 65a38dc77545d9568732189e86089390f0ceaf9f Mon Sep 17 00:00:00 2001
From: Georg Lukas <georg@op-co.de>
Date: Mon, 30 Jan 2017 15:36:48 +0100
Subject: [PATCH] Smackable: improved carbon checks

---
 src/org/yaxim/androidclient/service/SmackableImp.java | 4 ++++
 1 file changed, 4 insertions(+)

diff --git a/src/org/yaxim/androidclient/service/SmackableImp.java b/src/org/yaxim/androidclient/service/SmackableImp.java
index 6c3b001e..13dcbb52 100644
--- a/src/org/yaxim/androidclient/service/SmackableImp.java
+++ b/src/org/yaxim/androidclient/service/SmackableImp.java
@@ -1242,6 +1242,10 @@ public void processPacket(Packet packet) {
 					
 					int direction = ChatConstants.INCOMING;
 					Carbon cc = CarbonManager.getCarbon(msg);
+					if (cc != null && !msg.getFrom().equalsIgnoreCase(mConfig.jabberID)) {
+						Log.w(TAG, "Received illegal carbon from " + msg.getFrom() + ": " + cc.toXML());
+						cc = null;
+					}
 
 					// extract timestamp
 					long ts;
