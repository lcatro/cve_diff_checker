From 9eb3aa7dbce1e4ad8581e33e6139fe5f9125590f Mon Sep 17 00:00:00 2001
From: Yuki Hattori <yukihattori1116@gmail.com>
Date: Fri, 17 Dec 2021 02:27:06 +0900
Subject: [PATCH 1/3] Add performance test for blockquote tag rendering

---
 test/mrkdwn.tsx | 15 +++++++++++++++
 1 file changed, 15 insertions(+)

diff --git a/test/mrkdwn.tsx b/test/mrkdwn.tsx
index a4cc086..f6e4e60 100644
--- a/test/mrkdwn.tsx
+++ b/test/mrkdwn.tsx
@@ -587,6 +587,21 @@ describe('HTML parser for mrkdwn', () => {
       ).toBe('&gt; *A*\n&gt; \n&gt; *_B_*\n&gt; \n&gt; *C*\n&gt; ')
     })
 
+    it('renders many tags in the blockquote tag immediately', () => {
+      const startTime = Date.now()
+
+      mrkdwn(
+        <blockquote>
+          {[...Array(30)].map((_, i) => (
+            <b>{i}</b>
+          ))}
+        </blockquote>
+      )
+
+      const processTime = Date.now() - startTime
+      expect(processTime).toBeLessThan(1000)
+    })
+
     it('ignores invalid double markup', () =>
       expect(
         mrkdwn(

From 9eace0956dedf95748ec58f4d0bd9b0cc2fabc1c Mon Sep 17 00:00:00 2001
From: Yuki Hattori <yukihattori1116@gmail.com>
Date: Fri, 17 Dec 2021 02:34:39 +0900
Subject: [PATCH 2/3] Fix performance issues of tags in blockquote

---
 src/mrkdwn/escape.ts | 5 ++---
 1 file changed, 2 insertions(+), 3 deletions(-)

diff --git a/src/mrkdwn/escape.ts b/src/mrkdwn/escape.ts
index c6634e8..5702c5f 100644
--- a/src/mrkdwn/escape.ts
+++ b/src/mrkdwn/escape.ts
@@ -8,9 +8,8 @@ const generateReplacerForEscape = (fallback: string) => (matched: string) =>
 export const escapeReplacers = {
   blockquote: (partial: string) =>
     partial
-      .replace(
-        /^((?:<.*?>)*)(&gt;)/gm,
-        (_, leading, character) => `${leading}\u00ad${character}`
+      .replace(/^((?:<.*?>)*)(.{4})/gm, (matched, leading, character) =>
+        character === '&gt;' ? `${leading}\u00ad&gt;` : matched
       )
       .replace(
         /^((?:<.*?>)*)(ï¼ž)/gm,

From 7f739e4fb318b9dd71b8b81ae00e204bff0aa5e7 Mon Sep 17 00:00:00 2001
From: Yuki Hattori <yukihattori1116@gmail.com>
Date: Fri, 17 Dec 2021 03:05:21 +0900
Subject: [PATCH 3/3] Update CHANGELOG.md

---
 CHANGELOG.md | 4 ++++
 1 file changed, 4 insertions(+)

diff --git a/CHANGELOG.md b/CHANGELOG.md
index b3e310f..af5eae1 100644
--- a/CHANGELOG.md
+++ b/CHANGELOG.md
@@ -2,6 +2,10 @@
 
 ## [Unreleased]
 
+### Fixed
+
+- Fix performance issues of tags in `<blockquote>`
+
 ## v4.5.0 - 2021-12-02
 
 ### Added
