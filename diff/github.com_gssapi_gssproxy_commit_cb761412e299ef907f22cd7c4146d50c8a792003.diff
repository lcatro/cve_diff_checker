From cb761412e299ef907f22cd7c4146d50c8a792003 Mon Sep 17 00:00:00 2001
From: Guiyao <guiyao@huawei.com>
Date: Thu, 26 Mar 2020 06:33:35 +0000
Subject: [PATCH] Unlock cond_mutex before pthread exit in gp_worker_main()

Signed-off-by: GuiYao <guiyao@huawei.com>
[rharwood@redhat.com: whitespace, tweak commit message]
Reviewed-by: Robbie Harwood <rharwood@redhat.com>
---
 src/gp_workers.c | 1 +
 1 file changed, 1 insertion(+)

diff --git a/src/gp_workers.c b/src/gp_workers.c
index 18f38f6..ae42cef 100644
--- a/src/gp_workers.c
+++ b/src/gp_workers.c
@@ -369,6 +369,7 @@ static void *gp_worker_main(void *pvt)
             /* wait for next query */
             pthread_cond_wait(&t->cond_wakeup, &t->cond_mutex);
             if (t->pool->shutdown) {
+                pthread_mutex_unlock(&t->cond_mutex);
                 pthread_exit(NULL);
             }
         }
