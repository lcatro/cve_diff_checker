From f6945f1e4b157c69e414cd94fe5cde1876aabcc1 Mon Sep 17 00:00:00 2001
From: Volodymyr Kozieiev <vkjr.sp@gmail.com>
Date: Sun, 19 May 2019 10:43:02 +0300
Subject: [PATCH] Fix ubuntu-server vulnerability

---
 ubuntu-server.js | 15 ++++++++++++++-
 1 file changed, 14 insertions(+), 1 deletion(-)

diff --git a/ubuntu-server.js b/ubuntu-server.js
index 5ca237cb8..89a0349d6 100755
--- a/ubuntu-server.js
+++ b/ubuntu-server.js
@@ -114,6 +114,18 @@ function rnUbuntuServer(readable, writable) {
   });
 }
 
+var closeDangerousConnection = function(sock) {
+  var remoteAddress = sock.remoteAddress;
+  if(remoteAddress.indexOf("127.0.0.1") == -1) {
+    console.log("WARN: connection not from localhost, will be closed: ", remoteAddress);
+    sock.destroy();
+    return true;
+  } else {
+    console.log("Connection from: ", remoteAddress);
+    return false;
+  }
+}
+
 if (process.argv.indexOf('--pipe') != -1) {
   rnUbuntuServer(process.stdin, process.stdout);
 } else {
@@ -127,6 +139,7 @@ if (process.argv.indexOf('--pipe') != -1) {
 
   var server = net.createServer((sock) => {
     DEBUG && console.error("-- Connection from RN client");
-    rnUbuntuServer(sock, sock);
+    if(!closeDangerousConnection(sock))
+      rnUbuntuServer(sock, sock);
   }).listen(port, function() { console.error("-- Server starting") });
 }
