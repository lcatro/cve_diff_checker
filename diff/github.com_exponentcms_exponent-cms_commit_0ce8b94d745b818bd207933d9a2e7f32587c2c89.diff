From 0ce8b94d745b818bd207933d9a2e7f32587c2c89 Mon Sep 17 00:00:00 2001
From: dleffler <dleffler@hughes.net>
Date: Thu, 3 Nov 2016 10:59:50 -0400
Subject: [PATCH] better fix security vulnerability in editor preview; reported
 by fyth

---
 .../modules/core/controllers/expHTMLEditorController.php      | 4 +++-
 1 file changed, 3 insertions(+), 1 deletion(-)

diff --git a/framework/modules/core/controllers/expHTMLEditorController.php b/framework/modules/core/controllers/expHTMLEditorController.php
index 0b347b925b..10623b6e7e 100644
--- a/framework/modules/core/controllers/expHTMLEditorController.php
+++ b/framework/modules/core/controllers/expHTMLEditorController.php
@@ -62,6 +62,8 @@ function __construct($src = null, $params = array())
         parent:: __construct($src, $params);
         if (empty($this->params['editor'])) {
             $this->params['editor'] = SITE_WYSIWYG_EDITOR;
+        } else {
+            $this->params['editor'] = preg_replace("/[^[:alnum:][:space:]]/u", '', $this->params['editor']);
         }
     }
 
@@ -171,7 +173,7 @@ function preview()
                 $demo->skin = 'lightgray';
             }
         } else {
-            $demo = self::getEditorSettings($this->params['id'], expString::escape($this->params['editor']));
+            $demo = self::getEditorSettings($this->params['id'], $this->params['editor']);
         }
         assign_to_template(
             array(
