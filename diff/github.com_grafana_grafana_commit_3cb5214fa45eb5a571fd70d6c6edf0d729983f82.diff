From 8081dc9ee913a1bf4b98f99e78661db88a6dc1ef Mon Sep 17 00:00:00 2001
From: Dan Cech <dcech@grafana.com>
Date: Fri, 22 Oct 2021 15:23:06 -0400
Subject: [PATCH 1/2] use replaceAll when sanitizing urls

---
 packages/grafana-data/src/text/sanitize.ts | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/packages/grafana-data/src/text/sanitize.ts b/packages/grafana-data/src/text/sanitize.ts
index 6313d0db13885..4e8fa135fa8ad 100644
--- a/packages/grafana-data/src/text/sanitize.ts
+++ b/packages/grafana-data/src/text/sanitize.ts
@@ -40,5 +40,5 @@ export function escapeHtml(str: string): string {
 }
 
 export function sanitizeAngularInterpolation(url: string): string {
-  return url.replace('{{', '%7B%7B').replace('}}', '%7D%7D');
+  return url.replaceAll('{{', '%7B%7B').replaceAll('}}', '%7D%7D');
 }

From 1c7ce348ce4363c55992ed5772f96981d1a86f7e Mon Sep 17 00:00:00 2001
From: Dan Cech <dcech@grafana.com>
Date: Fri, 22 Oct 2021 16:40:45 -0400
Subject: [PATCH 2/2] switch to global regexp

---
 packages/grafana-data/src/text/sanitize.ts | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/packages/grafana-data/src/text/sanitize.ts b/packages/grafana-data/src/text/sanitize.ts
index 4e8fa135fa8ad..ae14afed42234 100644
--- a/packages/grafana-data/src/text/sanitize.ts
+++ b/packages/grafana-data/src/text/sanitize.ts
@@ -40,5 +40,5 @@ export function escapeHtml(str: string): string {
 }
 
 export function sanitizeAngularInterpolation(url: string): string {
-  return url.replaceAll('{{', '%7B%7B').replaceAll('}}', '%7D%7D');
+  return url.replace(/\{\{/g, '%7B%7B').replace(/\}\}/g, '%7D%7D');
 }
