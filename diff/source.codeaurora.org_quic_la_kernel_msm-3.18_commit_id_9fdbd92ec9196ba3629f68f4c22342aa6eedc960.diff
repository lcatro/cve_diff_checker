From 9fdbd92ec9196ba3629f68f4c22342aa6eedc960 Mon Sep 17 00:00:00 2001
From: Rahul Sharma <sharah@codeaurora.org>
Date: Fri, 8 Sep 2017 18:51:43 +0530
Subject: msm: ais: Return -NOTTY on invalid ioctl command

Check validity of command before processing.

Change-Id: Iecd66b90922f8ed4b7d8d50f7c3d7f27d5d93309
CR-fixed: 2083314
Signed-off-by: Rahul Sharma <sharah@codeaurora.org>
---
 drivers/media/platform/msm/ais/msm.c | 10 ++++++++++
 1 file changed, 10 insertions(+)

diff --git a/drivers/media/platform/msm/ais/msm.c b/drivers/media/platform/msm/ais/msm.c
index f6d6a45..dba9b0a 100644
--- a/drivers/media/platform/msm/ais/msm.c
+++ b/drivers/media/platform/msm/ais/msm.c
@@ -730,6 +730,16 @@ static long msm_private_ioctl(struct file *file, void *fh,
 	if (!event_data)
 		return -EINVAL;
 
+	switch (cmd) {
+	case MSM_CAM_V4L2_IOCTL_NOTIFY:
+	case MSM_CAM_V4L2_IOCTL_CMD_ACK:
+	case MSM_CAM_V4L2_IOCTL_NOTIFY_DEBUG:
+	case MSM_CAM_V4L2_IOCTL_NOTIFY_ERROR:
+		break;
+	default:
+		return -ENOTTY;
+	}
+
 	memset(&event, 0, sizeof(struct v4l2_event));
 	session_id = event_data->session_id;
 	stream_id = event_data->stream_id;
-- 
cgit v1.1

