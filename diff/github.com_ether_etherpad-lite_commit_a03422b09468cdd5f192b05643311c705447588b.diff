From 38b1e0a35e42e4d2e1ff99afc598725c5f7f2a6a Mon Sep 17 00:00:00 2001
From: Robert Helmer <rhelmer@rhelmer.org>
Date: Tue, 30 Jan 2018 12:51:53 -0800
Subject: [PATCH] better sanitize window location in error messages

---
 src/static/js/pad_utils.js | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/src/static/js/pad_utils.js b/src/static/js/pad_utils.js
index b83f21cfe61..9c1277a00ce 100644
--- a/src/static/js/pad_utils.js
+++ b/src/static/js/pad_utils.js
@@ -524,7 +524,7 @@ function setupGlobalExceptionHandler() {
         $("#editorloadingbox").css("padding", "10px");
         $("#editorloadingbox").css("padding-top", "45px");
         $("#editorloadingbox").html("<div style='text-align:left;color:red;font-size:16px;'><b>An error occurred</b><br>The error was reported with the following id: '" + errorId + "'<br><br><span style='color:black;font-weight:bold;font-size:16px'>Please press and hold Ctrl and press F5 to reload this page, if the problem persists please send this error message to your webmaster: </span><div style='color:black;font-size:14px'>'"
-          + "ErrorId: " + errorId + "<br>URL: " + window.location.href + "<br>UserAgent: " + userAgent + "<br>" + msg + " in " + url + " at line " + linenumber + "'</div></div>");
+          + "ErrorId: " + errorId + "<br>URL: " + padutils.escapeHtml(window.location.href) + "<br>UserAgent: " + userAgent + "<br>" + msg + " in " + url + " at line " + linenumber + "'</div></div>");
       }
 
       //send javascript errors to the server
