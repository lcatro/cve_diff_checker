From c89158ec646c4e8e95587b650f6fd86b502ff8b5 Mon Sep 17 00:00:00 2001
From: DukeReborn <dukereborn@gmail.com>
Date: Sun, 26 Apr 2015 11:40:24 +0200
Subject: [PATCH] Check for invalid characters in username and password

---
 CHANGELOG       |  1 +
 js/ajaxcalls.js | 16 ++++++++++++++++
 js/cmum.js      |  9 +++++++++
 3 files changed, 26 insertions(+)

diff --git a/CHANGELOG b/CHANGELOG
index fc8ba78..a1db94f 100755
--- a/CHANGELOG
+++ b/CHANGELOG
@@ -9,6 +9,7 @@ CSP MySQL User Manager Changelog
 3.2.0 [not yet released]
 [+] Enable/disable groups
 [+] Override and force database upgrade
+[+] Check for invalid characters in username and password
 [#] Changed update check url for new releases
 [#] Removed cmum dbversion from database
 
diff --git a/js/ajaxcalls.js b/js/ajaxcalls.js
index e162405..49e36c3 100755
--- a/js/ajaxcalls.js
+++ b/js/ajaxcalls.js
@@ -8,6 +8,14 @@ function checkusername() {
 				} else if(password=="") {
 					newuser.password.focus();
 				}
+		} else if(alphanumeric(username)==false || alphanumeric(password)==false) {
+			if(alphanumeric(username)==false) {
+				toastr.error('Username contains invalid characters');
+				newuser.user.focus();
+			} else if(alphanumeric(password)==false) {
+				toastr.error('Password contains invalid characters');
+				newuser.password.focus();
+			}
 		} else {
 			jQuery.ajax({
 				type: 'post',
@@ -38,6 +46,14 @@ function checkeditusername() {
 				if(username=="") {
 					edituser.user.focus();
 				}
+		} else if(alphanumeric(username)==false || alphanumeric(password)==false) {
+			if(alphanumeric(username)==false) {
+				toastr.error('Username contains invalid characters');
+				newuser.user.focus();
+			} else if(alphanumeric(password)==false) {
+				toastr.error('Password contains invalid characters');
+				newuser.password.focus();
+			}
 		} else {
 			if(username!=rusername) {
 				jQuery.ajax({
diff --git a/js/cmum.js b/js/cmum.js
index 01836ff..d416400 100755
--- a/js/cmum.js
+++ b/js/cmum.js
@@ -54,4 +54,13 @@ function checksearch(e) {
 				$('#newsearch').trigger('submit', true);
 			}
 	}
+}
+
+function alphanumeric(inputtxt) { 
+	var letters = /^[0-9a-zA-Z]+$/;
+		if (letters.test(inputtxt)) {
+			return true;
+		} else {
+			return false;
+		}
 }
\ No newline at end of file
