From 164963100a830234744a6004d5eda55d24e97b2a Mon Sep 17 00:00:00 2001
From: mokaddem <sami.mokaddem@circl.lu>
Date: Tue, 15 Sep 2020 11:55:50 +0200
Subject: [PATCH] fix: [users] Avoid POSTing forms not linked to the login page
 resulting in unwanted actions

- As reported by Michael Kerscher
---
 app/View/Users/login.ctp | 5 ++++-
 1 file changed, 4 insertions(+), 1 deletion(-)

diff --git a/app/View/Users/login.ctp b/app/View/Users/login.ctp
index 6c1dc862f3..4941eed302 100644
--- a/app/View/Users/login.ctp
+++ b/app/View/Users/login.ctp
@@ -81,7 +81,10 @@ function submitLoginForm() {
         $form[0].reportValidity()
     } else {
         fetchFormDataAjax(url, function(html) {
-            var formHTML = $(html).find('form')
+            var formHTML = $(html).find('form#UserLoginForm')
+            if (!formHTML.length) {
+                window.location = baseurl + '/users/login'
+            }
             $('body').append($('<div id="temp" style="display: none"/>').append(formHTML))
             var $tmpForm = $('#temp form')
             $tmpForm.find('#UserEmail').val(email)
