From 4d80f8b3e1b00a3edcee0774dc9c2f4c78f9e663 Mon Sep 17 00:00:00 2001
From: Aaron Campbell <aaron@xavisys.com>
Date: Mon, 6 Mar 2017 12:55:41 +0000
Subject: [PATCH] Plugins: Add file check to plugin deletions.

Built from https://develop.svn.wordpress.org/trunk@40169


git-svn-id: http://core.svn.wordpress.org/trunk@40108 1a063a9b-81f0-0310-95a4-ce76da25c4cd
---
 wp-admin/plugins.php    | 8 ++++++++
 wp-includes/version.php | 2 +-
 2 files changed, 9 insertions(+), 1 deletion(-)

diff --git a/wp-admin/plugins.php b/wp-admin/plugins.php
index 2eeea4eb9f50..3d7ff016e509 100644
--- a/wp-admin/plugins.php
+++ b/wp-admin/plugins.php
@@ -246,6 +246,14 @@
 				exit;
 			}
 
+			// Bail on all if any paths are invalid.
+			// validate_file() returns truthy for invalid files
+			$invalid_plugin_files = array_filter( $plugins, 'validate_file' );
+			if ( $invalid_plugin_files ) {
+				wp_redirect( self_admin_url("plugins.php?plugin_status=$status&paged=$page&s=$s") );
+				exit;
+			}
+
 			include(ABSPATH . 'wp-admin/update.php');
 
 			$parent_file = 'plugins.php';
diff --git a/wp-includes/version.php b/wp-includes/version.php
index 656a2009194e..9f9a17f942bb 100644
--- a/wp-includes/version.php
+++ b/wp-includes/version.php
@@ -4,7 +4,7 @@
  *
  * @global string $wp_version
  */
-$wp_version = '4.8-alpha-40160';
+$wp_version = '4.8-alpha-40169';
 
 /**
  * Holds the WordPress DB revision, increments when changes are made to the WordPress DB schema.
