From b6d838eebf4456192360654092e5587c5207f185 Mon Sep 17 00:00:00 2001
From: Michael Mann <mmann78@netscape.net>
Date: Mon, 9 May 2016 20:41:45 -0400
Subject: [PATCH] Sanity check eapol_len in AirPDcapDecryptWPABroadcastKey

Bug: 12175
Change-Id: Iaf977ba48f8668bf8095800a115ff9a3472dd893
Reviewed-on: https://code.wireshark.org/review/15326
Petri-Dish: Michael Mann <mmann78@netscape.net>
Tested-by: Petri Dish Buildbot <buildbot-no-reply@wireshark.org>
Reviewed-by: Alexis La Goutte <alexis.lagoutte@gmail.com>
Reviewed-by: Peter Wu <peter@lekensteyn.nl>
Tested-by: Peter Wu <peter@lekensteyn.nl>
---
 epan/crypt/airpdcap.c | 4 +++-
 1 file changed, 3 insertions(+), 1 deletion(-)

diff --git a/epan/crypt/airpdcap.c b/epan/crypt/airpdcap.c
index bb4d7bc43de..dd948a0d1d6 100644
--- a/epan/crypt/airpdcap.c
+++ b/epan/crypt/airpdcap.c
@@ -351,7 +351,9 @@ AirPDcapDecryptWPABroadcastKey(const EAPOL_RSN_KEY *pEAPKey, guint8 *decryption_
         }
     }
 
-    if (key_bytes_len < GROUP_KEY_MIN_LEN || key_bytes_len > eapol_len - sizeof(EAPOL_RSN_KEY)) {
+    if ((key_bytes_len < GROUP_KEY_MIN_LEN) ||
+        (eapol_len < sizeof(EAPOL_RSN_KEY)) ||
+        (key_bytes_len > eapol_len - sizeof(EAPOL_RSN_KEY))) {
         return AIRPDCAP_RET_NO_VALID_HANDSHAKE;
     }
 
