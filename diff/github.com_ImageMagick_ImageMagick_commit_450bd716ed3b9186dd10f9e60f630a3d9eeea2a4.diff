From 450bd716ed3b9186dd10f9e60f630a3d9eeea2a4 Mon Sep 17 00:00:00 2001
From: cristy <urban-warrior@git.imagemagick.org>
Date: Fri, 9 Jan 2015 20:02:31 +0000
Subject: [PATCH]

---
 MagickCore/composite.c      |  2 +-
 MagickCore/pixel-accessor.h | 13 +++++++++++++
 MagickCore/threshold.c      | 13 -------------
 coders/sun.c                |  2 ++
 4 files changed, 16 insertions(+), 14 deletions(-)

diff --git a/MagickCore/composite.c b/MagickCore/composite.c
index f211a266e6..9c8a5ed624 100644
--- a/MagickCore/composite.c
+++ b/MagickCore/composite.c
@@ -2305,7 +2305,7 @@ if (0)
             break;
           }
         }
-        q[i]=ClampToQuantum(pixel);
+        q[i]=ClampPixel(pixel);
       }
       p+=GetPixelChannels(composite_image);
       channels=GetPixelChannels(composite_image);
diff --git a/MagickCore/pixel-accessor.h b/MagickCore/pixel-accessor.h
index 2b9b0603ba..79ddb725f3 100644
--- a/MagickCore/pixel-accessor.h
+++ b/MagickCore/pixel-accessor.h
@@ -31,6 +31,19 @@ extern "C" {
 
 #undef index
 
+static inline Quantum ClampPixel(const MagickRealType value)
+{
+#if !defined(MAGICKCORE_HDRI_SUPPORT)
+  return((Quantum) value);
+#else
+  if (value < 0.0)
+    return((Quantum) 0.0);
+  if (value >= (MagickRealType) QuantumRange)
+    return((Quantum) QuantumRange);
+  return((Quantum) value);
+#endif
+}
+
 static inline Quantum GetPixela(const Image *restrict image,
   const Quantum *restrict pixel)
 {
diff --git a/MagickCore/threshold.c b/MagickCore/threshold.c
index 788e33ee60..459b1a1847 100644
--- a/MagickCore/threshold.c
+++ b/MagickCore/threshold.c
@@ -685,19 +685,6 @@ MagickExport MagickBooleanType BlackThresholdImage(Image *image,
 %
 */
 
-static inline Quantum ClampPixel(const MagickRealType value)
-{
-#if !defined(MAGICKCORE_HDRI_SUPPORT)
-  return((Quantum) value);
-#else
-  if (value < 0.0f)
-    return(0.0);
-  if (value >= (MagickRealType) QuantumRange)
-    return((Quantum) QuantumRange);
-  return(value);
-#endif
-}
-
 MagickExport MagickBooleanType ClampImage(Image *image,ExceptionInfo *exception)
 {
 #define ClampImageTag  "Clamp/Image"
diff --git a/coders/sun.c b/coders/sun.c
index 8f92fc3713..af1a7289bf 100644
--- a/coders/sun.c
+++ b/coders/sun.c
@@ -337,6 +337,8 @@ static Image *ReadSUNImage(const ImageInfo *image_info,ExceptionInfo *exception)
       }
     switch (sun_info.maptype)
     {
+      case RMT_NONE:
+        break;
       case RMT_EQUAL_RGB:
       {
         unsigned char
