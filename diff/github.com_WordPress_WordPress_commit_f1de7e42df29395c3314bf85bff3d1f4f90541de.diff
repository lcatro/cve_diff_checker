From f1de7e42df29395c3314bf85bff3d1f4f90541de Mon Sep 17 00:00:00 2001
From: John Blackbourn <johnbillion@git.wordpress.org>
Date: Wed, 29 Nov 2017 15:56:48 +0000
Subject: [PATCH] Hardening: Ensure the attributes of enclosures are correctly
 escaped in RSS and Atom feeds.

Built from https://develop.svn.wordpress.org/trunk@42260


git-svn-id: http://core.svn.wordpress.org/trunk@42089 1a063a9b-81f0-0310-95a4-ce76da25c4cd
---
 wp-includes/feed.php    | 4 ++--
 wp-includes/version.php | 2 +-
 2 files changed, 3 insertions(+), 3 deletions(-)

diff --git a/wp-includes/feed.php b/wp-includes/feed.php
index 731b66ed6bc5..ef6bf2956205 100644
--- a/wp-includes/feed.php
+++ b/wp-includes/feed.php
@@ -476,7 +476,7 @@ function rss_enclosure() {
 				 *
 				 * @param string $html_link_tag The HTML link tag with a URI and other attributes.
 				 */
-				echo apply_filters( 'rss_enclosure', '<enclosure url="' . trim( htmlspecialchars( $enclosure[0] ) ) . '" length="' . trim( $enclosure[1] ) . '" type="' . $type . '" />' . "\n" );
+				echo apply_filters( 'rss_enclosure', '<enclosure url="' . esc_url( trim( $enclosure[0] ) ) . '" length="' . absint( trim( $enclosure[1] ) ) . '" type="' . esc_attr( $type ) . '" />' . "\n" );
 			}
 		}
 	}
@@ -510,7 +510,7 @@ function atom_enclosure() {
 				 *
 				 * @param string $html_link_tag The HTML link tag with a URI and other attributes.
 				 */
-				echo apply_filters( 'atom_enclosure', '<link href="' . trim( htmlspecialchars( $enclosure[0] ) ) . '" rel="enclosure" length="' . trim( $enclosure[1] ) . '" type="' . trim( $enclosure[2] ) . '" />' . "\n" );
+				echo apply_filters( 'atom_enclosure', '<link href="' . esc_url( trim( $enclosure[0] ) ) . '" rel="enclosure" length="' . absint( trim( $enclosure[1] ) ) . '" type="' . esc_attr( trim( $enclosure[2] ) ) . '" />' . "\n" );
 			}
 		}
 	}
diff --git a/wp-includes/version.php b/wp-includes/version.php
index 3869234559e7..cee0d424cda4 100644
--- a/wp-includes/version.php
+++ b/wp-includes/version.php
@@ -4,7 +4,7 @@
  *
  * @global string $wp_version
  */
-$wp_version = '5.0-alpha-42259';
+$wp_version = '5.0-alpha-42260';
 
 /**
  * Holds the WordPress DB revision, increments when changes are made to the WordPress DB schema.
