From 061e8788814ac87706d8b95688df276fe3c8596a Mon Sep 17 00:00:00 2001
From: Jeremy Felt <jeremy.felt@gmail.com>
Date: Wed, 11 Jan 2017 05:13:43 +0000
Subject: [PATCH] Mail: Disable wp-mail.php when `mailserver_url` is
 mail.example.com.

Built from https://develop.svn.wordpress.org/trunk@39772


git-svn-id: http://core.svn.wordpress.org/trunk@39710 1a063a9b-81f0-0310-95a4-ce76da25c4cd
---
 wp-includes/version.php | 2 +-
 wp-mail.php             | 6 ++++++
 2 files changed, 7 insertions(+), 1 deletion(-)

diff --git a/wp-includes/version.php b/wp-includes/version.php
index 25e7cf5e328a..58890b89743a 100644
--- a/wp-includes/version.php
+++ b/wp-includes/version.php
@@ -4,7 +4,7 @@
  *
  * @global string $wp_version
  */
-$wp_version = '4.8-alpha-39760';
+$wp_version = '4.8-alpha-39772';
 
 /**
  * Holds the WordPress DB revision, increments when changes are made to the WordPress DB schema.
diff --git a/wp-mail.php b/wp-mail.php
index e62bbf12158d..35fb24aed264 100644
--- a/wp-mail.php
+++ b/wp-mail.php
@@ -14,6 +14,12 @@
 if ( ! apply_filters( 'enable_post_by_email_configuration', true ) )
 	wp_die( __( 'This action has been disabled by the administrator.' ), 403 );
 
+$mailserver_url = get_option( 'mailserver_url' );
+
+if ( 'mail.example.com' === $mailserver_url || empty( $mailserver_url ) ) {
+	wp_die( __( 'This action has been disabled by the administrator.' ), 403 );
+}
+
 /**
  * Fires to allow a plugin to do a complete takeover of Post by Email.
  *
