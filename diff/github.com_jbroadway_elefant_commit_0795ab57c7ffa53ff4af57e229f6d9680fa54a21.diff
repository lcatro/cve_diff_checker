From 0795ab57c7ffa53ff4af57e229f6d9680fa54a21 Mon Sep 17 00:00:00 2001
From: lux <john@flipsidexr.com>
Date: Tue, 11 Sep 2018 02:14:22 -0500
Subject: [PATCH] Fixed CSS preview including PHP tags, re: #286

---
 apps/designer/handlers/csspreview.php | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

diff --git a/apps/designer/handlers/csspreview.php b/apps/designer/handlers/csspreview.php
index 7e7e0a31..a9d407c6 100644
--- a/apps/designer/handlers/csspreview.php
+++ b/apps/designer/handlers/csspreview.php
@@ -23,7 +23,7 @@
 		}
 	}
 	if ($_GET['css'] && preg_match ('/^(layouts|css)\/[a-z0-9\/ _-]+\.css$/i', $_GET['css'])) {
-		$page->layout = str_replace ('</head>', '<style>' . file_get_contents ($_GET['css']) . '</style></head>', $page->layout);
+		$page->layout = str_replace ('</head>', '<style>' . strip_tags (file_get_contents ($_GET['css'])) . '</style></head>', $page->layout);
 	}
 } else {
 	if (! empty ($_POST['layout'])) {
@@ -36,7 +36,7 @@
 		}
 	}
 	if ($_POST['css']) {
-		$page->layout = str_replace ('</head>', '<style>' . $_POST['css'] . '</style></head>', $page->layout);
+		$page->layout = str_replace ('</head>', '<style>' . strip_tags ($_POST['css']) . '</style></head>', $page->layout);
 	}	
 }
 
