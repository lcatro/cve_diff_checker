From 7d63315a64267c565d1f34b9cb523a14616fed24 Mon Sep 17 00:00:00 2001
From: Cristy <urban-warrior@imagemagick.org>
Date: Mon, 7 Aug 2017 14:59:43 -0400
Subject: [PATCH] https://github.com/ImageMagick/ImageMagick/issues/654

---
 coders/wpg.c | 2 ++
 1 file changed, 2 insertions(+)

diff --git a/coders/wpg.c b/coders/wpg.c
index ae43f9cc36..4756dba3f4 100644
--- a/coders/wpg.c
+++ b/coders/wpg.c
@@ -1035,6 +1035,8 @@ static Image *ReadWPGImage(const ImageInfo *image_info,
           if(i==EOF)
             break;
           Rd_WP_DWORD(image,&Rec.RecordLength);
+          if (Rec.RecordLength > GetBlobSize(image))
+            ThrowReaderException(CorruptImageError,"ImproperImageHeader");
           if(EOFBlob(image))
             break;
 
