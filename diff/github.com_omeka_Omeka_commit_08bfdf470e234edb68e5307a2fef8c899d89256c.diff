From 08bfdf470e234edb68e5307a2fef8c899d89256c Mon Sep 17 00:00:00 2001
From: John Flatness <john@zerocrates.org>
Date: Wed, 3 Feb 2021 13:27:12 -0500
Subject: [PATCH] Apply HTML filtering to files form

(fix #935)
---
 .../Omeka/Controller/Plugin/HtmlPurifier.php   | 18 ++++++++++++++++++
 1 file changed, 18 insertions(+)

diff --git a/application/libraries/Omeka/Controller/Plugin/HtmlPurifier.php b/application/libraries/Omeka/Controller/Plugin/HtmlPurifier.php
index cb0ce85f36..322e36a23b 100644
--- a/application/libraries/Omeka/Controller/Plugin/HtmlPurifier.php
+++ b/application/libraries/Omeka/Controller/Plugin/HtmlPurifier.php
@@ -106,6 +106,24 @@ public function filterCollectionsForm($request, $htmlPurifierFilter = null)
         $request->setPost($post);
     }
 
+    /**
+     * Filter the Files form post, including the 'Elements' array of the POST.
+     *
+     * @param Zend_Controller_Request_Abstract $request
+     * @param Omeka_Filter_HtmlPurifier $htmlPurifierFilter
+     **/
+    public function filterFilesForm($request, $htmlPurifierFilter = null)
+    {
+        if ($htmlPurifierFilter === null) {
+            $htmlPurifierFilter = new Omeka_Filter_HtmlPurifier();
+        }
+
+        $post = $request->getPost();
+        $post = $this->_filterElementsFromPost($post, $htmlPurifierFilter);
+
+        $request->setPost($post);
+    }
+
     /**
      * Purify all of the data in the theme settings
      *
