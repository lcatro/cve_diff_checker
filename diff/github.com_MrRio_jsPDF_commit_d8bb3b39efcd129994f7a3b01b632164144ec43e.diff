From d8bb3b39efcd129994f7a3b01b632164144ec43e Mon Sep 17 00:00:00 2001
From: Yeting Li <liyt@ios.ac.cn>
Date: Thu, 11 Feb 2021 23:50:17 +0800
Subject: [PATCH] fix ReDoS-vulnerable regexp in addImage (#3091)

---
 src/modules/addimage.js | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/src/modules/addimage.js b/src/modules/addimage.js
index 5d206606f..d0295d0ca 100644
--- a/src/modules/addimage.js
+++ b/src/modules/addimage.js
@@ -630,7 +630,7 @@ import { atob, btoa } from "../libs/AtobBtoa.js";
     var result = null;
 
     if (dataUrlParts.length === 2) {
-      var extractedInfo = /^data:(\w*\/\w*);*(charset=[\w=-]*)*;*$/.exec(
+      var extractedInfo = /^data:(\w*\/\w*);*(charset=(?!charset=)[\w=-]*)*;*$/.exec(
         dataUrlParts[0]
       );
       if (Array.isArray(extractedInfo)) {
