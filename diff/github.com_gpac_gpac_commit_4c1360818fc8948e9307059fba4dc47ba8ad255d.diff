From 4c1360818fc8948e9307059fba4dc47ba8ad255d Mon Sep 17 00:00:00 2001
From: Aurelien David <aurelien.david@telecom-paristech.fr>
Date: Thu, 13 Dec 2018 14:39:21 +0100
Subject: [PATCH] check error code on call to gf_utf8_wcstombs (#1177)

---
 src/media_tools/text_import.c | 2 ++
 1 file changed, 2 insertions(+)

diff --git a/src/media_tools/text_import.c b/src/media_tools/text_import.c
index bfba2f3bc3..18f10f33d1 100644
--- a/src/media_tools/text_import.c
+++ b/src/media_tools/text_import.c
@@ -269,6 +269,8 @@ char *gf_text_get_utf8_line(char *szLine, u32 lineSize, FILE *txt_in, s32 unicod
 	}
 	sptr = (u16 *)szLine;
 	i = (u32) gf_utf8_wcstombs(szLineConv, 1024, (const unsigned short **) &sptr);
+	if (i >= (u32)ARRAY_LENGTH(szLineConv))
+		return NULL;
 	szLineConv[i] = 0;
 	strcpy(szLine, szLineConv);
 	/*this is ugly indeed: since input is UTF16-LE, there are many chances the fgets never reads the \0 after a \n*/
