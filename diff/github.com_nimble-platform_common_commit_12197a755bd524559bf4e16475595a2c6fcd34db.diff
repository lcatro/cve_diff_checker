From 12197a755bd524559bf4e16475595a2c6fcd34db Mon Sep 17 00:00:00 2001
From: Oliver Jung <oliver.jung@salzburgresearch.at>
Date: Thu, 20 May 2021 10:02:42 +0200
Subject: [PATCH] Fixed JWT validation according to
 https://github.com/nimble-platform/common/security/advisories/GHSA-fjq8-896w-pv28

---
 .../main/java/eu/nimble/utility/validation/ValidationUtil.java  | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/utility/src/main/java/eu/nimble/utility/validation/ValidationUtil.java b/utility/src/main/java/eu/nimble/utility/validation/ValidationUtil.java
index 60780c2..b235dd3 100644
--- a/utility/src/main/java/eu/nimble/utility/validation/ValidationUtil.java
+++ b/utility/src/main/java/eu/nimble/utility/validation/ValidationUtil.java
@@ -36,7 +36,7 @@ public Claims validateToken(String token) throws AuthenticationException {
             RsaKeyUtil rsaKeyUtil = new RsaKeyUtil();
             PublicKey publicKey = rsaKeyUtil.fromPemEncoded(keycloakPublicKey);
 
-            return (Claims) Jwts.parser().setSigningKey(publicKey).parse(token.replace("Bearer ", "")).getBody();
+            return Jwts.parser().setSigningKey(publicKey).parseJws(token.replace("Bearer ", "")).getBody();
         } catch (Exception e){
             throw new AuthenticationException(String.format("Failed to check user authorization for token: %s", token), e);
         }
