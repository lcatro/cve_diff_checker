From 3afc5a663c49eb9d727f3fc0004d78c4a8ff8e39 Mon Sep 17 00:00:00 2001
From: Pierre RAMBAUD <pierre.rambaud@prestashop.com>
Date: Tue, 10 Nov 2020 16:38:01 +0100
Subject: [PATCH] Make sure the user is connected before submit reorder

---
 controllers/front/OrderController.php | 5 ++++-
 1 file changed, 4 insertions(+), 1 deletion(-)

diff --git a/controllers/front/OrderController.php b/controllers/front/OrderController.php
index 76484e1ce2ed..1ba884a735a4 100644
--- a/controllers/front/OrderController.php
+++ b/controllers/front/OrderController.php
@@ -58,7 +58,10 @@ public function postProcess()
     {
         parent::postProcess();
 
-        if (Tools::isSubmit('submitReorder') && $id_order = (int) Tools::getValue('id_order')) {
+        if (Tools::isSubmit('submitReorder')
+            && $this->context->customer->isLogged()
+            && $id_order = (int) Tools::getValue('id_order')
+        ) {
             $oldCart = new Cart(Order::getCartIdStatic($id_order, $this->context->customer->id));
             $duplication = $oldCart->duplicate();
             if (!$duplication || !Validate::isLoadedObject($duplication['cart'])) {
