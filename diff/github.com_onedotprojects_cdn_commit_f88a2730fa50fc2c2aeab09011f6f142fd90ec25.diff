From f88a2730fa50fc2c2aeab09011f6f142fd90ec25 Mon Sep 17 00:00:00 2001
From: "Wgyt (William)" <>
Date: Sun, 16 May 2021 12:37:57 +0000
Subject: [PATCH] security

---
 index.js          | 12 ++++----
 package-lock.json | 76 ++++++++++++++++++++++++++++++++++++++++++-----
 package.json      |  6 ++--
 3 files changed, 78 insertions(+), 16 deletions(-)

diff --git a/index.js b/index.js
index 4f5c991..9e72529 100644
--- a/index.js
+++ b/index.js
@@ -3,7 +3,8 @@
 const { decode } = require("url-encode-decode"),
 	fileSystem = require("fs"),
 	http = require("http"),
-	mime = require("mime");
+	mime = require("mime"),
+	sanitizeHtml = require('sanitize-html');
 http.createServer((req, res) => {
 	const url = decode(req.url).replace("//", "/");
 	try {
@@ -14,7 +15,7 @@ http.createServer((req, res) => {
 			});
 			res.end(data);
 		} else {
-			res.write(`<h1>Index of ${url}</h1><br><hr>`);
+			res.write(`<body style="background-image:url('/background.svg')"><h1>Index of ${url}</h1><br><hr>`);
 			if (url !== "/") {
 				res.write('<br><a href="..">..</a>');
 			}
@@ -22,7 +23,7 @@ http.createServer((req, res) => {
 				if (error) {
 					res.writeHead(500, { "Content-Type": "text/html" });
 					return res.end(
-						`<h1>there was an error processing your request:</h1>\n<br/>\n<p>${error}</p>`,
+						`<h1>there was an error processing your request:</h1>\n<br/>\n<p>${sanitizeHtml(error)}</p>`,
 					);
 				}
 				files.forEach((file) => {
@@ -35,13 +36,14 @@ http.createServer((req, res) => {
 					}
 					return res.write(`<br><a href="${file}">${file}</a>`);
 				});
+				res.write('</body>')
 				res.end();
 			});
 		}
 	} catch (error) {
 		res.writeHead(500, { "Content-Type": "text/html" });
-		res.end(
-			`<h1>there was an error processing your request:</h1>\n<br/>\n<p>${error}</p>`,
+		return res.end(
+			`<h1>there was an error processing your request:</h1>\n<br/>\n<p>${sanitizeHtml(error)}</p>`,
 		);
 	}
 }).listen(process.env.PORT || 3000);
diff --git a/package-lock.json b/package-lock.json
index 0747aa1..4f3ceb8 100644
--- a/package-lock.json
+++ b/package-lock.json
@@ -478,6 +478,11 @@
 			"integrity": "sha1-p9BVi9icQveV3UIyj3QIMcpTvCU=",
 			"dev": true
 		},
+		"colorette": {
+			"version": "1.2.2",
+			"resolved": "https://registry.npmjs.org/colorette/-/colorette-1.2.2.tgz",
+			"integrity": "sha512-MKGMzyfeuutC/ZJ1cba9NqcNpfeqMUcYmyF1ZFY6/Cn7CNSAKx6a+s48sqLqyAiZuaP2TcqMhoo+dlwFnVxT9w=="
+		},
 		"commander": {
 			"version": "2.20.3",
 			"resolved": "https://registry.npmjs.org/commander/-/commander-2.20.3.tgz",
@@ -572,6 +577,11 @@
 			"integrity": "sha1-s2nW+128E+7PUk+RsHD+7cNXzzQ=",
 			"dev": true
 		},
+		"deepmerge": {
+			"version": "4.2.2",
+			"resolved": "https://registry.npmjs.org/deepmerge/-/deepmerge-4.2.2.tgz",
+			"integrity": "sha512-FJ3UgI4gIl+PHZm53knsuSFpE+nESMr7M4v9QcgB7S63Kj/6WqMiFQJpBBYz1Pt+66bZpP3Q7Lye0Oo9MPKEdg=="
+		},
 		"defer-to-connect": {
 			"version": "1.1.3",
 			"resolved": "https://registry.npmjs.org/defer-to-connect/-/defer-to-connect-1.1.3.tgz",
@@ -591,7 +601,6 @@
 			"version": "1.3.1",
 			"resolved": "https://registry.npmjs.org/dom-serializer/-/dom-serializer-1.3.1.tgz",
 			"integrity": "sha512-Pv2ZluG5ife96udGgEDovOOOA5UELkltfJpnIExPrAk1LTvecolUGn6lIaoLh86d83GiB86CjzciMd9BuRB71Q==",
-			"dev": true,
 			"requires": {
 				"domelementtype": "^2.0.1",
 				"domhandler": "^4.0.0",
@@ -601,14 +610,12 @@
 		"domelementtype": {
 			"version": "2.2.0",
 			"resolved": "https://registry.npmjs.org/domelementtype/-/domelementtype-2.2.0.tgz",
-			"integrity": "sha512-DtBMo82pv1dFtUmHyr48beiuq792Sxohr+8Hm9zoxklYPfa6n0Z3Byjj2IV7bmr2IyqClnqEQhfgHJJ5QF0R5A==",
-			"dev": true
+			"integrity": "sha512-DtBMo82pv1dFtUmHyr48beiuq792Sxohr+8Hm9zoxklYPfa6n0Z3Byjj2IV7bmr2IyqClnqEQhfgHJJ5QF0R5A=="
 		},
 		"domhandler": {
 			"version": "4.2.0",
 			"resolved": "https://registry.npmjs.org/domhandler/-/domhandler-4.2.0.tgz",
 			"integrity": "sha512-zk7sgt970kzPks2Bf+dwT/PLzghLnsivb9CcxkvR8Mzr66Olr0Ofd8neSbglHJHaHa2MadfoSdNlKYAaafmWfA==",
-			"dev": true,
 			"requires": {
 				"domelementtype": "^2.2.0"
 			}
@@ -617,7 +624,6 @@
 			"version": "2.6.0",
 			"resolved": "https://registry.npmjs.org/domutils/-/domutils-2.6.0.tgz",
 			"integrity": "sha512-y0BezHuy4MDYxh6OvolXYsH+1EMGmFbwv5FKW7ovwMG6zTPWqNPq3WF9ayZssFq+UlKdffGLbOEaghNdaOm1WA==",
-			"dev": true,
 			"requires": {
 				"dom-serializer": "^1.0.1",
 				"domelementtype": "^2.2.0",
@@ -672,8 +678,7 @@
 		"entities": {
 			"version": "2.2.0",
 			"resolved": "https://registry.npmjs.org/entities/-/entities-2.2.0.tgz",
-			"integrity": "sha512-p92if5Nz619I0w+akJrLZH0MX0Pb5DX39XOwQTtXSdQQOaYH03S1uIQp4mhOZtAXrxq4ViO67YTiLBo2638o9A==",
-			"dev": true
+			"integrity": "sha512-p92if5Nz619I0w+akJrLZH0MX0Pb5DX39XOwQTtXSdQQOaYH03S1uIQp4mhOZtAXrxq4ViO67YTiLBo2638o9A=="
 		},
 		"escape-goat": {
 			"version": "2.1.1",
@@ -1021,7 +1026,6 @@
 			"version": "6.1.0",
 			"resolved": "https://registry.npmjs.org/htmlparser2/-/htmlparser2-6.1.0.tgz",
 			"integrity": "sha512-gyyPk6rgonLFEDGoeRgQNaEUvdJ4ktTmmUh/h2t7s+M8oPpIPxgNACWa+6ESR57kXstwqPiCut0V8NRpcwgU7A==",
-			"dev": true,
 			"requires": {
 				"domelementtype": "^2.0.1",
 				"domhandler": "^4.0.0",
@@ -1164,6 +1168,11 @@
 			"integrity": "sha512-Fd4gABb+ycGAmKou8eMftCupSir5lRxqf4aD/vd0cD2qc4HL07OjCeuHMr8Ro4CoMaeCKDB0/ECBOVWjTwUvPQ==",
 			"dev": true
 		},
+		"is-plain-object": {
+			"version": "5.0.0",
+			"resolved": "https://registry.npmjs.org/is-plain-object/-/is-plain-object-5.0.0.tgz",
+			"integrity": "sha512-VRSzKkbMm5jMDoKLbltAkFQ5Qr7VDiTFGXxYFXXowVj387GeGNOCsOH6Msy00SGZ3Fp84b1Naa1psqgcCIEP5Q=="
+		},
 		"is-typedarray": {
 			"version": "1.0.0",
 			"resolved": "https://registry.npmjs.org/is-typedarray/-/is-typedarray-1.0.0.tgz",
@@ -1323,6 +1332,11 @@
 				"json-buffer": "3.0.0"
 			}
 		},
+		"klona": {
+			"version": "2.0.4",
+			"resolved": "https://registry.npmjs.org/klona/-/klona-2.0.4.tgz",
+			"integrity": "sha512-ZRbnvdg/NxqzC7L9Uyqzf4psi1OM4Cuc+sJAkQPjO6XkQIJTNbfK2Rsmbw8fx1p2mkZdp2FZYo2+LwXYY/uwIA=="
+		},
 		"latest-version": {
 			"version": "5.1.0",
 			"resolved": "https://registry.npmjs.org/latest-version/-/latest-version-5.1.0.tgz",
@@ -1424,6 +1438,11 @@
 			"integrity": "sha512-sGkPx+VjMtmA6MX27oA4FBFELFCZZ4S4XqeGOXCv68tT+jb3vk/RyaKWP0PTKyWtmLSM0b+adUTEvbs1PEaH2w==",
 			"dev": true
 		},
+		"nanoid": {
+			"version": "3.1.23",
+			"resolved": "https://registry.npmjs.org/nanoid/-/nanoid-3.1.23.tgz",
+			"integrity": "sha512-FiB0kzdP0FFVGDKlRLEQ1BgDzU87dy5NnzjeW9YZNt+/c3+q82EQDUwniSAUxp/F0gFNI1ZhKU1FqYsMuqZVnw=="
+		},
 		"natural-compare": {
 			"version": "1.4.0",
 			"resolved": "https://registry.npmjs.org/natural-compare/-/natural-compare-1.4.0.tgz",
@@ -1550,6 +1569,11 @@
 				"callsites": "^3.0.0"
 			}
 		},
+		"parse-srcset": {
+			"version": "1.0.2",
+			"resolved": "https://registry.npmjs.org/parse-srcset/-/parse-srcset-1.0.2.tgz",
+			"integrity": "sha1-8r0iH2zJcKk42IVWq8WJyqqiveE="
+		},
 		"passive-voice": {
 			"version": "0.1.0",
 			"resolved": "https://registry.npmjs.org/passive-voice/-/passive-voice-0.1.0.tgz",
@@ -1574,6 +1598,16 @@
 			"integrity": "sha512-KpELjfwcCDUb9PeigTs2mBJzXUPzAuP2oPcA989He8Rte0+YUAjw1JVedDhuTKPkHjSYzMN3npC9luThGYEKdg==",
 			"dev": true
 		},
+		"postcss": {
+			"version": "8.2.15",
+			"resolved": "https://registry.npmjs.org/postcss/-/postcss-8.2.15.tgz",
+			"integrity": "sha512-2zO3b26eJD/8rb106Qu2o7Qgg52ND5HPjcyQiK2B98O388h43A448LCslC0dI2P97wCAQRJsFvwTRcXxTKds+Q==",
+			"requires": {
+				"colorette": "^1.2.2",
+				"nanoid": "^3.1.23",
+				"source-map": "^0.6.1"
+			}
+		},
 		"prelude-ls": {
 			"version": "1.2.1",
 			"resolved": "https://registry.npmjs.org/prelude-ls/-/prelude-ls-1.2.1.tgz",
@@ -1724,6 +1758,27 @@
 				"glob": "^7.1.3"
 			}
 		},
+		"sanitize-html": {
+			"version": "2.3.3",
+			"resolved": "https://registry.npmjs.org/sanitize-html/-/sanitize-html-2.3.3.tgz",
+			"integrity": "sha512-DCFXPt7Di0c6JUnlT90eIgrjs6TsJl/8HYU3KLdmrVclFN4O0heTcVbJiMa23OKVr6aR051XYtsgd8EWwEBwUA==",
+			"requires": {
+				"deepmerge": "^4.2.2",
+				"escape-string-regexp": "^4.0.0",
+				"htmlparser2": "^6.0.0",
+				"is-plain-object": "^5.0.0",
+				"klona": "^2.0.3",
+				"parse-srcset": "^1.0.2",
+				"postcss": "^8.0.2"
+			},
+			"dependencies": {
+				"escape-string-regexp": {
+					"version": "4.0.0",
+					"resolved": "https://registry.npmjs.org/escape-string-regexp/-/escape-string-regexp-4.0.0.tgz",
+					"integrity": "sha512-TtpcNJ3XAzx3Gq8sWRzJaVajRs0uVxA2YAkdb1jm2YkPz4G6egUFAyA3n5vtEIZefPk5Wa4UXbKuS5fKkJWdgA=="
+				}
+			}
+		},
 		"semver": {
 			"version": "7.3.5",
 			"resolved": "https://registry.npmjs.org/semver/-/semver-7.3.5.tgz",
@@ -1814,6 +1869,11 @@
 				}
 			}
 		},
+		"source-map": {
+			"version": "0.6.1",
+			"resolved": "https://registry.npmjs.org/source-map/-/source-map-0.6.1.tgz",
+			"integrity": "sha512-UjgapumWlbMhkBgzT7Ykc5YXUT46F0iKu8SGXq0bcwP5dz/h0Plj6enJqjz1Zbq2l5WaqYnrVbwWOWMyF3F47g=="
+		},
 		"sprintf-js": {
 			"version": "1.0.3",
 			"resolved": "https://registry.npmjs.org/sprintf-js/-/sprintf-js-1.0.3.tgz",
diff --git a/package.json b/package.json
index c242354..4b51c28 100644
--- a/package.json
+++ b/package.json
@@ -1,6 +1,5 @@
 {
 	"name": "@onedotprojects/cdn",
-	"description": "Branding for 1Dot",
 	"author": "OneDot Projects",
 	"keywords": [
 		"cdn",
@@ -28,11 +27,12 @@
 		"lint:spellchecker-cli": "npx spellchecker-cli *.md _locales/en_US.json .github/**/*.md .github/*.md --dictionaries dictionary.txt",
 		"lint:write_good": "find . -path ./node_modules -prune -false -o -name '*.md' | xargs -L1 npm run lint:write_good:config; npm run lint:write_good:config _locales/en_US.json",
 		"lint:write_good:config": "npx write-good --yes-eprime --parse",
-		"start": "node --trace-warnings --harmony src/index.js",
-		"start:dev": "npx nodemon --harmony --trace-warnings src/index.js"
+		"start": "node --trace-warnings --harmony index.js",
+		"start:dev": "npx nodemon --harmony --trace-warnings index.js"
 	},
 	"dependencies": {
 		"mime": "^2.5.2",
+		"sanitize-html": "^2.3.3",
 		"url-encode-decode": "^1.0.0"
 	},
 	"devDependencies": {
