From 9696012eecbafb0aa21cc346234512c29b474679 Mon Sep 17 00:00:00 2001
From: Francisco Mancardi <francisco.mancardi@gmail.com>
Date: Sat, 24 Feb 2018 17:21:33 +0100
Subject: [PATCH] Limit DB LOGIN NAMES length to avoid some kind of injection

---
 install/installNewDB.php | 15 +++++++++------
 1 file changed, 9 insertions(+), 6 deletions(-)

diff --git a/install/installNewDB.php b/install/installNewDB.php
index e6428ed0d2..dbfc376503 100644
--- a/install/installNewDB.php
+++ b/install/installNewDB.php
@@ -63,22 +63,25 @@
 $db_server = trim($_SESSION['databasehost']);
 $db_server = preg_replace($san,'',$db_server);
 
-$db_admin_name = trim($_SESSION['databaseloginname']);
-$db_admin_name = preg_replace($san,'',$db_admin_name);
-
 $db_admin_pass = trim($_SESSION['databaseloginpassword']);
 $db_admin_pass = preg_replace($san,'',$db_admin_pass);
 
 $db_type = trim($_SESSION['databasetype']);
 $db_type = preg_replace($san,'',$db_type);
 
-$tl_db_login = trim($_SESSION['tl_loginname']);
-$tl_db_login = preg_replace($san,'',$tl_db_login);
-
 $tl_db_passwd = trim($_SESSION['tl_loginpassword']);
 $tl_db_passwd = preg_replace($san,'',$tl_db_passwd);
 
 
+// will limit length to avoi some kind of injection
+// Choice: 32 
+$tl_db_login = trim($_SESSION['tl_loginname']);
+$tl_db_login = substr(preg_replace($san,'',$tl_db_login),0,32);
+
+$db_admin_name = trim($_SESSION['databaseloginname']);
+$db_admin_name = substr(preg_replace($san,'',$db_admin_name),0,32);
+
+
 
 $sql_create_schema = array();
 $sql_create_schema[] = "sql/{$db_type}/testlink_create_tables.sql";
