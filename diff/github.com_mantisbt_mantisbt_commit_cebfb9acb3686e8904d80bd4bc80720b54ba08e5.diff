From cebfb9acb3686e8904d80bd4bc80720b54ba08e5 Mon Sep 17 00:00:00 2001
From: Damien Regad <dregad@mantisbt.org>
Date: Sat, 21 Sep 2019 18:02:59 +0200
Subject: [PATCH] Escape GraphViz command before calling proc_open()

Fixes #26162, CVE-2019-15715

(cherry picked from commit 5fb979604d88c630343b3eaf2b435cd41918c501)
---
 core/graphviz_api.php | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/core/graphviz_api.php b/core/graphviz_api.php
index 1ee585a1bd..bc621b6f5b 100644
--- a/core/graphviz_api.php
+++ b/core/graphviz_api.php
@@ -352,7 +352,7 @@ function output( $p_format = 'dot', $p_headers = false ) {
 
 		# Start dot process
 
-		$t_command = $this->graphviz_tool . ' -T' . $p_format;
+		$t_command = escapeshellcmd( $this->graphviz_tool . ' -T' . $p_format );
 		$t_descriptors = array(
 			0 => array( 'pipe', 'r', ),
 			1 => array( 'pipe', 'w', ),
