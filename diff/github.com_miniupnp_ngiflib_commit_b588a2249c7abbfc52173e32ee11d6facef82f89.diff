From b588a2249c7abbfc52173e32ee11d6facef82f89 Mon Sep 17 00:00:00 2001
From: Thomas Bernard <miniupnp@free.fr>
Date: Wed, 2 May 2018 09:15:48 +0200
Subject: [PATCH] check GIF image position and dimensions

fixes #1
---
 ngiflib.c | 18 ++++++++++++++++++
 1 file changed, 18 insertions(+)

diff --git a/ngiflib.c b/ngiflib.c
index b4785b8..ac8dc2a 100644
--- a/ngiflib.c
+++ b/ngiflib.c
@@ -408,6 +408,24 @@ static int DecodeGifImg(struct ngiflib_img * i) {
 	i->width = GetWord(i->parent);	/* SizeX   */
 	i->height = GetWord(i->parent);	/* SizeY   */
 
+	if((i->width > i->parent->width) || (i->height > i->parent->height)) {
+#if !defined(NGIFLIB_NO_FILE)
+		if(i->parent->log) fprintf(i->parent->log, "*** ERROR *** Image bigger than global GIF canvas !\n");
+#endif
+		return -1;
+	}
+	if((i->posX + i->width) > i->parent->width) {
+#if !defined(NGIFLIB_NO_FILE)
+		if(i->parent->log) fprintf(i->parent->log, "*** WARNING *** Adjusting X position\n");
+#endif
+		i->posX = i->parent->width - i->width;
+	}
+	if((i->posY + i->height) > i->parent->height) {
+#if !defined(NGIFLIB_NO_FILE)
+		if(i->parent->log) fprintf(i->parent->log, "*** WARNING *** Adjusting Y position\n");
+#endif
+		i->posY = i->parent->height - i->height;
+	}
 	context.Xtogo = i->width;
 	context.curY = i->posY;
 #ifdef NGIFLIB_INDEXED_ONLY
