From 1119de642b136d20e810bb20f545069a01dd7cc9 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Maur=C3=ADcio=20Meneghini=20Fauth?= <mauricio@fauth.dev>
Date: Fri, 18 Oct 2019 18:03:53 -0300
Subject: [PATCH] Escape Git information on the index page
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

Signed-off-by: Maur√≠cio Meneghini Fauth <mauricio@fauth.dev>
---
 libraries/classes/Display/GitRevision.php | 15 ++++++++++-----
 libraries/classes/Footer.php              |  8 ++++----
 2 files changed, 14 insertions(+), 9 deletions(-)

diff --git a/libraries/classes/Display/GitRevision.php b/libraries/classes/Display/GitRevision.php
index 8b350e8caf9..4cbd0cf48dc 100644
--- a/libraries/classes/Display/GitRevision.php
+++ b/libraries/classes/Display/GitRevision.php
@@ -43,27 +43,32 @@ public static function display()
         );
         $commit_hash = '<strong title="'
             . htmlspecialchars($GLOBALS['PMA_Config']->get('PMA_VERSION_GIT_MESSAGE'))
-            . '">' . $commit_hash . '</strong>';
+            . '">' . htmlspecialchars($commit_hash) . '</strong>';
         if ($GLOBALS['PMA_Config']->get('PMA_VERSION_GIT_ISREMOTECOMMIT')) {
             $commit_hash = '<a href="'
                 . Core::linkURL(
                     'https://github.com/phpmyadmin/phpmyadmin/commit/'
-                    . $GLOBALS['PMA_Config']->get('PMA_VERSION_GIT_COMMITHASH')
+                    . htmlspecialchars($GLOBALS['PMA_Config']->get('PMA_VERSION_GIT_COMMITHASH'))
                 )
                 . '" rel="noopener noreferrer" target="_blank">' . $commit_hash . '</a>';
         }
 
         $branch = $GLOBALS['PMA_Config']->get('PMA_VERSION_GIT_BRANCH');
-        if ($GLOBALS['PMA_Config']->get('PMA_VERSION_GIT_ISREMOTEBRANCH')) {
+        $isRemoteBranch = $GLOBALS['PMA_Config']->get('PMA_VERSION_GIT_ISREMOTEBRANCH');
+        if ($isRemoteBranch) {
             $branch = '<a href="'
                 . Core::linkURL(
                     'https://github.com/phpmyadmin/phpmyadmin/tree/'
                     . $GLOBALS['PMA_Config']->get('PMA_VERSION_GIT_BRANCH')
                 )
-                . '" rel="noopener noreferrer" target="_blank">' . $branch . '</a>';
+                . '" rel="noopener noreferrer" target="_blank">' . htmlspecialchars($branch) . '</a>';
         }
         if ($branch !== false) {
-            $branch = sprintf(__('%1$s from %2$s branch'), $commit_hash, $branch);
+            $branch = sprintf(
+                __('%1$s from %2$s branch'),
+                $commit_hash,
+                $isRemoteBranch ? $branch : htmlspecialchars($branch)
+            );
         } else {
             $branch = $commit_hash . ' (' . __('no branch') . ')';
         }
diff --git a/libraries/classes/Footer.php b/libraries/classes/Footer.php
index 7ef6a63d57e..5398eed898b 100644
--- a/libraries/classes/Footer.php
+++ b/libraries/classes/Footer.php
@@ -83,10 +83,10 @@ private function _getDemoMessage()
             include './revision-info.php';
             $message .= sprintf(
                 __('Currently running Git revision %1$s from the %2$s branch.'),
-                '<a target="_blank" rel="noopener noreferrer" href="' . $repobase . $fullrevision . '">'
-                . $revision . '</a>',
-                '<a target="_blank" rel="noopener noreferrer" href="' . $repobranchbase . $branch . '">'
-                . $branch . '</a>'
+                '<a target="_blank" rel="noopener noreferrer" href="' . htmlspecialchars($repobase . $fullrevision) . '">'
+                . htmlspecialchars($revision) . '</a>',
+                '<a target="_blank" rel="noopener noreferrer" href="' . htmlspecialchars($repobranchbase . $branch) . '">'
+                . htmlspecialchars($branch) . '</a>'
             );
         } else {
             $message .= __('Git information missing!');
