From 6170024568f4dda310e98ef7508477b425c58d09 Mon Sep 17 00:00:00 2001
From: jeanlf <jeanlf@users.sourceforge.net>
Date: Sun, 7 Jul 2019 16:51:36 +0200
Subject: [PATCH] fixed potential crash - cf #1263

---
 src/isomedia/box_code_apple.c | 3 ++-
 1 file changed, 2 insertions(+), 1 deletion(-)

diff --git a/src/isomedia/box_code_apple.c b/src/isomedia/box_code_apple.c
index 8f6b08957f..00eee98cd9 100644
--- a/src/isomedia/box_code_apple.c
+++ b/src/isomedia/box_code_apple.c
@@ -112,7 +112,7 @@ GF_Err ilst_item_box_read(GF_Box *s,GF_BitStream *bs)
 	if (sub_type == GF_ISOM_BOX_TYPE_DATA ) {
 		e = gf_isom_box_parse(&a, bs);
 
-		if (!e && ptr->size < a->size) {
+		if (!e && a && (ptr->size < a->size)) {
 			GF_LOG(GF_LOG_ERROR, GF_LOG_CONTAINER, ("[isom] not enough bytes in box %s: %d left, reading %d (file %s, line %d)\n", gf_4cc_to_str(ptr->type), ptr->size, a->size, __FILE__, __LINE__ )); \
 			e = GF_ISOM_INVALID_FILE;
 		}
@@ -120,6 +120,7 @@ GF_Err ilst_item_box_read(GF_Box *s,GF_BitStream *bs)
 			if (a) gf_isom_box_del(a);
 			return e;
 		}
+		if (!a) return GF_NON_COMPLIANT_BITSTREAM;
 
 		ISOM_DECREASE_SIZE(ptr, a->size);
 
