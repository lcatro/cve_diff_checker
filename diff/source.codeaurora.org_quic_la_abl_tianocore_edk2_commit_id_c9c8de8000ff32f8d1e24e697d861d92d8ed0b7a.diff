From c9c8de8000ff32f8d1e24e697d861d92d8ed0b7a Mon Sep 17 00:00:00 2001
From: lijuang <lijuang@codeaurora.org>
Date: Thu, 12 Oct 2017 11:34:16 +0800
Subject: QcomModulePkg: Correct fdt size check

The fdt size must be greater than 0

Change-Id: Ia2af65f50bb2b0df858801d25ea3f85706f0e33e
---
 QcomModulePkg/Library/BootLib/UpdateDeviceTree.c | 5 +++--
 1 file changed, 3 insertions(+), 2 deletions(-)
 mode change 100644 => 100755 QcomModulePkg/Library/BootLib/UpdateDeviceTree.c

diff --git a/QcomModulePkg/Library/BootLib/UpdateDeviceTree.c b/QcomModulePkg/Library/BootLib/UpdateDeviceTree.c
old mode 100644
new mode 100755
index 1a76609..206ba9d
--- a/QcomModulePkg/Library/BootLib/UpdateDeviceTree.c
+++ b/QcomModulePkg/Library/BootLib/UpdateDeviceTree.c
@@ -186,8 +186,9 @@ UINT32 fdt_check_header_ext(VOID *fdt)
 	UINT32 sum;
 	fdt_start = (UINT64) fdt;
 
-	if(fdt_start + fdt_totalsize(fdt) < fdt_start)
-		return FDT_ERR_BADOFFSET;
+    if (fdt_start + fdt_totalsize (fdt) <= fdt_start) {
+        return FDT_ERR_BADOFFSET;
+    }
 	fdt_end = fdt_start + fdt_totalsize(fdt);
 
 	if (!(sum = ADD_OF(fdt_off_dt_struct(fdt), fdt_size_dt_struct(fdt)))) {
-- 
cgit v1.1

