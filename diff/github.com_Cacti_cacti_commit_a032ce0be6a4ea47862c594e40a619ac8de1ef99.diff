From a032ce0be6a4ea47862c594e40a619ac8de1ef99 Mon Sep 17 00:00:00 2001
From: cigamit <jimmy@sqmail.org>
Date: Tue, 15 Aug 2017 06:13:10 -0500
Subject: [PATCH] Resolving Issue #907

XSS in spikekill.php
---
 docs/CHANGELOG | 1 +
 spikekill.php  | 5 +++--
 2 files changed, 4 insertions(+), 2 deletions(-)

diff --git a/docs/CHANGELOG b/docs/CHANGELOG
index 8d1a925d6..c5b1aee6c 100644
--- a/docs/CHANGELOG
+++ b/docs/CHANGELOG
@@ -3,6 +3,7 @@ Cacti CHANGELOG
 1.1.18
 -issue#903: Upgrade pace.js to v0.7.8
 -issue#906: Create a separate Realm for Realtime Graphs
+-issue#907: XSS issue in spikekill.php
 
 1.1.17
 -issue#450: List View to Preview shows no results
diff --git a/spikekill.php b/spikekill.php
index 8d4d5c296..a89df0a8d 100644
--- a/spikekill.php
+++ b/spikekill.php
@@ -34,7 +34,7 @@
 		case 'fill':
 			break;
 		default:
-			echo __("FATAL: Spike Kill method '%s' is Invalid\n", get_nfilter_request_var('method'));
+			echo __("FATAL: Spike Kill method '%s' is Invalid\n", htmlspecialchars(get_nfilter_request_var('method'), ENT_QUOTES, 'UTF-8'));
 			exit(1);
 			break;
 	}
@@ -45,7 +45,8 @@
 		FROM graph_templates_item
 		LEFT JOIN data_template_rrd
 		ON graph_templates_item.task_item_id=data_template_rrd.id
-		WHERE graph_templates_item.local_graph_id = ?', array(get_filter_request_var('local_graph_id')));
+		WHERE graph_templates_item.local_graph_id = ?',
+		array(get_filter_request_var('local_graph_id')));
 
 	$results = '';
 	if (sizeof($local_data_ids)) {
