From 5b383c537eae7a00ebd26d3f7211dac99ddecb12 Mon Sep 17 00:00:00 2001
From: Paul Humphreys <querycsv@gmail.com>
Date: Wed, 10 Mar 2021 16:48:02 +0000
Subject: [PATCH] don't inadvertantly modify Object.prototype

---
 index.js | 11 +++++++++++
 test2.js |  5 +++++
 2 files changed, 16 insertions(+)
 create mode 100644 test2.js

diff --git a/index.js b/index.js
index bb62259..cb73ee6 100644
--- a/index.js
+++ b/index.js
@@ -102,6 +102,17 @@ const objectMerge = (original, patch, removeMode) => {
     }
     //merge objects
     else {
+      //Don't implicitly mutate Object.prototype but subsitute an empty object
+      if(original[name] === Object.prototype) {
+        delete original[name];
+
+        Object.defineProperty(original, name, {
+          enumerable: true,
+          writable: true,
+          value: {}
+        });
+      }
+
       original[name] = objectMerge(original[name], patch[name], removeMode);
     }
   }
diff --git a/test2.js b/test2.js
new file mode 100644
index 0000000..1be069c
--- /dev/null
+++ b/test2.js
@@ -0,0 +1,5 @@
+patchMerge = require('./index.js');
+var obj = {}
+console.log("Before : " + obj.isAdmin);
+console.log(patchMerge(obj, JSON.parse('{ "__proto__": { "isAdmin": true }}')));
+console.log("After : " + obj.isAdmin);
