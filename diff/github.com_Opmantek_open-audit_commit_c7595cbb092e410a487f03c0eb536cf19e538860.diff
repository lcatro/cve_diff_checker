From c7595cbb092e410a487f03c0eb536cf19e538860 Mon Sep 17 00:00:00 2001
From: Mark Unwin <marku@opmantek.com>
Date: Mon, 28 Sep 2020 16:07:18 +1000
Subject: [PATCH] Improve - Add a utility function to calculate the number of
 hosts in a range or subnet.

---
 code_igniter/application/controllers/util.php | 16 ++++++++++++++++
 1 file changed, 16 insertions(+)

diff --git a/code_igniter/application/controllers/util.php b/code_igniter/application/controllers/util.php
index e14011a5e..d01e267fe 100644
--- a/code_igniter/application/controllers/util.php
+++ b/code_igniter/application/controllers/util.php
@@ -73,6 +73,22 @@ public function index()
         return;
     }
 
+    public function subnet_size()
+    {
+        $command = "nmap -n -sL " . $_POST['subnet'];
+        exec($command, $output, $return_var);
+        $count = 0;
+        if ($return_var === 0) {
+            foreach ($output as $line) {
+                if (stripos($line, 'Nmap scan report for') === 0) {
+                    $count = $count + 1;
+                }
+            }
+        }
+        echo $count;
+        return;
+    }
+
     /**
     * Process the supplied data and return a padded version string
     *
